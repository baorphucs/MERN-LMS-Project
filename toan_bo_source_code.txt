

==================================================
FILE_PATH: client\package.json
==================================================
{
  "name": "lms-client",
  "version": "0.1.0",
  "private": true,
  "dependencies": {
    "@headlessui/react": "^1.7.17",
    "@heroicons/react": "^1.0.6",
    "@testing-library/jest-dom": "^5.17.0",
    "@testing-library/react": "^13.4.0",
    "@testing-library/user-event": "^13.5.0",
    "axios": "^1.4.0",
    "framer-motion": "^10.15.1",
    "lottie-react": "^2.4.1",
    "moment": "^2.29.4",
    "react": "^18.2.0",
    "react-datepicker": "^4.16.0",
    "react-dom": "^18.2.0",
    "react-icons": "^4.10.1",
    "react-router-dom": "^6.15.0",
    "react-scripts": "5.0.1",
    "react-toastify": "^9.1.3",
    "web-vitals": "^2.1.4",
    "zxcvbn": "^4.4.2"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
  "eslintConfig": {
    "extends": [
      "react-app",
      "react-app/jest"
    ]
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  },
  "devDependencies": {
    "autoprefixer": "^10.4.14",
    "postcss": "^8.4.27",
    "tailwindcss": "^3.3.3"
  },
  "proxy": "http://localhost:5000"
}


==================================================
FILE_PATH: client\public\index.html
==================================================
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Learning Management System built with MERN stack"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <title>LMS - Learning Management System</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
  </body>
</html>


==================================================
FILE_PATH: client\public\manifest.json
==================================================
{
  "short_name": "LMS",
  "name": "Learning Management System",
  "icons": [
    {
      "src": "favicon.ico",
      "sizes": "64x64 32x32 24x24 16x16",
      "type": "image/x-icon"
    },
    {
      "src": "logo192.png",
      "type": "image/png",
      "sizes": "192x192"
    },
    {
      "src": "logo512.png",
      "type": "image/png",
      "sizes": "512x512"
    }
  ],
  "start_url": ".",
  "display": "standalone",
  "theme_color": "#0ea5e9",
  "background_color": "#ffffff"
}


==================================================
FILE_PATH: client\src\App.js
==================================================
import React from 'react';
import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';
import { ToastContainer } from 'react-toastify';
import 'react-toastify/dist/ReactToastify.css';

// Auth Context
import { AuthProvider } from './context/AuthContext';

// Layout Components
import Layout from './components/layout/Layout';
import PrivateRoute from './components/routing/PrivateRoute';
import TeacherRoute from './components/routing/TeacherRoute';
import StudentRoute from './components/routing/StudentRoute';

// Auth Pages
import Login from './pages/auth/Login';
import Register from './pages/auth/Register';

// Public Pages
import Home from './pages/Home';
import NotFound from './pages/NotFound';

// Dashboard Pages
import TeacherDashboard from './pages/teacher/Dashboard';
import StudentDashboard from './pages/student/Dashboard';

// Course Pages
import Courses from './pages/courses/Courses';
import CourseDetails from './pages/courses/CourseDetails';
import CreateCourse from './pages/teacher/CreateCourse';
import EditCourse from './pages/teacher/EditCourse';

// NEW: Quản lý người dùng cho Teacher
import Users from './pages/teacher/Users';

// Assignment Pages
import Assignments from './pages/assignments/Assignments';
import AssignmentDetails from './pages/assignments/AssignmentDetails';
import CreateAssignment from './pages/teacher/CreateAssignment';
import SubmitAssignment from './pages/student/SubmitAssignment';

// Quiz Pages
import Quizzes from './pages/quizzes/Quizzes';
import QuizDetails from './pages/quizzes/QuizDetails';
import CreateQuiz from './pages/teacher/CreateQuiz';
import TakeQuiz from './pages/quizzes/TakeQuiz';
import QuizResult from './pages/quizzes/QuizResult';
import EditQuiz from './pages/teacher/EditQuiz';

// Material
import Materials from './pages/materials/Materials';
import CreateMaterial from './pages/teacher/CreateMaterial';

// Notice
import Notices from './pages/notices/Notices';
import CreateNotice from './pages/teacher/CreateNotice';

const App = () => {
  return (
    <AuthProvider>
      <Router>
        <ToastContainer position="top-right" autoClose={3000} />
        <Routes>
          {/* Public Routes */}
          <Route path="/" element={<Layout><Home /></Layout>} />
          <Route path="/login" element={<Login />} />
          <Route path="/register" element={<Register />} />

          {/* Protected Routes - Cả Teacher & Student */}
          <Route element={<PrivateRoute />}>
            <Route path="/courses" element={<Layout><Courses /></Layout>} />
            <Route path="/courses/:id" element={<Layout><CourseDetails /></Layout>} />
            <Route path="/notices" element={<Layout><Notices /></Layout>} />
            <Route path="/materials" element={<Layout><Materials /></Layout>} />
            <Route path="/assignments" element={<Layout><Assignments /></Layout>} />
            <Route path="/assignments/:id" element={<Layout><AssignmentDetails /></Layout>} />
            <Route path="/quizzes" element={<Layout><Quizzes /></Layout>} />
            <Route path="/quizzes/:id" element={<Layout><QuizDetails /></Layout>} />
            <Route path="/quizzes/:id/result" element={<Layout><QuizResult /></Layout>} />
          </Route>

          {/* Teacher Routes - Bao gồm cả Super Admin */}
          <Route element={<TeacherRoute />}>
            <Route path="/teacher/dashboard" element={<Layout><TeacherDashboard /></Layout>} />
            <Route path="/teacher/create-course" element={<Layout><CreateCourse /></Layout>} />
            
            {/* MỚI: Quản lý tất cả khóa học */}
            <Route path="/teacher/courses" element={<Layout><Courses /></Layout>} />
            
            {/* MỚI: Sửa khóa học */}
            <Route path="/teacher/edit-course/:id" element={<Layout><EditCourse /></Layout>} />
            
            {/* MỚI: Quản lý người dùng */}
            <Route path="/teacher/users" element={<Layout><Users /></Layout>} />

            {/* Các route tạo nội dung */}
            <Route path="/teacher/assignments/create/:courseId" element={<Layout><CreateAssignment /></Layout>} />
            <Route path="/teacher/quizzes/create/:courseId" element={<Layout><CreateQuiz /></Layout>} />
            <Route path="/teacher/materials/create/:courseId" element={<Layout><CreateMaterial /></Layout>} />
            <Route path="/teacher/notices/create/:courseId" element={<Layout><CreateNotice /></Layout>} />
            
            {/* Edit Quiz */}
            <Route path="/quizzes/:id/edit" element={<Layout><EditQuiz /></Layout>} />
          </Route>

          {/* Student Routes */}
          <Route element={<StudentRoute />}>
            <Route path="/student/dashboard" element={<Layout><StudentDashboard /></Layout>} />
            <Route path="/assignments/:id/submit" element={<Layout><SubmitAssignment /></Layout>} />
            <Route path="/quizzes/:id/take" element={<Layout><TakeQuiz /></Layout>} />
          </Route>

          {/* 404 */}
          <Route path="*" element={<NotFound />} />
        </Routes>
      </Router>
    </AuthProvider>
  );
};

export default App;

==================================================
FILE_PATH: client\src\components\course\CourseNotices.jsx
==================================================
import React, { useEffect, useState } from 'react';
import { useParams } from 'react-router-dom';
import axios from 'axios';
import { Box, Typography, CircularProgress, Alert } from '@mui/material';
import NoticeItem from './NoticeItem';

const CourseNotices = () => {
  const { id } = useParams();
  const [notices, setNotices] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const fetchNotices = async () => {
      try {
        setLoading(true);
        // Make sure to include courseId as a query parameter
        const response = await axios.get(`/api/notices?courseId=${id}`);
        console.log('Fetched notices:', response.data);
        setNotices(response.data.data);
        setLoading(false);
      } catch (err) {
        console.error('Error fetching notices:', err);
        setError('Failed to load notices');
        setLoading(false);
      }
    };

    if (id) {
      fetchNotices();
    }
  }, [id]);

  if (loading) {
    return <CircularProgress />;
  }

  if (error) {
    return <Alert severity="error">{error}</Alert>;
  }

  if (notices.length === 0) {
    return <Typography variant="body1">No notices available for this course.</Typography>;
  }

  return (
    <Box>
      {notices.map((notice) => (
        <NoticeItem key={notice._id} notice={notice} />
      ))}
    </Box>
  );
};

export default CourseNotices;


==================================================
FILE_PATH: client\src\components\layout\Footer.js
==================================================
import React from 'react';
import { Link } from 'react-router-dom';
import { motion } from 'framer-motion';

const Footer = () => (
  <motion.footer
    initial={{ opacity: 0, y: 40 }}
    animate={{ opacity: 1, y: 0 }}
    transition={{ duration: 0.7, delay: 0.2 }}
    className="bg-gradient-to-tr from-primary-700 to-secondary-800 text-white py-10 mt-16 shadow-inner"
  >
    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col md:flex-row md:justify-between items-center gap-6">
      <div className="flex flex-col items-center md:items-start">
        <span className="text-2xl font-extrabold font-heading tracking-tight bg-gradient-to-r from-primary-300 to-accent-yellow bg-clip-text text-transparent mb-2">
          NTTU HUB
        </span>
        <span className="text-sm text-primary-100">&copy; {new Date().getFullYear()} Modern LMS. All rights reserved.</span>
      </div>
      <nav className="flex flex-wrap gap-6 text-primary-100 text-sm font-medium">
        <Link to="/" className="hover:text-accent-yellow transition-colors">Home</Link>
        <Link to="/courses" className="hover:text-accent-yellow transition-colors">Courses</Link>
        <Link to="/login" className="hover:text-accent-yellow transition-colors">Login</Link>
        <Link to="/register" className="hover:text-accent-yellow transition-colors">Register</Link>
      </nav>
      <div className="flex gap-4 mt-4 md:mt-0">
        <a href="https://twitter.com" target="_blank" rel="noopener noreferrer" className="hover:text-accent-yellow transition-colors">
          <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M24 4.557a9.93 9.93 0 0 1-2.828.775 4.932 4.932 0 0 0 2.165-2.724c-.951.564-2.005.974-3.127 1.195A4.92 4.92 0 0 0 16.616 3c-2.73 0-4.942 2.21-4.942 4.932 0 .386.045.762.127 1.124C7.728 8.807 4.1 6.884 1.671 3.965c-.423.722-.666 1.561-.666 2.475 0 1.708.87 3.216 2.188 4.099a4.904 4.904 0 0 1-2.237-.616c-.054 2.281 1.581 4.415 3.949 4.89a4.936 4.936 0 0 1-2.224.084c.627 1.956 2.444 3.377 4.6 3.417A9.867 9.867 0 0 1 0 21.543a13.94 13.94 0 0 0 7.548 2.209c9.057 0 14.009-7.496 14.009-13.986 0-.213-.005-.425-.014-.636A9.936 9.936 0 0 0 24 4.557z"/></svg>
        </a>
        <a href="https://github.com" target="_blank" rel="noopener noreferrer" className="hover:text-accent-yellow transition-colors">
          <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.477 2 2 6.484 2 12.021c0 4.428 2.865 8.184 6.839 9.504.5.092.682-.217.682-.482 0-.237-.009-.868-.014-1.703-2.782.605-3.369-1.342-3.369-1.342-.454-1.157-1.11-1.465-1.11-1.465-.908-.62.069-.608.069-.608 1.004.07 1.532 1.032 1.532 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.339-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.987 1.029-2.686-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.025A9.564 9.564 0 0 1 12 6.844c.85.004 1.705.115 2.504.338 1.909-1.295 2.748-1.025 2.748-1.025.546 1.378.202 2.397.1 2.65.64.699 1.028 1.593 1.028 2.686 0 3.847-2.338 4.695-4.566 4.944.359.309.678.919.678 1.852 0 1.336-.012 2.417-.012 2.747 0 .267.18.577.688.48C19.138 20.2 22 16.448 22 12.021 22 6.484 17.523 2 12 2z"/></svg>
        </a>
      </div>
    </div>
  </motion.footer>
);

export default Footer;


==================================================
FILE_PATH: client\src\components\layout\Layout.js
==================================================
import React, { useContext } from 'react';
import { motion } from 'framer-motion';
import Navbar from './Navbar';
import Sidebar from './Sidebar';
import AuthContext from '../../context/AuthContext';

const Layout = ({ children }) => {
  const { isAuthenticated, loading } = useContext(AuthContext);
  
  if (loading) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="w-16 h-16 border-t-4 border-primary-500 border-solid rounded-full animate-spin"></div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50">
      <Navbar />
      
      <div className="flex">
        {isAuthenticated && <Sidebar />}
        
        <motion.main 
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5 }}
          className={`flex-1 p-4 md:p-8 ${isAuthenticated ? 'ml-0 md:ml-64' : ''}`}
        >
          <div className="max-w-7xl mx-auto">
            {children}
          </div>
        </motion.main>
      </div>
    </div>
  );
};

export default Layout;


==================================================
FILE_PATH: client\src\components\layout\Navbar.js
==================================================
import React, { useContext, useState } from 'react';
import { Link, useLocation } from 'react-router-dom';
import { motion } from 'framer-motion';
import { Disclosure, Menu, Transition } from '@headlessui/react';
import {
  BellIcon,
  UserCircleIcon,
  MenuIcon,
  XIcon
} from '@heroicons/react/outline';
import AuthContext from '../../context/AuthContext';
import { useNotifications } from '../../context/NotificationContext';

const Navbar = () => {
  const { user, isAuthenticated, logout } = useContext(AuthContext);
  const location = useLocation();
  const { notifications, markAsRead } = useNotifications();

  const navLinks = [
    { name: 'Home', to: '/', public: true },
    { name: 'Courses', to: '/courses', public: false },
  ];

  function isActive(path) {
    return location.pathname === path || location.pathname.startsWith(`${path}/`);
  }

  function classNames(...classes) {
    return classes.filter(Boolean).join(' ');
  }

  return (
    <Disclosure as="nav" className="bg-white/80 backdrop-blur-md shadow-lg sticky top-0 z-50 border-b border-neutral-50">
      {({ open }) => (
        <>
          <div className="mx-auto max-w-7xl px-2 sm:px-6 lg:px-8">
            <div className="relative flex h-16 items-center justify-between">
              <div className="absolute inset-y-0 left-0 flex items-center sm:hidden">
                {/* Mobile menu button*/}
                <Disclosure.Button className="inline-flex items-center justify-center rounded-md p-2 text-gray-700 hover:bg-primary-100 focus:outline-none">
                  <span className="sr-only">Open main menu</span>
                  {open ? (
                    <XIcon className="block h-6 w-6" aria-hidden="true" />
                  ) : (
                    <MenuIcon className="block h-6 w-6" aria-hidden="true" />
                  )}
                </Disclosure.Button>
              </div>
              <div className="flex flex-1 items-center justify-center sm:items-stretch sm:justify-start">
                <div className="flex flex-shrink-0 items-center">
                  <Link to="/">
                    <motion.div
                      whileHover={{ scale: 1.05 }}
                      className="text-2xl font-extrabold font-heading text-primary-400 drop-shadow-lg tracking-tight bg-gradient-to-r from-primary-400 to-secondary-500 bg-clip-text text-transparent"
                    >
                      NTTU HUB
                    </motion.div>
                  </Link>
                </div>
                <div className="hidden sm:ml-6 sm:block">
                  <div className="flex space-x-2">
                    {navLinks.map((item) => (
                      (item.public || isAuthenticated) && (
                        <Link
                          key={item.name}
                          to={item.to}
                          className={classNames(
                            isActive(item.to)
                              ? 'bg-primary-100 text-primary-700 shadow-lg'
                              : 'text-text-dark hover:bg-primary-50 hover:text-primary-500',
                            'rounded-xl px-4 py-2 text-base font-semibold transition-all duration-200 ease-in-out backdrop-blur-md'
                          )}
                        >
                          {item.name}
                        </Link>
                      )
                    ))}
                  </div>
                </div>
              </div>
              <div className="absolute inset-y-0 right-0 flex items-center pr-2 sm:static sm:inset-auto sm:ml-6 sm:pr-0">
                {isAuthenticated ? (
                  <>
                    {/* Notification dropdown */}
                    <Menu as="div" className="relative ml-3">
                      <div>
                        <Menu.Button className="relative flex rounded-full bg-white/70 shadow border border-primary-100 text-sm focus:outline-none transition-all duration-200">
                          <span className="sr-only">View notifications</span>
                          <BellIcon className="h-6 w-6 text-gray-700" />
                          {notifications.filter(n => !n.read).length > 0 && (
                            <span className="absolute top-0 right-0 block h-2 w-2 rounded-full bg-red-400"></span>
                          )}
                        </Menu.Button>
                      </div>
                      <Transition
                        enter="transition ease-out duration-100"
                        enterFrom="transform opacity-0 scale-95"
                        enterTo="transform opacity-100 scale-100"
                        leave="transition ease-in duration-75"
                        leaveFrom="transform opacity-100 scale-100"
                        leaveTo="transform opacity-0 scale-95"
                      >
                        <Menu.Items className="absolute right-0 z-10 mt-2 w-72 origin-top-right rounded-md bg-white py-1 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none">
                          <div className="px-4 py-2 font-semibold text-gray-700 border-b">
                            Notifications
                          </div>
                          {notifications.length > 0 ? (
                            notifications.map(notification => (
                              <Menu.Item key={notification._id}>
                                <div
                                  className={`block px-4 py-2 text-sm cursor-pointer ${notification.read ? 'text-gray-500' : 'text-gray-700 font-medium bg-blue-50'}`}
                                  onClick={() => markAsRead(notification._id)}
                                >
                                  {notification.text}
                                </div>
                              </Menu.Item>
                            ))
                          ) : (
                            <Menu.Item>
                              <div className="block px-4 py-2 text-sm text-gray-500">
                                No new notifications
                              </div>
                            </Menu.Item>
                          )}
                        </Menu.Items>
                      </Transition>
                    </Menu>
                    {/* Profile dropdown */}
                    <Menu as="div" className="relative ml-3">
                      <div>
                        <Menu.Button className="flex rounded-full bg-white/70 shadow border border-primary-100 text-sm focus:outline-none transition-all duration-200">
                          <span className="sr-only">Open user menu</span>
                          <div className="h-8 w-8 rounded-full flex items-center justify-center bg-primary-100 text-primary-700 font-bold border-2 border-primary-400 shadow">
                            {user?.name?.charAt(0).toUpperCase()}
                          </div>
                        </Menu.Button>
                      </div>
                      <Transition
                        enter="transition ease-out duration-100"
                        enterFrom="transform opacity-0 scale-95"
                        enterTo="transform opacity-100 scale-100"
                        leave="transition ease-in duration-75"
                        leaveFrom="transform opacity-100 scale-100"
                        leaveTo="transform opacity-0 scale-95"
                      >
                        <Menu.Items className="absolute right-0 z-10 mt-2 w-48 origin-top-right rounded-xl bg-white/90 shadow-lg ring-1 ring-primary-100 focus:outline-none backdrop-blur-md">
                          <Menu.Item>
                            {({ active }) => (
                              <Link
                                to={user?.role === 'teacher' ? '/teacher/dashboard' : '/student/dashboard'}
                                className={classNames(active ? 'bg-gray-100' : '', 'block px-4 py-2 text-sm text-gray-700')}
                              >
                                Dashboard
                              </Link>
                            )}
                          </Menu.Item>
                          <Menu.Item>
                            {({ active }) => (
                              <button
                                onClick={logout}
                                className={classNames(active ? 'bg-gray-100' : '', 'block w-full text-left px-4 py-2 text-sm text-gray-700')}
                              >
                                Sign out
                              </button>
                            )}
                          </Menu.Item>
                        </Menu.Items>
                      </Transition>
                    </Menu>
                  </>
                ) : (
                  <div className="flex space-x-4">
                    <Link
                      to="/login"
                      className="text-gray-700 hover:text-primary-600 px-3 py-2 rounded-md text-sm font-medium"
                    >
                      Login
                    </Link>
                    <Link
                      to="/register"
                      className="bg-primary-600 text-white hover:bg-primary-700 px-3 py-2 rounded-md text-sm font-medium"
                    >
                      Register
                    </Link>
                  </div>
                )}
              </div>
            </div>
          </div>
          <Disclosure.Panel className="sm:hidden">
            <div className="space-y-1 px-2 pb-3 pt-2">
              {navLinks.map((item) => (
                (item.public || isAuthenticated) && (
                  <Disclosure.Button
                    key={item.name}
                    as={Link}
                    to={item.to}
                    className={classNames(
                      isActive(item.to)
                        ? 'bg-primary-100 text-primary-700 shadow'
                        : 'text-gray-700 hover:bg-primary-50 hover:text-primary-700',
                      'block rounded-md px-3 py-2 text-base font-semibold'
                    )}
                  >
                    {item.name}
                  </Disclosure.Button>
                )
              ))}
            </div>
          </Disclosure.Panel>
        </>
      )}
    </Disclosure>
  );
};

export default Navbar;


==================================================
FILE_PATH: client\src\components\layout\Sidebar.js
==================================================
import React, { useContext, useState } from 'react';
import { Link, useLocation } from 'react-router-dom';
import { motion, AnimatePresence } from 'framer-motion';
import {
  HomeIcon,
  BookOpenIcon,
  ClipboardCheckIcon,
  DocumentTextIcon,
  BellIcon,
  AcademicCapIcon,
  ChevronDownIcon,
  UsersIcon,        // THÊM ICON NÀY
} from '@heroicons/react/outline';
import AuthContext from '../../context/AuthContext';

const Sidebar = () => {
  const { user } = useContext(AuthContext);
  const location = useLocation();
  const [expanded, setExpanded] = useState({ courses: false });

  const isTeacher = user?.role === 'teacher';
  const isStudent = user?.role === 'student';

  const toggleSubmenu = (key) => {
    setExpanded((prev) => ({ ...prev, [key]: !prev[key] }));
  };

  const isActive = (pathname) => {
    return location.pathname === pathname || location.pathname.startsWith(`${pathname}/`);
  };

  return (
    <aside className="h-screen w-64 bg-white/80 backdrop-blur-md shadow-xl fixed left-0 top-16 hidden md:flex flex-col overflow-y-auto border-r border-neutral-50">
      <div className="py-6 flex-1 flex flex-col">
        {/* User Info */}
        <div className="px-6 mb-8">
          <div className="flex items-center">
            <div className="w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center mr-3 border-2 border-primary-400 shadow">
              <span className="text-primary-700 font-bold text-lg">
                {user?.name?.charAt(0).toUpperCase()}
              </span>
            </div>
            <div>
              <p className="text-base font-semibold text-text-dark">{user?.name}</p>
              <p className="text-xs text-text-medium capitalize">{user?.role}</p>
            </div>
          </div>
        </div>

        {/* Navigation */}
        <nav className="px-3 space-y-1 flex-1">
          {/* Dashboard */}
          <Link
            to={isTeacher ? '/teacher/dashboard' : '/student/dashboard'}
            className={`flex items-center px-3 py-3 text-base font-semibold rounded-xl transition-all duration-200 backdrop-blur-md ${
              isActive(isTeacher ? '/teacher/dashboard' : '/student/dashboard')
                ? 'bg-primary-100 text-primary-700 shadow-lg'
                : 'text-text-dark hover:bg-primary-50 hover:text-primary-500'
            }`}
          >
            <HomeIcon className="w-5 h-5 mr-3" />
            Dashboard
          </Link>

          {/* Courses - có submenu cho Teacher */}
          <div>
            <button
              onClick={() => toggleSubmenu('courses')}
              className={`flex items-center justify-between w-full px-3 py-3 text-base font-semibold rounded-xl transition-all duration-200 focus:outline-none backdrop-blur-md ${
                isActive('/courses') || location.pathname.startsWith('/teacher/courses')
                  ? 'bg-primary-100 text-primary-700 shadow-lg'
                  : 'text-text-dark hover:bg-primary-50 hover:text-primary-500'
              }`}
            >
              <div className="flex items-center">
                <BookOpenIcon className="w-5 h-5 mr-3" />
                Khóa Học
              </div>
              {isTeacher && (
                <ChevronDownIcon
                  className={`w-4 h-4 transition-transform ${
                    expanded.courses ? 'transform rotate-180' : ''
                  }`}
                />
              )}
            </button>

            {/* Submenu cho Teacher */}
            <AnimatePresence>
              {isTeacher && expanded.courses && (
                <motion.div
                  initial={{ height: 0, opacity: 0 }}
                  animate={{ height: 'auto', opacity: 1 }}
                  exit={{ height: 0, opacity: 0 }}
                  transition={{ duration: 0.2 }}
                  className="ml-8 mt-1 space-y-1"
                >
                  <Link
                    to="/courses"
                    className={`block px-3 py-2 text-base rounded-lg transition-all duration-200 ${
                      location.pathname === '/courses'
                        ? 'bg-primary-100 text-primary-700 shadow'
                        : 'text-text-medium hover:bg-primary-50 hover:text-primary-500'
                    }`}
                  >
                    Tất cả khóa học
                  </Link>
                  <Link
                    to="/teacher/create-course"
                    className={`block px-3 py-2 text-base rounded-lg transition-all duration-200 ${
                      location.pathname.startsWith('/teacher/create-course')
                        ? 'bg-primary-100 text-primary-700 shadow'
                        : 'text-text-medium hover:bg-primary-50 hover:text-primary-500'
                    }`}
                  >
                    Tạo khóa học mới
                  </Link>
                </motion.div>
              )}
            </AnimatePresence>

            {/* Link chung cho Student */}
            {!isTeacher && (
              <Link
                to="/courses"
                className={`flex items-center px-3 py-3 text-base font-semibold rounded-xl transition-all duration-200 backdrop-blur-md ml-10 ${
                  isActive('/courses')
                    ? 'bg-primary-100 text-primary-700 shadow-lg'
                    : 'text-text-dark hover:bg-primary-50 hover:text-primary-500'
                }`}
              >
                Xem tất cả khóa học
              </Link>
            )}
          </div>

          {/* 2 MENU MỚI CHỈ DÀNH CHO TEACHER */}
          {isTeacher && (
            <>
              {/* Quản lý tất cả khóa học (mới) */}
              <Link
                to="/teacher/courses"
                className={`flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 ${
                  location.pathname.startsWith('/teacher/courses') && location.pathname !== '/teacher/courses/create'
                    ? 'bg-primary-600 text-white shadow-lg'
                    : 'hover:bg-primary-100 text-text-dark'
                }`}
              >
                <BookOpenIcon className="w-ml-1 w-6 h-6" />
                <span className="font-medium">Quản Lý Tất Cả Khóa Học</span>
              </Link>

              {/* Quản lý người dùng */}
              <Link
                to="/teacher/users"
                className={`flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 ${
                  location.pathname === '/teacher/users'
                    ? 'bg-primary-600 text-white shadow-lg'
                    : 'hover:bg-primary-100 text-text-dark'
                }`}
              >
                <UsersIcon className="w-6 h-6" />
                <span className="font-medium">Quản Lý Người Dùng</span>
              </Link>
            </>
          )}

          {/* Các menu khác bạn có thể thêm sau nếu muốn */}
          {/* Ví dụ: Assignments, Quizzes, Materials, Notices... */}
        </nav>
      </div>
    </aside>
  );
};

export default Sidebar;

==================================================
FILE_PATH: client\src\components\Navbar.js
==================================================
import {
  BellIcon,
  UserCircleIcon,
  Bars3Icon,
  XMarkIcon
} from '@heroicons/react/24/outline';

// ...existing code...

==================================================
FILE_PATH: client\src\components\routing\Authorize.js
==================================================


==================================================
FILE_PATH: client\src\components\routing\PrivateRoute.js
==================================================
import { useContext } from 'react';
import { Navigate, Outlet, useLocation } from 'react-router-dom';
import AuthContext from '../../context/AuthContext';

const PrivateRoute = () => {
  const { isAuthenticated, loading } = useContext(AuthContext);
  const location = useLocation();

  // If still loading auth state, show nothing
  if (loading) {
    return null;
  }

  // If not authenticated, redirect to login with return path
  if (!isAuthenticated) {
    return <Navigate to="/login" state={{ from: location }} replace />;
  }

  // If authenticated, render the child routes
  return <Outlet />;
};

export default PrivateRoute;


==================================================
FILE_PATH: client\src\components\routing\StudentRoute.js
==================================================
import { useContext } from 'react';
import { Navigate, Outlet, useLocation } from 'react-router-dom';
import AuthContext from '../../context/AuthContext';

const StudentRoute = () => {
  const { isAuthenticated, loading, user } = useContext(AuthContext);
  const location = useLocation();

  // If still loading auth state, show nothing
  if (loading) {
    return null;
  }

  // If not authenticated, redirect to login
  if (!isAuthenticated) {
    return <Navigate to="/login" state={{ from: location }} replace />;
  }

  // If authenticated but not a student, redirect to home
  if (user?.role !== 'student') {
    return <Navigate to="/" replace />;
  }

  // If authenticated and a student, render the child routes
  return <Outlet />;
};

export default StudentRoute;


==================================================
FILE_PATH: client\src\components\routing\TeacherRoute.js
==================================================
import { useContext } from 'react';
import { Navigate, Outlet, useLocation } from 'react-router-dom';
import AuthContext from '../../context/AuthContext';

const TeacherRoute = () => {
  const { isAuthenticated, loading, user } = useContext(AuthContext);
  const location = useLocation();

  // If still loading auth state, show nothing
  if (loading) {
    return null;
  }

  // If not authenticated, redirect to login
  if (!isAuthenticated) {
    return <Navigate to="/login" state={{ from: location }} replace />;
  }

  // If authenticated but not a teacher, redirect to home
  if (user?.role !== 'teacher') {
    return <Navigate to="/" replace />;
  }

  // If authenticated and a teacher, render the child routes
  return <Outlet />;
};

export default TeacherRoute;


==================================================
FILE_PATH: client\src\components\Sidebar.js
==================================================
import {
  HomeIcon,
  BookOpenIcon,
  ClipboardDocumentCheckIcon,
  DocumentTextIcon,
  UserGroupIcon,
  BellIcon,
  Cog6ToothIcon,
  ArrowRightOnRectangleIcon
} from '@heroicons/react/24/outline';

// ...existing code...

==================================================
FILE_PATH: client\src\context\AuthContext.js
==================================================
import React, { createContext, useState, useEffect } from 'react';
import axios from 'axios';

const AuthContext = createContext();

export const AuthProvider = ({ children }) => {
  const [isAuthenticated, setIsAuthenticated] = useState(false);
  const [user, setUser] = useState(null);
  const [token, setToken] = useState(localStorage.getItem('token'));
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  // Set auth token header
  if (token) {
    axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
  } else {
    delete axios.defaults.headers.common['Authorization'];
  }

  // Load user if token exists
  useEffect(() => {
    const loadUser = async () => {
      if (token) {
        try {
          const res = await axios.get('/api/auth/me');
          setUser(res.data.user);
          setIsAuthenticated(true);
        } catch (err) {
          localStorage.removeItem('token');
          setToken(null);
          setUser(null);
          setIsAuthenticated(false);
          setError('Session expired, please login again');
        }
      }
      setLoading(false);
    };

    loadUser();
  }, [token]);

  // Register user
  const register = async (formData) => {
    try {
      console.log('Registering with data:', { 
        ...formData, 
        password: '[REDACTED]' 
      });
      
      // Use the full URL to bypass any proxy issues
      const res = await axios.post('http://localhost:5000/api/auth/register', formData, {
        headers: {
          'Content-Type': 'application/json'
        }
      });
      
      if (res.data.success) {
        localStorage.setItem('token', res.data.token);
        setToken(res.data.token);
        setUser(res.data.user);
        setIsAuthenticated(true);
        return { success: true };
      } else {
        throw new Error(res.data.message || 'Registration failed');
      }
    } catch (err) {
      console.error('Register error:', err);
      
      if (err.response) {
        console.log('Error response:', err.response.data);
        console.log('Error status:', err.response.status);
        
        // Set the error message from the server response
        const errorMessage = err.response.data.message || 'Registration failed';
        setError(errorMessage);
        
        // Show more user-friendly error for the duplicate email case
        if (errorMessage === 'This email is already registered') {
          setError('An account with this email already exists. Please try logging in.');
        }
      } else {
        setError('Unable to connect to the server. Please try again later.');
      }
      
      return { success: false };
    }
  };

  // Login user
  const login = async (formData) => {
    try {
      const res = await axios.post('/api/auth/login', formData);
      localStorage.setItem('token', res.data.token);
      setToken(res.data.token);
      setUser(res.data.user);
      setIsAuthenticated(true);
      setError(null);
      return true;
    } catch (err) {
      const errorMessage = err.response?.data?.message || 'Invalid credentials';
      setError(errorMessage);
      return false;
    }
  };

  // Logout user
  const logout = () => {
    localStorage.removeItem('token');
    setToken(null);
    setUser(null);
    setIsAuthenticated(false);
  };

  // Clear errors
  const clearErrors = () => {
    setError(null);
  };

  return (
    <AuthContext.Provider
      value={{
        token,
        isAuthenticated,
        user,
        loading,
        error,
        register,
        login,
        logout,
        clearErrors
      }}
    >
      {children}
    </AuthContext.Provider>
  );
};

export default AuthContext;


==================================================
FILE_PATH: client\src\context\NotificationContext.js
==================================================
import { createContext, useContext, useEffect, useState } from 'react';
import axios from 'axios';

const NotificationContext = createContext();

export const useNotifications = () => useContext(NotificationContext);

export const NotificationProvider = ({ children }) => {
  const [notifications, setNotifications] = useState([]);

  const fetchNotifications = async () => {
    const token = localStorage.getItem('token');
    if (!token) return;
    try {
      const res = await axios.get('/api/notifications', {
        headers: { Authorization: `Bearer ${token}` }
      });
      setNotifications(res.data.notifications);
    } catch (err) {
      // Optionally handle error
    }
  };

  const markAsRead = async (id) => {
    const token = localStorage.getItem('token');
    if (!token) return;
    try {
      await axios.put(`/api/notifications/${id}/read`, {}, {
        headers: { Authorization: `Bearer ${token}` }
      });
      setNotifications((prev) =>
        prev.map((n) => (n._id === id ? { ...n, read: true } : n))
      );
    } catch (err) {
      // Optionally handle error
    }
  };

  useEffect(() => { fetchNotifications(); }, []);

  return (
    <NotificationContext.Provider value={{ notifications, fetchNotifications, markAsRead }}>
      {children}
    </NotificationContext.Provider>
  );
}; 

==================================================
FILE_PATH: client\src\index.css
==================================================
@tailwind base;
@tailwind components;
@tailwind utilities;

body {
  margin: 0;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

h1, h2, h3, h4, h5, h6 {
  font-family: 'Poppins', sans-serif;
}

code {
  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',
    monospace;
}

.bg-grid-white {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32' width='32' height='32' fill='none' stroke='rgb(255,255,255)'%3e%3cpath d='M0 .5H31.5V32'/%3e%3c/svg%3e");
}


==================================================
FILE_PATH: client\src\index.js
==================================================
import React from 'react';
import ReactDOM from 'react-dom/client';
import './index.css';
import App from './App';
import reportWebVitals from './reportWebVitals';
import { NotificationProvider } from './context/NotificationContext';

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  <React.StrictMode>
    <NotificationProvider>
      <App />
    </NotificationProvider>
  </React.StrictMode>
);

// If you want to start measuring performance in your app, pass a function
// to log results (for example: reportWebVitals(console.log))
// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals
reportWebVitals();


==================================================
FILE_PATH: client\src\pages\assignments\AssignmentDetails.js
==================================================
import React, { useState, useEffect, useContext } from 'react';
import { useParams, Link, useNavigate } from 'react-router-dom';
import { motion } from 'framer-motion';
import axios from 'axios';
import moment from 'moment';
import { toast } from 'react-toastify';
import AuthContext from '../../context/AuthContext';
import {
  ArrowLeftIcon,
  CalendarIcon,
  ClockIcon,
  DocumentDownloadIcon,
  DocumentTextIcon
} from '@heroicons/react/outline';

const BACKEND_URL = process.env.REACT_APP_BACKEND_URL || 'http://localhost:5000';

const AssignmentDetails = () => {
  const { id } = useParams();
  const navigate = useNavigate();
  const { user } = useContext(AuthContext);
  
  const [assignment, setAssignment] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [submissionFile, setSubmissionFile] = useState(null);
  const [submitting, setSubmitting] = useState(false);
  const [refreshKey, setRefreshKey] = useState(0);
  
  const isTeacher = user?.role === 'teacher';
  const isStudent = user?.role === 'student';
  
  // Check if student has already submitted
  const studentSubmission = assignment?.submissions?.find(
    sub => sub && sub.student && sub.student._id === user?._id
  );
  
  const isDeadlinePassed = assignment?.deadline && moment().isAfter(moment(assignment.deadline));
  
  const now = moment();
  const dueDate = assignment?.deadline ? moment(assignment.deadline) : null;
  const canUpdateSubmission =
    studentSubmission &&
    dueDate &&
    now.isBefore(dueDate) &&
    now.diff(moment(studentSubmission.submittedAt), 'hours') < 1;
  
  useEffect(() => {
    const fetchAssignmentDetails = async () => {
      try {
        const res = await axios.get(`${BACKEND_URL}/api/assignments/${id}`);
        setAssignment(res.data.assignment || res.data.data);
        setLoading(false);
      } catch (error) {
        console.error('Error fetching assignment details:', error);
        setError('Failed to load assignment details');
        setLoading(false);
      }
    };
    
    fetchAssignmentDetails();
  }, [id, refreshKey]);
  
  const handleFileChange = (e) => {
    setSubmissionFile(e.target.files[0]);
  };
  
  const handleSubmitAssignment = async (e) => {
    e.preventDefault();
    if (!submissionFile) {
      toast.error('Please select a file to submit');
      return;
    }
    setSubmitting(true);
    try {
      const formData = new FormData();
      formData.append('file', submissionFile);
      const res = await axios.post(`${BACKEND_URL}/api/assignments/${id}/submit`, formData, {
        headers: {
          'Content-Type': 'multipart/form-data',
        },
      });
      toast.success('Assignment submitted successfully!');
      setSubmissionFile(null);
      // Automatically redirect/refresh to show the updated submission
      window.location.reload();
    } catch (error) {
      console.error('Error submitting assignment:', error);
      toast.error(error.response?.data?.message || 'Error submitting assignment');
    } finally {
      setSubmitting(false);
    }
  };
  
  const handleGradeSubmission = async (submissionId, grade, feedback) => {
    try {
      console.log('Grading submission:', { submissionId, grade, feedback });
      await axios.put(`${BACKEND_URL}/api/submissions/${submissionId}/grade`, { grade, feedback });
      // Refetch assignment details to update UI
      setRefreshKey(prev => prev + 1);
      toast.success('Submission graded successfully!');
    } catch (error) {
      console.error('Error grading submission:', error);
      toast.error('Error grading submission');
    }
  };
  
  const handleDownload = async (fileUrl, fileName) => {
    const token = localStorage.getItem('token');
    try {
      const response = await axios.get(
        `${BACKEND_URL}/api/materials/download/${encodeURIComponent(fileUrl)}`,
        {
          responseType: 'blob',
          headers: { Authorization: `Bearer ${token}` }
        }
      );
      const url = window.URL.createObjectURL(new Blob([response.data]));
      const link = document.createElement('a');
      link.href = url;
      link.setAttribute('download', fileName || fileUrl);
      document.body.appendChild(link);
      link.click();
      link.remove();
      window.URL.revokeObjectURL(url);
    } catch (error) {
      alert('Download failed: ' + (error.response?.data?.message || error.message));
    }
  };
  
  if (loading) {
    return (
      <div className="flex justify-center items-center h-64">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"></div>
      </div>
    );
  }
  
  if (error) {
    return (
      <div className="text-center py-12">
        <h2 className="text-xl font-semibold text-gray-800 mb-2">Error</h2>
        <p className="text-gray-600">{error}</p>
        <Link to="/assignments" className="mt-4 inline-block text-primary-600 hover:underline">
          Back to Assignments
        </Link>
      </div>
    );
  }
  
  if (!assignment) {
    return (
      <div className="text-center py-12">
        <h2 className="text-xl font-semibold text-gray-800 mb-2">Assignment Not Found</h2>
        <p className="text-gray-600">The assignment you're looking for doesn't exist or you don't have access to it.</p>
        <Link to="/assignments" className="mt-4 inline-block text-primary-600 hover:underline">
          Back to Assignments
        </Link>
      </div>
    );
  }
  
  return (
    <div className="space-y-6 bg-neutral-50 min-h-screen py-8 px-2 sm:px-6 lg:px-8">
      {/* Back Button */}
      <motion.div initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.4 }}>
        <button
          onClick={() => navigate(-1)}
          className="flex items-center text-text-medium hover:text-primary-500 font-semibold mb-2"
        >
          <ArrowLeftIcon className="h-4 w-4 mr-1" />
          Back
        </button>
      </motion.div>
      
      {/* Assignment Header */}
      <motion.div initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className="bg-white/90 rounded-2xl shadow-card border border-primary-50 overflow-hidden">
        <div className="p-6">
          <div className="flex flex-col md:flex-row md:justify-between md:items-start">
            <div>
              <h1 className="text-2xl font-extrabold font-heading text-primary-400 mb-2 drop-shadow-lg tracking-tight bg-gradient-to-r from-primary-400 to-secondary-500 bg-clip-text text-transparent">
                {assignment.title}
              </h1>
              <div className="flex flex-wrap gap-2 mb-4">
                <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-primary-100 text-primary-700 border border-primary-400 shadow">
                  Course: {assignment.course?.title}
                </span>
                <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-accent-yellow text-text-dark border border-accent-yellow shadow">
                  Points: {assignment.totalPoints}
                </span>
                <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold ${isDeadlinePassed ? 'bg-action-red text-white' : 'bg-accent-green text-white'} border shadow`}>
                  <ClockIcon className="h-3 w-3 mr-1" />
                  Due: {moment(assignment.deadline).format('MMM D, YYYY [at] h:mm A')}
                </span>
              </div>
              <div className="prose max-w-none text-text-dark">
                {assignment.description}
              </div>
            </div>
          </div>
        </div>
      </motion.div>

      {/* Attachments Section */}
      {assignment.attachments && assignment.attachments.length > 0 && (
        <motion.div initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.1 }} className="mb-8 bg-white/90 rounded-xl border border-primary-50 shadow-card">
          <h2 className="text-lg font-bold text-text-dark mb-2 px-6 pt-6">Attachments</h2>
          <ul className="divide-y divide-neutral-50 border-t border-neutral-50 rounded-md">
            {assignment.attachments.map((attachment, index) => (
              <li key={index} className="py-3 px-6 flex items-center justify-between text-sm">
                <div className="flex items-center">
                  <DocumentTextIcon className="h-5 w-5 text-primary-400 mr-3" />
                  <span className="text-text-dark">{attachment.fileName}</span>
                </div>
                <button
                  onClick={() => handleDownload(attachment.fileUrl, attachment.originalName)}
                  className="inline-flex items-center px-3 py-1 bg-primary-400 text-white rounded-lg hover:bg-primary-500 transition-colors font-semibold shadow"
                >
                  Download {attachment.originalName || attachment.fileUrl}
                </button>
              </li>
            ))}
          </ul>
        </motion.div>
      )}

      {/* Student Submission Section */}
      {isStudent && (
        <motion.div initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.2 }} className="bg-white/90 rounded-2xl shadow-card border border-primary-50 p-6">
          <h2 className="text-lg font-bold text-text-dark mb-4">Your Submission</h2>
          
          {studentSubmission && studentSubmission.attachments && studentSubmission.attachments.length > 0 ? (
            <div className="mt-4">
              <p className="font-medium">Your Uploaded File:</p>
              <button
                onClick={() => handleDownload(studentSubmission.attachments[0].fileUrl, studentSubmission.attachments[0].fileName)}
                className="text-primary-600 hover:underline"
              >
                {studentSubmission.attachments[0].fileName || 'No file'}
              </button>
              <p className="text-xs text-gray-500 mt-1">
                Submitted: {moment(studentSubmission.submittedAt).format('MMM D, YYYY [at] h:mm A')}
              </p>
              {typeof studentSubmission.grade !== 'undefined' && (
                <div className="mt-4 p-4 bg-green-50 border border-green-200 rounded shadow">
                  <div className="text-lg font-bold text-green-700">
                    Grade: {studentSubmission.grade} / {assignment.totalPoints}
                  </div>
                  {studentSubmission.feedback && (
                    <div className="mt-2 text-gray-700">
                      <span className="font-medium">Feedback:</span> {studentSubmission.feedback}
                    </div>
                  )}
                </div>
              )}
            </div>
          ) : (
            <div className="mt-4 text-gray-400">No file to download</div>
          )}
          
          {canUpdateSubmission && (
            <form onSubmit={handleSubmitAssignment} className="mt-4">
              <label className="block mb-2 font-medium">Update your submission:</label>
              <input
                type="file"
                onChange={handleFileChange}
                className="mb-2"
                accept=".pdf,.doc,.docx,.txt"
              />
              <button
                type="submit"
                className="px-4 py-2 bg-primary-600 text-white rounded hover:bg-primary-700"
                disabled={submitting}
              >
                {submitting ? 'Updating...' : 'Update Submission'}
              </button>
            </form>
          )}
        </motion.div>
      )}

      {/* Teacher Submissions Overview */}
      {isTeacher && (
        <motion.div initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.3 }} className="bg-white/90 rounded-2xl shadow-card border border-primary-50 p-6">
          <h2 className="text-lg font-bold text-text-dark mb-4">Student Submissions</h2>
          
          {assignment.submissions && assignment.submissions.length > 0 ? (
            <div className="mt-6">
              <h2 className="text-lg font-semibold text-gray-800 mb-4">Student Submissions</h2>
              <ul className="divide-y divide-gray-200">
                {assignment.submissions.map((sub, idx) => {
                  const fileUrl = sub.attachments && sub.attachments[0] ? sub.attachments[0].fileUrl : null;
                  const fileName = sub.attachments && sub.attachments[0] ? sub.attachments[0].fileName : null;
                  return (
                    <li key={sub._id || idx} className="py-4 flex flex-col md:flex-row md:items-center md:justify-between">
                      <div>
                        <div className="font-medium">{sub.student?.name || 'Unknown Student'}</div>
                        <div className="text-xs text-gray-500">{sub.student?.email}</div>
                        <div className="mt-1">
                          {fileUrl ? (
                            <button
                              onClick={() => handleDownload(fileUrl, fileName)}
                              className="text-primary-600 hover:underline"
                            >
                              {fileName || 'No file'}
                            </button>
                          ) : (
                            <span className="text-gray-400">No file to download</span>
                          )}
                        </div>
                        <div className="text-xs text-gray-500 mt-1">
                          Submitted: {sub.submittedAt ? moment(sub.submittedAt).format('MMM D, YYYY [at] h:mm A') : ''}
                        </div>
                      </div>
                      <div className="mt-2 md:mt-0">
                        {!sub.graded ? (
                          <ModernGradeSubmissionForm
                            submissionId={sub._id}
                            totalPoints={assignment.totalPoints}
                            onGradeSubmit={handleGradeSubmission}
                            defaultGrade={sub.grade}
                            defaultFeedback={sub.feedback}
                          />
                        ) : (
                          <div className="mt-4 p-4 bg-green-50 border border-green-200 rounded shadow">
                            <div className="text-lg font-bold text-green-700">
                              Grade: {sub.grade} / {assignment.totalPoints}
                            </div>
                            {sub.feedback && (
                              <div className="mt-2 text-gray-700">
                                <span className="font-medium">Feedback:</span> {sub.feedback}
                              </div>
                            )}
                          </div>
                        )}
                      </div>
                    </li>
                  );
                })}
              </ul>
            </div>
          ) : (
            <div className="text-center py-4">
              <p className="text-gray-500">No submissions yet.</p>
            </div>
          )}
        </motion.div>
      )}
    </div>
  );
};

// Modern grading form for teachers
const ModernGradeSubmissionForm = ({ submissionId, totalPoints, onGradeSubmit, defaultGrade, defaultFeedback }) => {
  const [grade, setGrade] = useState(defaultGrade || '');
  const [feedback, setFeedback] = useState(defaultFeedback || '');
  const [submitting, setSubmitting] = useState(false);

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (grade === '' || isNaN(grade) || grade < 0 || grade > totalPoints) {
      alert(`Grade must be a number between 0 and ${totalPoints}`);
      return;
    }
    setSubmitting(true);
    await onGradeSubmit(submissionId, grade, feedback);
    setSubmitting(false);
  };

  return (
    <motion.form
      onSubmit={handleSubmit}
      initial={{ opacity: 0, y: 10 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.4 }}
      className="flex flex-col gap-3 bg-white/80 border border-primary-100 rounded-xl shadow-card p-4 backdrop-blur-md"
    >
      <div className="flex items-center gap-2">
        <label className="font-semibold text-primary-600">Grade:</label>
        <input
          type="number"
          min={0}
          max={totalPoints}
          value={grade}
          onChange={e => setGrade(e.target.value)}
          className="w-20 px-2 py-1 border-2 border-primary-200 rounded-lg focus:ring-2 focus:ring-primary-300 focus:border-primary-400 transition-all bg-white/70 text-text-dark font-bold shadow-sm"
          required
        />
        <span className="text-gray-500">/ {totalPoints}</span>
      </div>
      <textarea
        value={feedback}
        onChange={e => setFeedback(e.target.value)}
        placeholder="Feedback (optional)"
        className="px-3 py-2 border-2 border-primary-100 rounded-lg resize-none focus:ring-2 focus:ring-primary-200 focus:border-primary-400 transition-all bg-white/70 text-text-dark shadow-sm"
        rows={2}
      />
      <button
        type="submit"
        className="bg-gradient-to-r from-primary-400 to-secondary-500 text-white px-4 py-2 rounded-lg font-bold shadow hover:scale-105 hover:from-primary-500 hover:to-secondary-600 transition-all duration-200"
        disabled={submitting}
      >
        {submitting ? 'Grading...' : 'Submit Grade'}
      </button>
    </motion.form>
  );
};

export default AssignmentDetails;


==================================================
FILE_PATH: client\src\pages\assignments\Assignments.js
==================================================
import React, { useState, useEffect, useContext } from 'react';
import { Link } from 'react-router-dom';
import { motion } from 'framer-motion';
import axios from 'axios';
import moment from 'moment';
import AuthContext from '../../context/AuthContext';
import {
  ClipboardCheckIcon,  // Changed from ClipboardDocumentCheckIcon
  SearchIcon,  // Changed from MagnifyingGlassIcon
  TrashIcon
} from '@heroicons/react/outline';

const Assignments = () => {
  const { user } = useContext(AuthContext);
  const [assignments, setAssignments] = useState([]);
  const [filteredAssignments, setFilteredAssignments] = useState([]);
  const [searchTerm, setSearchTerm] = useState('');
  const [loading, setLoading] = useState(true);
  const [filter, setFilter] = useState('all'); // 'all', 'pending', 'submitted', 'late', 'graded'
  
  const isTeacher = user?.role === 'teacher';
  const isStudent = user?.role === 'student';
  
  useEffect(() => {
    const fetchAssignments = async () => {
      try {
        const endpoint = isTeacher ? '/api/assignments/teacher' : '/api/assignments/student';
        const res = await axios.get(endpoint);
        
        const assignmentsWithCourseDetails = res.data.assignments;
        setAssignments(assignmentsWithCourseDetails);
        setFilteredAssignments(assignmentsWithCourseDetails);
        setLoading(false);
      } catch (error) {
        console.error('Error fetching assignments:', error);
        setLoading(false);
      }
    };
    
    fetchAssignments();
  }, [isTeacher]);
  
  // Filter assignments based on search term and filter
  useEffect(() => {
    let filtered = assignments;
    
    // Apply search filter
    if (searchTerm.trim() !== '') {
      filtered = filtered.filter(
        (assignment) =>
          assignment.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
          assignment.course?.title.toLowerCase().includes(searchTerm.toLowerCase())
      );
    }
    
    // Apply status filter for students
    if (isStudent) {
      if (filter === 'pending') {
        filtered = filtered.filter(assignment => {
          const submitted = assignment.submissions?.some(
            sub => sub.student === user._id
          );
          const deadlinePassed = new Date(assignment.deadline) < new Date();
          return !submitted && !deadlinePassed;
        });
      } else if (filter === 'submitted') {
        filtered = filtered.filter(assignment => 
          assignment.submissions?.some(
            sub => sub.student === user._id && !sub.graded
          )
        );
      } else if (filter === 'graded') {
        filtered = filtered.filter(assignment => 
          assignment.submissions?.some(
            sub => sub.student === user._id && sub.graded
          )
        );
      } else if (filter === 'late') {
        filtered = filtered.filter(assignment => {
          const submitted = assignment.submissions?.some(
            sub => sub.student === user._id
          );
          const deadlinePassed = new Date(assignment.deadline) < new Date();
          return !submitted && deadlinePassed;
        });
      }
    }
    // For teachers, filter by status
    else if (isTeacher) {
      if (filter === 'pending') {
        filtered = filtered.filter(assignment => 
          assignment.submissions?.some(sub => !sub.graded)
        );
      } else if (filter === 'graded') {
        filtered = filtered.filter(assignment => 
          assignment.submissions?.every(sub => sub.graded)
        );
      } else if (filter === 'upcoming') {
        filtered = filtered.filter(assignment => 
          new Date(assignment.deadline) > new Date()
        );
      } else if (filter === 'expired') {
        filtered = filtered.filter(assignment => 
          new Date(assignment.deadline) < new Date()
        );
      }
    }
    
    setFilteredAssignments(filtered);
  }, [searchTerm, filter, assignments, isStudent, isTeacher, user._id]);
  
  const getAssignmentStatus = (assignment) => {
    if (isStudent) {
      const submitted = assignment.submissions?.some(
        sub => sub.student === user._id
      );
      
      if (submitted) {
        const submission = assignment.submissions.find(
          sub => sub.student === user._id
        );
        
        if (submission?.graded) {
          return {
            label: 'Graded',
            color: 'bg-green-100 text-green-800'
          };
        } else {
          return {
            label: 'Submitted',
            color: 'bg-blue-100 text-blue-800'
          };
        }
      } else if (new Date(assignment.deadline) < new Date()) {
        return {
          label: 'Late',
          color: 'bg-red-100 text-red-800'
        };
      } else {
        return {
          label: 'Pending',
          color: 'bg-yellow-100 text-yellow-800'
        };
      }
    } else {
      // For teachers
      if (!assignment.submissions || assignment.submissions.length === 0) {
        return {
          label: 'No Submissions',
          color: 'bg-gray-100 text-gray-800'
        };
      } else if ((assignment.submissions || []).every(sub => sub.graded)) {
        return {
          label: 'All Graded',
          color: 'bg-green-100 text-green-800'
        };
      } else {
        return {
          label: `${(assignment.submissions || []).filter(sub => sub.graded).length}/${(assignment.submissions || []).length} Graded`,
          color: 'bg-blue-100 text-blue-800'
        };
      }
    }
  };
  
  const handleDeleteAssignment = async (assignmentId) => {
    if (!window.confirm('Are you sure you want to delete this assignment? This action cannot be undone.')) return;
    try {
      await axios.delete(`/api/assignments/${assignmentId}`);
      setAssignments(prev => prev.filter(a => a._id !== assignmentId));
    } catch (err) {
      alert('Failed to delete assignment.');
    }
  };
  
  if (loading) {
    return (
      <div className="flex justify-center items-center h-64">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"></div>
      </div>
    );
  }
  
  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-2xl font-bold text-gray-800">Assignments</h1>
        <p className="text-gray-600">
          {isTeacher ? 'Manage and grade assignments' : 'View and submit your assignments'}
        </p>
      </div>
      
      <div className="flex flex-col md:flex-row gap-4">
        {/* Search Bar */}
        <div className="relative flex-grow">
          <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <SearchIcon className="h-5 w-5 text-gray-400" />
          </div>
          <input
            type="text"
            className="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm"
            placeholder="Search assignments..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
          />
        </div>
        
        {/* Filter Dropdown */}
        <div>
          <select
            value={filter}
            onChange={(e) => setFilter(e.target.value)}
            className="block w-full px-3 py-2 border border-gray-300 rounded-md leading-5 bg-white focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm"
          >
            <option value="all">All Assignments</option>
            {isStudent ? (
              <>
                <option value="pending">Pending</option>
                <option value="submitted">Submitted</option>
                <option value="graded">Graded</option>
                <option value="late">Late/Missed</option>
              </>
            ) : (
              <>
                <option value="pending">Needs Grading</option>
                <option value="graded">All Graded</option>
                <option value="upcoming">Upcoming</option>
                <option value="expired">Deadline Passed</option>
              </>
            )}
          </select>
        </div>
      </div>
      
      {/* Assignments List */}
      <div className="space-y-4">
        {(filteredAssignments || []).length > 0 ? (
          (filteredAssignments || []).map((assignment, index) => {
            const status = getAssignmentStatus(assignment);
            const isPastDeadline = new Date(assignment.deadline) < new Date();
            
            return (
              <motion.div
                key={assignment._id}
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.3, delay: index * 0.05 }}
                className="bg-white rounded-lg shadow-md p-6"
              >
                <div className="sm:flex sm:justify-between sm:items-start">
                  <div>
                    <div className="flex items-center mb-2">
                      <h2 className="text-lg font-semibold text-gray-800 mr-3">
                        {assignment.title}
                      </h2>
                      <span className={`text-xs px-2 py-1 rounded-full ${status.color}`}>
                        {status.label}
                      </span>
                    </div>
                    
                    <p className="text-sm text-gray-600 mb-3">
                      Course: {assignment.course?.title || 'Unknown Course'}
                    </p>
                    
                    <div className="flex items-center text-xs text-gray-500 mb-4">
                      <ClipboardCheckIcon className="h-4 w-4 mr-1" />
                      <span className={isPastDeadline ? 'text-red-600 font-medium' : ''}>
                        Due: {moment(assignment.deadline).format('MMM D, YYYY [at] h:mm A')}
                      </span>
                      {isPastDeadline && (
                        <span className="ml-2 text-red-600 font-medium">
                          (Deadline passed)
                        </span>
                      )}
                    </div>
                  </div>
                  
                  <div className="mt-3 sm:mt-0 sm:ml-4">
                    <Link
                      to={`/assignments/${assignment._id}`}
                      className="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                    >
                      {isTeacher ? 'View & Grade' : 'View & Submit'}
                    </Link>
                  </div>
                </div>
                {isTeacher && (
                  <button
                    onClick={() => handleDeleteAssignment(assignment._id)}
                    className="ml-2 p-2 rounded-full hover:bg-red-100 text-red-600"
                    title="Delete Assignment"
                  >
                    <TrashIcon className="h-5 w-5" />
                  </button>
                )}
              </motion.div>
            );
          })
        ) : (
          <div className="text-center py-10 bg-white rounded-lg shadow-md">
            <p className="text-gray-500">No assignments found matching your criteria.</p>
          </div>
        )}
      </div>
    </div>
  );
};

export default Assignments;


==================================================
FILE_PATH: client\src\pages\auth\ForgotPassword.js
==================================================
import React, { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { toast } from 'react-toastify';
import { motion } from 'framer-motion';

const ForgotPassword = () => {
  const [email, setEmail] = useState('');
  const [loading, setLoading] = useState(false);
  const navigate = useNavigate();

  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    try {
      const res = await fetch('/api/auth/forgot-password', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email }),
      });
      const data = await res.json();
      if (data.success) {
        toast.success('Password reset link sent! Check your email or ask your admin.');
        navigate('/login');
      } else {
        toast.error(data.message || 'Failed to send reset link.');
      }
    } catch (err) {
      toast.error('Error sending reset link.');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
      <motion.div
        initial={{ opacity: 0, y: -20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.5 }}
        className="max-w-md w-full space-y-8 bg-white p-8 rounded-lg shadow-lg"
      >
        <div>
          <h1 className="text-center text-3xl font-bold text-gray-800">Forgot Password</h1>
          <p className="mt-2 text-center text-sm text-gray-600">Enter your email to receive a reset link.</p>
        </div>
        <form className="mt-8 space-y-6" onSubmit={handleSubmit}>
          <div className="rounded-md shadow-sm space-y-4">
            <div>
              <label htmlFor="email" className="sr-only">Email address</label>
              <input
                id="email"
                name="email"
                type="email"
                autoComplete="email"
                required
                value={email}
                onChange={e => setEmail(e.target.value)}
                className="appearance-none rounded-md relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm"
                placeholder="Email address"
              />
            </div>
          </div>
          <div>
            <button
              type="submit"
              disabled={loading}
              className="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200"
            >
              {loading ? 'Sending...' : 'Send Reset Link'}
            </button>
          </div>
        </form>
      </motion.div>
    </div>
  );
};

export default ForgotPassword; 

==================================================
FILE_PATH: client\src\pages\auth\Login.js
==================================================
import React, { useState, useContext, useEffect } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { motion } from 'framer-motion';
import AuthContext from '../../context/AuthContext';
import { toast } from 'react-toastify';

const Login = () => {
  const [formData, setFormData] = useState({
    email: '',
    password: '',
  });
  
  const { email, password } = formData;
  const navigate = useNavigate();
  const { login, isAuthenticated, user } = useContext(AuthContext);
  const [loading, setLoading] = useState(false);
  
  useEffect(() => {
    // Redirect if already logged in
    if (isAuthenticated) {
      if (user?.role === 'teacher') {
        navigate('/teacher/dashboard');
      } else {
        navigate('/student/dashboard');
      }
    }
  }, [isAuthenticated, navigate, user]);
  
  const onChange = (e) => {
    setFormData({ ...formData, [e.target.name]: e.target.value });
  };
  
  const onSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    try {
      const success = await login(formData);
      if (success) {
        toast.success('Login successful!');
        // Navigation will happen in useEffect
      } else {
        toast.error('Invalid credentials.');
      }
    } catch (err) {
      toast.error('Login failed.');
    } finally {
      setLoading(false);
    }
  };
  
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
      <motion.div
        initial={{ opacity: 0, y: -20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.5 }}
        className="max-w-md w-full space-y-8 bg-white p-8 rounded-lg shadow-lg"
      >
        <div>
          <h1 className="text-center text-3xl font-bold text-gray-800">
            Welcome Back!
          </h1>
          <p className="mt-2 text-center text-sm text-gray-600">
            Sign in to your account to continue
          </p>
        </div>
        
        <form className="mt-8 space-y-6" onSubmit={onSubmit}>
          <div className="rounded-md shadow-sm space-y-4">
            <div>
              <label htmlFor="email" className="sr-only">
                Email address
              </label>
              <input
                id="email"
                name="email"
                type="email"
                autoComplete="email"
                required
                value={email}
                onChange={onChange}
                className="appearance-none rounded-md relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm"
                placeholder="Email address"
              />
            </div>
            
            <div>
              <label htmlFor="password" className="sr-only">
                Password
              </label>
              <input
                id="password"
                name="password"
                type="password"
                autoComplete="current-password"
                required
                value={password}
                onChange={onChange}
                className="appearance-none rounded-md relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm"
                placeholder="Password"
              />
            </div>
          </div>
          
          <div className="flex items-center justify-between">
            <div className="flex items-center">
              <input
                id="remember_me"
                name="remember_me"
                type="checkbox"
                className="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"
              />
              <label htmlFor="remember_me" className="ml-2 block text-sm text-gray-900">
                Remember me
              </label>
            </div>
            
            <div className="text-sm">
              <Link to="/forgot-password" className="font-medium text-primary-600 hover:text-primary-500">
                Forgot your password?
              </Link>
            </div>
          </div>
          
          <div>
            <button
              type="submit"
              className="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200"
              disabled={loading}
            >
              {loading ? 'Signing in...' : 'Sign in'}
            </button>
          </div>
        </form>
        
        <div className="text-center">
          <p className="text-sm text-gray-600">
            Don't have an account?{' '}
            <Link to="/register" className="font-medium text-primary-600 hover:text-primary-500">
              Register here
            </Link>
          </p>
        </div>
      </motion.div>
    </div>
  );
};

export default Login;


==================================================
FILE_PATH: client\src\pages\auth\Register.js
==================================================
import React, { useState, useContext, useEffect } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { motion } from 'framer-motion';
import AuthContext from '../../context/AuthContext';
import zxcvbn from 'zxcvbn';
import { toast } from 'react-toastify';

const Register = () => {
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    password: '',
    confirmPassword: '',
    role: 'student',
  });
  
  const [passwordError, setPasswordError] = useState('');
  const { name, email, password, confirmPassword, role } = formData;
  const navigate = useNavigate();
  const { register, isAuthenticated, user } = useContext(AuthContext);
  
  const passwordStrength = zxcvbn(password);
  const strengthLabels = ['Very Weak', 'Weak', 'Fair', 'Good', 'Strong'];
  const strengthColors = ['bg-red-400', 'bg-orange-400', 'bg-yellow-400', 'bg-blue-400', 'bg-green-500'];
  
  const [loading, setLoading] = useState(false);
  
  useEffect(() => {
    // Redirect if already logged in
    if (isAuthenticated) {
      if (user?.role === 'teacher') {
        navigate('/teacher/dashboard');
      } else {
        navigate('/student/dashboard');
      }
    }
  }, [isAuthenticated, navigate, user]);
  
  const onChange = (e) => {
    setFormData({ ...formData, [e.target.name]: e.target.value });
    
    // Clear password error when user types
    if (e.target.name === 'password' || e.target.name === 'confirmPassword') {
      setPasswordError('');
    }
  };
  
  const onSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    // Validate password match
    if (password !== confirmPassword) {
      setPasswordError('Passwords do not match');
      setLoading(false);
      return;
    }
    const userData = {
      name,
      email,
      password,
      role,
    };
    try {
    const success = await register(userData);
    if (success) {
        toast.success('Registration successful!');
      // Navigation will happen in useEffect
      } else {
        toast.error('Registration failed.');
      }
    } catch (err) {
      toast.error('Registration failed.');
    } finally {
      setLoading(false);
    }
  };
  
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
      <motion.div
        initial={{ opacity: 0, y: -20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.5 }}
        className="max-w-md w-full space-y-8 bg-white p-8 rounded-lg shadow-lg"
      >
        <div>
          <h1 className="text-center text-3xl font-bold text-gray-800">
            Create an Account
          </h1>
          <p className="mt-2 text-center text-sm text-gray-600">
            Join our learning platform today
          </p>
        </div>
        
        <form className="mt-8 space-y-6" onSubmit={onSubmit}>
          <div className="rounded-md shadow-sm space-y-4">
            <div>
              <label htmlFor="name" className="sr-only">
                Full Name
              </label>
              <input
                id="name"
                name="name"
                type="text"
                autoComplete="name"
                required
                value={name}
                onChange={onChange}
                className="appearance-none rounded-md relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm"
                placeholder="Full Name"
              />
            </div>
            
            <div>
              <label htmlFor="email" className="sr-only">
                Email address
              </label>
              <input
                id="email"
                name="email"
                type="email"
                autoComplete="email"
                required
                value={email}
                onChange={onChange}
                className="appearance-none rounded-md relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm"
                placeholder="Email address"
              />
            </div>
            
            <div>
              <label htmlFor="password" className="sr-only">
                Password
              </label>
              <input
                id="password"
                name="password"
                type="password"
                autoComplete="new-password"
                required
                value={password}
                onChange={onChange}
                className="appearance-none rounded-md relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm"
                placeholder="Password"
                minLength="6"
              />
              {password && (
                <div className="mt-2">
                  <div className="w-full h-2 rounded bg-gray-200">
                    <div className={`h-2 rounded ${strengthColors[passwordStrength.score]}`} style={{ width: `${(passwordStrength.score + 1) * 20}%` }}></div>
                  </div>
                  <p className={`text-xs mt-1 ${passwordStrength.score < 2 ? 'text-red-500' : passwordStrength.score < 4 ? 'text-yellow-600' : 'text-green-600'}`}>{strengthLabels[passwordStrength.score]}</p>
                </div>
              )}
            </div>
            
            <div>
              <label htmlFor="confirmPassword" className="sr-only">
                Confirm Password
              </label>
              <input
                id="confirmPassword"
                name="confirmPassword"
                type="password"
                autoComplete="new-password"
                required
                value={confirmPassword}
                onChange={onChange}
                className={`appearance-none rounded-md relative block w-full px-3 py-3 border ${
                  passwordError ? 'border-red-300' : 'border-gray-300'
                } placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm`}
                placeholder="Confirm Password"
              />
              {passwordError && (
                <p className="text-red-500 text-xs mt-1">{passwordError}</p>
              )}
            </div>
            
            <div>
              <label htmlFor="role" className="block text-sm font-medium text-gray-700 mb-1">
                I am a
              </label>
              <select
                id="role"
                name="role"
                value={role}
                onChange={onChange}
                className="appearance-none rounded-md relative block w-full px-3 py-3 border border-gray-300 text-gray-900 focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm"
              >
                <option value="student">Student</option>
                <option value="teacher">Teacher</option>
              </select>
            </div>
          </div>
          
          <div>
            <button
              type="submit"
              className="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200"
              disabled={loading}
            >
              {loading ? 'Registering...' : 'Register'}
            </button>
          </div>
        </form>
        
        <div className="text-center">
          <p className="text-sm text-gray-600">
            Already have an account?{' '}
            <Link to="/login" className="font-medium text-primary-600 hover:text-primary-500">
              Sign in
            </Link>
          </p>
        </div>
      </motion.div>
    </div>
  );
};

export default Register;


==================================================
FILE_PATH: client\src\pages\auth\ResetPassword.js
==================================================
import React, { useState } from 'react';
import { useNavigate, useParams } from 'react-router-dom';
import { toast } from 'react-toastify';
import { motion } from 'framer-motion';

const ResetPassword = () => {
  const { token: urlToken } = useParams();
  const [token, setToken] = useState(urlToken || '');
  const [password, setPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');
  const [loading, setLoading] = useState(false);
  const navigate = useNavigate();

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (password !== confirmPassword) {
      toast.error('Passwords do not match');
      return;
    }
    setLoading(true);
    try {
      const res = await fetch('/api/auth/reset-password', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token, password }),
      });
      const data = await res.json();
      if (data.success) {
        toast.success('Password reset successfully!');
        navigate('/login');
      } else {
        toast.error(data.message || 'Failed to reset password.');
      }
    } catch (err) {
      toast.error('Error resetting password.');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
      <motion.div
        initial={{ opacity: 0, y: -20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.5 }}
        className="max-w-md w-full space-y-8 bg-white p-8 rounded-lg shadow-lg"
      >
        <div>
          <h1 className="text-center text-3xl font-bold text-gray-800">Reset Password</h1>
          <p className="mt-2 text-center text-sm text-gray-600">Enter your new password below.</p>
        </div>
        <form className="mt-8 space-y-6" onSubmit={handleSubmit}>
          <div className="rounded-md shadow-sm space-y-4">
            {!urlToken && (
              <div>
                <label htmlFor="token" className="sr-only">Reset Token</label>
                <input
                  id="token"
                  name="token"
                  type="text"
                  required
                  value={token}
                  onChange={e => setToken(e.target.value)}
                  className="appearance-none rounded-md relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm"
                  placeholder="Reset Token"
                />
              </div>
            )}
            <div>
              <label htmlFor="password" className="sr-only">New Password</label>
              <input
                id="password"
                name="password"
                type="password"
                required
                value={password}
                onChange={e => setPassword(e.target.value)}
                className="appearance-none rounded-md relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm"
                placeholder="New Password"
                minLength="6"
              />
            </div>
            <div>
              <label htmlFor="confirmPassword" className="sr-only">Confirm New Password</label>
              <input
                id="confirmPassword"
                name="confirmPassword"
                type="password"
                required
                value={confirmPassword}
                onChange={e => setConfirmPassword(e.target.value)}
                className="appearance-none rounded-md relative block w-full px-3 py-3 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm"
                placeholder="Confirm New Password"
                minLength="6"
              />
            </div>
          </div>
          <div>
            <button
              type="submit"
              disabled={loading}
              className="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200"
            >
              {loading ? 'Resetting...' : 'Reset Password'}
            </button>
          </div>
        </form>
      </motion.div>
    </div>
  );
};

export default ResetPassword; 

==================================================
FILE_PATH: client\src\pages\courses\CourseDetails.js
==================================================
import React, { useState, useEffect, useContext } from 'react';
import { useParams, Link, useNavigate } from 'react-router-dom';
import { motion } from 'framer-motion';
import axios from 'axios';
import { toast } from 'react-toastify';
import { Tab } from '@headlessui/react';
import moment from 'moment';
import AuthContext from '../../context/AuthContext';
import {
  PlusIcon,
  PencilIcon,
  TrashIcon,
  UserIcon,
  CalendarIcon,
  DocumentTextIcon,
  BookOpenIcon,
  AcademicCapIcon,
  ClipboardListIcon,
  BellIcon
} from '@heroicons/react/outline';

const BACKEND_URL = process.env.REACT_APP_BACKEND_URL || 'http://localhost:5000';

function classNames(...classes) {
  return classes.filter(Boolean).join(' ');
}

const CourseDetails = () => {
  const { id } = useParams();
  const navigate = useNavigate();
  const { user } = useContext(AuthContext);
  const [course, setCourse] = useState(null);
  const [students, setStudents] = useState([]);
  const [assignments, setAssignments] = useState([]);
  const [quizzes, setQuizzes] = useState([]);
  const [notices, setNotices] = useState([]);
  const [materials, setMaterials] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchCourseDetails = async () => {
      try {
        const res = await axios.get(`/api/courses/${id}`);
        setCourse(res.data.course);
        setStudents(res.data.students);
        setAssignments(res.data.assignments);
        setQuizzes(res.data.quizzes);
        setNotices(res.data.notices);
        setMaterials(res.data.materials);
        setLoading(false);
      } catch (err) {
        console.error(err);
        setLoading(false);
      }
    };

    fetchCourseDetails();
  }, [id]);

  const handleDeleteMaterial = async (materialId) => {
    if (window.confirm('Are you sure you want to delete this material?')) {
      try {
        await axios.delete(`/api/materials/${materialId}`);
        setMaterials(materials.filter((material) => material._id !== materialId));
      } catch (err) {
        console.error(err);
      }
    }
  };

  const handleDeleteAssignment = async (assignmentId) => {
    if (window.confirm('Are you sure you want to delete this assignment?')) {
      try {
        await axios.delete(`/api/assignments/${assignmentId}`);
        setAssignments(assignments.filter((assignment) => assignment._id !== assignmentId));
      } catch (err) {
        console.error(err);
      }
    }
  };

  const handleDeleteQuiz = async (quizId) => {
    if (window.confirm('Are you sure you want to delete this quiz?')) {
      try {
        const response = await axios.delete(`/api/quizzes/${quizId}`);
        
        if (response.data.success) {
          toast.success('Quiz deleted successfully!');
          setQuizzes(quizzes.filter((quiz) => quiz._id !== quizId));
        } else {
          toast.error('Failed to delete quiz');
        }
      } catch (error) {
        console.error('Error deleting quiz:', error);
        const errorMessage = error.response?.data?.message || 'Failed to delete quiz';
        toast.error(errorMessage);
      }
    }
  };

  const handleDeleteNotice = async (noticeId) => {
    if (window.confirm('Are you sure you want to delete this notice?')) {
      try {
        await axios.delete(`/api/notices/${noticeId}`);
        setNotices(notices.filter((notice) => notice._id !== noticeId));
      } catch (err) {
        console.error(err);
      }
    }
  };

  const handleDownload = async (fileName, originalName) => {
    const token = localStorage.getItem('token');
    try {
      const response = await axios.get(
        `${BACKEND_URL}/api/materials/download/${encodeURIComponent(fileName)}`,
        {
          responseType: 'blob',
          headers: { Authorization: `Bearer ${token}` }
        }
      );
      const url = window.URL.createObjectURL(new Blob([response.data]));
      const link = document.createElement('a');
      link.href = url;
      link.setAttribute('download', originalName || fileName);
      document.body.appendChild(link);
      link.click();
      link.remove();
      window.URL.revokeObjectURL(url);
    } catch (error) {
      alert('Download failed: ' + (error.response?.data?.message || error.message));
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center h-screen">
        <div className="animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-primary-600"></div>
      </div>
    );
  }

  if (!course) {
    return (
      <div className="max-w-7xl mx-auto py-10 px-4 sm:px-6 lg:px-8">
        <div className="bg-white shadow rounded-lg p-6">
          <h2 className="text-2xl font-bold text-gray-900 mb-4">Course not found</h2>
          <p className="text-gray-700 mb-4">The course you are looking for does not exist.</p>
          <div className="flex">
            <Link
              to="/"
              className="inline-flex items-center px-4 py-2 bg-primary-600 border border-transparent rounded-md font-medium text-sm text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
            >
              Go to Homepage
            </Link>
          </div>
        </div>
      </div>
    );
  }

  // Fix for Line 350:30 error - define isTeacher
  const isTeacher = user?.role === 'teacher';
  const isStudent = user?.role === 'student';
  const isCourseTeacher = isTeacher && course?.teacher?._id === user?._id;

  return (
    <div className="max-w-7xl mx-auto py-10 px-4 sm:px-6 lg:px-8 bg-neutral-50 min-h-screen">
      <motion.div initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className="bg-white/90 shadow-card rounded-2xl p-8 mb-8 border border-primary-50 backdrop-blur-md">
        <h2 className="text-3xl font-extrabold font-heading text-primary-400 mb-2 drop-shadow-lg tracking-tight bg-gradient-to-r from-primary-400 to-secondary-500 bg-clip-text text-transparent">
          {course.title}
        </h2>
        <p className="text-lg text-text-medium mb-4">{course.description}</p>
        <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 gap-4">
          <div className="flex items-center bg-white/80 border border-primary-100 rounded-xl shadow px-4 py-2 backdrop-blur-md">
            <img
              src={course.teacher?.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(course.teacher?.name || 'T')}`}
              alt={course.teacher?.name}
              className="h-12 w-12 rounded-full mr-3 border-2 border-primary-400 shadow"
            />
            <div>
              <div className="flex items-center gap-2">
                <span className="font-semibold text-text-dark">{course.teacher?.name}</span>
                {isCourseTeacher && (
                  <span className="ml-1 px-2 py-0.5 text-xs bg-primary-100 text-primary-800 rounded-full border border-primary-400">You</span>
                )}
              </div>
              <span className="text-xs text-text-medium">{course.teacher?.email}</span>
              <div className="text-xs text-text-medium">Instructor</div>
            </div>
          </div>
          <div className="flex gap-2">
            <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-primary-100 text-primary-700 border border-primary-400 shadow">{course.category || 'General'}</span>
            <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-secondary-50 text-secondary-500 border border-secondary-400 shadow">{course.level || 'All Levels'}</span>
            <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-accent-yellow text-text-dark border border-accent-yellow shadow">{course.language || 'Language'}</span>
          </div>
        </div>
        {/* Info Grid */}
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.1 }} className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
          <div className="bg-white/80 p-4 rounded-xl border border-primary-50 flex flex-col items-start shadow-card">
            <span className="text-xs text-text-medium mb-1">Start Date</span>
            <span className="font-semibold text-text-dark">{moment(course.startDate).format('MMMM D, YYYY')}</span>
          </div>
          <div className="bg-white/80 p-4 rounded-xl border border-primary-50 flex flex-col items-start shadow-card">
            <span className="text-xs text-text-medium mb-1">End Date</span>
            <span className="font-semibold text-text-dark">{moment(course.endDate).format('MMMM D, YYYY')}</span>
          </div>
          <div className="bg-white/80 p-4 rounded-xl border border-primary-50 flex flex-col items-start shadow-card">
            <span className="text-xs text-text-medium mb-1">Enrollment Deadline</span>
            <span className="font-semibold text-text-dark">{moment(course.enrollmentDeadline).format('MMMM D, YYYY')}</span>
          </div>
          <div className="bg-white/80 p-4 rounded-xl border border-primary-50 flex flex-col items-start shadow-card">
            <span className="text-xs text-text-medium mb-1">Students Enrolled</span>
            <span className="font-semibold text-text-dark">{students.length}</span>
          </div>
          <div className="bg-white/80 p-4 rounded-xl border border-primary-50 flex flex-col items-start shadow-card">
            <span className="text-xs text-text-medium mb-1">Assignments</span>
            <span className="font-semibold text-text-dark">{assignments.length}</span>
          </div>
          <div className="bg-white/80 p-4 rounded-xl border border-primary-50 flex flex-col items-start shadow-card">
            <span className="text-xs text-text-medium mb-1">Quizzes</span>
            <span className="font-semibold text-text-dark">{quizzes.length}</span>
          </div>
          <div className="bg-white/80 p-4 rounded-xl border border-primary-50 flex flex-col items-start shadow-card">
            <span className="text-xs text-text-medium mb-1">Materials</span>
            <span className="font-semibold text-text-dark">{materials.length}</span>
          </div>
          <div className="bg-white/80 p-4 rounded-xl border border-primary-50 flex flex-col items-start shadow-card">
            <span className="text-xs text-text-medium mb-1">Notices</span>
            <span className="font-semibold text-text-dark">{notices.length}</span>
          </div>
        </motion.div>
        {/* Description */}
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.2 }} className="prose max-w-none text-text-dark bg-white/90 p-6 rounded-xl border border-primary-50 shadow-card">
          <h3 className="text-xl font-bold mb-2">About this course</h3>
          <p>{course.description}</p>
        </motion.div>
      </motion.div>

      <Tab.Group>
        <Tab.List className="sticky top-4 z-10 flex space-x-2 rounded-2xl bg-white/70 shadow-card backdrop-blur-md p-2 mb-8 border border-primary-50">
          <Tab className={({ selected }) => `flex-1 flex flex-col items-center py-3 px-2 rounded-xl font-bold text-sm transition-all duration-200 ${selected ? 'bg-gradient-to-r from-primary-400 to-secondary-500 text-white shadow-lg scale-105' : 'text-primary-700 hover:bg-primary-100/60'}`}>
            <BookOpenIcon className="h-5 w-5 mb-1" /> Overview
          </Tab>
          <Tab className={({ selected }) => `flex-1 flex flex-col items-center py-3 px-2 rounded-xl font-bold text-sm transition-all duration-200 ${selected ? 'bg-gradient-to-r from-primary-400 to-secondary-500 text-white shadow-lg scale-105' : 'text-primary-700 hover:bg-primary-100/60'}`}>
            <DocumentTextIcon className="h-5 w-5 mb-1" /> Materials
          </Tab>
          <Tab className={({ selected }) => `flex-1 flex flex-col items-center py-3 px-2 rounded-xl font-bold text-sm transition-all duration-200 ${selected ? 'bg-gradient-to-r from-primary-400 to-secondary-500 text-white shadow-lg scale-105' : 'text-primary-700 hover:bg-primary-100/60'}`}>
            <ClipboardListIcon className="h-5 w-5 mb-1" /> Assignments
          </Tab>
          <Tab className={({ selected }) => `flex-1 flex flex-col items-center py-3 px-2 rounded-xl font-bold text-sm transition-all duration-200 ${selected ? 'bg-gradient-to-r from-primary-400 to-secondary-500 text-white shadow-lg scale-105' : 'text-primary-700 hover:bg-primary-100/60'}`}>
            <AcademicCapIcon className="h-5 w-5 mb-1" /> Quizzes
          </Tab>
          <Tab className={({ selected }) => `flex-1 flex flex-col items-center py-3 px-2 rounded-xl font-bold text-sm transition-all duration-200 ${selected ? 'bg-gradient-to-r from-primary-400 to-secondary-500 text-white shadow-lg scale-105' : 'text-primary-700 hover:bg-primary-100/60'}`}>
            <BellIcon className="h-5 w-5 mb-1" /> Notices
          </Tab>
        </Tab.List>
        <Tab.Panels>
          <Tab.Panel className="p-6">
            {/* Modern Course Overview Header */}
            <div className="flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4">
              <div>
                <h2 className="text-3xl font-extrabold text-gray-900 mb-1">{course.title}</h2>
                <p className="text-lg text-gray-600 mb-2">{course.subtitle || course.description?.substring(0, 80) + (course.description?.length > 80 ? '...' : '')}</p>
                <div className="flex items-center gap-2">
                  <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                    {course.category || 'General'}
                  </span>
                  <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    {course.level || 'All Levels'}
                  </span>
                  <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                    {course.language || 'Language'}</span>
                </div>
              </div>
              {/* Instructor Card */}
              <div className="flex items-center bg-white border border-gray-200 rounded-lg shadow px-4 py-2">
                <img
                  src={course.teacher?.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(course.teacher?.name || 'T')}`}
                  alt={course.teacher?.name}
                  className="h-12 w-12 rounded-full mr-3 border"
                />
                <div>
                  <div className="flex items-center gap-2">
                    <span className="font-semibold text-gray-800">{course.teacher?.name}</span>
                    {isCourseTeacher && (
                      <span className="ml-1 px-2 py-0.5 text-xs bg-primary-100 text-primary-800 rounded-full">You</span>
                    )}
                  </div>
                  <span className="text-xs text-gray-500">{course.teacher?.email}</span>
                  <div className="text-xs text-gray-400">Instructor</div>
                </div>
              </div>
            </div>
            {/* Course Info Grid */}
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
              <div className="bg-gray-50 p-4 rounded-lg border border-gray-200 flex flex-col items-start">
                <span className="text-xs text-gray-500 mb-1">Start Date</span>
                <span className="font-semibold text-gray-800">{moment(course.startDate).format('MMMM D, YYYY')}</span>
              </div>
              <div className="bg-gray-50 p-4 rounded-lg border border-gray-200 flex flex-col items-start">
                <span className="text-xs text-gray-500 mb-1">End Date</span>
                <span className="font-semibold text-gray-800">{moment(course.endDate).format('MMMM D, YYYY')}</span>
              </div>
              <div className="bg-gray-50 p-4 rounded-lg border border-gray-200 flex flex-col items-start">
                <span className="text-xs text-gray-500 mb-1">Enrollment Deadline</span>
                <span className="font-semibold text-gray-800">{moment(course.enrollmentDeadline).format('MMMM D, YYYY')}</span>
              </div>
              <div className="bg-gray-50 p-4 rounded-lg border border-gray-200 flex flex-col items-start">
                <span className="text-xs text-gray-500 mb-1">Students Enrolled</span>
                <span className="font-semibold text-gray-800">{students.length}</span>
              </div>
              <div className="bg-gray-50 p-4 rounded-lg border border-gray-200 flex flex-col items-start">
                <span className="text-xs text-gray-500 mb-1">Assignments</span>
                <span className="font-semibold text-gray-800">{assignments.length}</span>
              </div>
              <div className="bg-gray-50 p-4 rounded-lg border border-gray-200 flex flex-col items-start">
                <span className="text-xs text-gray-500 mb-1">Quizzes</span>
                <span className="font-semibold text-gray-800">{quizzes.length}</span>
              </div>
              <div className="bg-gray-50 p-4 rounded-lg border border-gray-200 flex flex-col items-start">
                <span className="text-xs text-gray-500 mb-1">Materials</span>
                <span className="font-semibold text-gray-800">{materials.length}</span>
              </div>
              <div className="bg-gray-50 p-4 rounded-lg border border-gray-200 flex flex-col items-start">
                <span className="text-xs text-gray-500 mb-1">Notices</span>
                <span className="font-semibold text-gray-800">{notices.length}</span>
              </div>
            </div>
            {/* Course Description */}
            <div className="prose max-w-none text-gray-700 bg-white p-6 rounded-lg border border-gray-100 shadow">
              <h3 className="text-xl font-bold mb-2">About this course</h3>
              <p>{course.description}</p>
            </div>
          </Tab.Panel>

          {/* Materials Tab */}
          <Tab.Panel className="p-6">
            {isCourseTeacher && (
              <div className="mb-4">
                <Link
                  to={`/teacher/materials/create/${course._id}`}
                  className="inline-flex items-center px-4 py-2 bg-primary-600 border border-transparent rounded-md font-medium text-sm text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                >
                  <PlusIcon className="h-4 w-4 mr-2" /> Add Material
                </Link>
              </div>
            )}
            
            <div className="space-y-4">
              {materials.length > 0 ? (
                materials.map((material) => (
                  <motion.div
                    key={material._id}
                    initial={{ opacity: 0, y: 10 }}
                    animate={{ opacity: 1, y: 0 }}
                    className="bg-gray-50 p-4 rounded-lg border border-gray-200"
                  >
                    <div className="flex justify-between items-start">
                      <div>
                        <h3 className="font-medium text-gray-800">{material.title}</h3>
                        <p className="text-sm text-gray-600 mt-1">{material.description}</p>
                        <p className="text-xs text-gray-500 mt-2">
                          Added: {moment(material.createdAt).format('MMMM D, YYYY')}
                        </p>
                      </div>
                      <div className="flex">
                        <button
                          onClick={() => handleDownload(material.fileName, material.originalName)}
                          className="px-3 py-1 text-xs rounded-md text-white bg-primary-600 hover:bg-primary-700"
                        >
                          Download {material.originalName || material.fileName}
                        </button>

                        {isCourseTeacher && (
                          <button
                            className="ml-2 text-gray-500 hover:text-red-600"
                            onClick={() => handleDeleteMaterial(material._id)}
                          >
                            <TrashIcon className="h-4 w-4" />
                          </button>
                        )}
                      </div>
                    </div>
                  </motion.div>
                ))
              ) : (
                <div className="text-center py-8">
                  <p className="text-gray-500">No materials available for this course yet.</p>
                </div>
              )}
            </div>
          </Tab.Panel>

          {/* Assignments Tab */}
          <Tab.Panel className="p-6">
            {isCourseTeacher && (
              <div className="mb-4">
                <Link
                  to={`/teacher/assignments/create/${course._id}`}
                  className="inline-flex items-center px-4 py-2 bg-primary-600 border border-transparent rounded-md font-medium text-sm text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                >
                  <PlusIcon className="h-4 w-4 mr-2" /> Add Assignment
                </Link>
              </div>
            )}
            
            <div className="space-y-4">
              {assignments.length > 0 ? (
                assignments.map((assignment) => (
                  <motion.div
                    key={assignment._id}
                    initial={{ opacity: 0, y: 10 }}
                    animate={{ opacity: 1, y: 0 }}
                    className="bg-gray-50 p-4 rounded-lg border border-gray-200"
                  >
                    <div className="flex justify-between items-start">
                      <div>
                        <h3 className="font-medium text-gray-800">{assignment.title}</h3>
                        <p className="text-sm text-gray-600 mt-1">
                          {assignment.description.substring(0, 100)}
                          {assignment.description.length > 100 && '...'}
                        </p>
                        <div className="flex items-center text-xs text-gray-500 mt-2 space-x-4">
                          <span className="flex items-center">
                            Due: {moment(assignment.deadline).format('MMM D, YYYY')}
                          </span>
                          <span>Points: {assignment.totalPoints}</span>
                          <span>
                            Submissions: {assignment.submissions?.length || 0}
                          </span>
                        </div>
                      </div>
                      <div className="flex">
                        <Link
                          to={`/assignments/${assignment._id}`}
                          className="px-3 py-1 text-xs rounded-md text-white bg-primary-600 hover:bg-primary-700"
                        >
                          View Details
                        </Link>

                        {isCourseTeacher && (
                          <button
                            className="ml-2 text-gray-500 hover:text-red-600"
                            onClick={() => handleDeleteAssignment(assignment._id)}
                          >
                            <TrashIcon className="h-4 w-4" />
                          </button>
                        )}
                      </div>
                    </div>
                  </motion.div>
                ))
              ) : (
                <div className="text-center py-8">
                  <p className="text-gray-500">No assignments available for this course yet.</p>
                </div>
              )}
            </div>
          </Tab.Panel>

          {/* Quizzes Tab */}
          <Tab.Panel className="p-6">
            {isCourseTeacher && (
              <div className="mb-4">
                <Link
                  to={`/teacher/quizzes/create/${course._id}`}
                  className="inline-flex items-center px-4 py-2 bg-primary-600 border border-transparent rounded-md font-medium text-sm text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                >
                  <PlusIcon className="h-4 w-4 mr-2" /> Add Quiz
                </Link>
              </div>
            )}
            
            <div className="space-y-4">
              {quizzes.length > 0 ? (
                quizzes.map((quiz) => {
                  const isCompleted = isStudent && quiz.results?.some(
                    result => result.student.toString() === user._id
                  );
                  
                  return (
                    <motion.div
                      key={quiz._id}
                      initial={{ opacity: 0, y: 10 }}
                      animate={{ opacity: 1, y: 0 }}
                      className="bg-gray-50 p-4 rounded-lg border border-gray-200"
                    >
                      <div className="flex justify-between items-start">
                        <div>
                          <h3 className="font-medium text-gray-800">{quiz.title}</h3>
                          <p className="text-sm text-gray-600 mt-1">
                            {quiz.description.substring(0, 100)}
                            {quiz.description.length > 100 && '...'}
                          </p>
                          <div className="flex items-center text-xs text-gray-500 mt-2 space-x-4">
                            <span>Questions: {quiz.questions?.length || 0}</span>
                            <span>Time Limit: {quiz.timeLimit || 'No limit'} minutes</span>
                            {quiz.availableFrom && (
                              <span>Available from: {moment(quiz.availableFrom).format('MMM D')}</span>
                            )}
                            {quiz.availableTo && (
                              <span>Available until: {moment(quiz.availableTo).format('MMM D')}</span>
                            )}
                          </div>
                        </div>
                        <div className="flex">
                          {isTeacher ? (
                            <Link
                              to={`/quizzes/${quiz._id}`}
                              className="px-3 py-1 text-xs rounded-md text-white bg-primary-600 hover:bg-primary-700"
                            >
                              View Results
                            </Link>
                          ) : isCompleted ? (
                            <span className="px-3 py-1 text-xs rounded-md bg-green-100 text-green-800">
                              Completed
                            </span>
                          ) : (
                            <Link
                              to={`/quizzes/${quiz._id}/take`}
                              className="px-3 py-1 text-xs rounded-md text-white bg-primary-600 hover:bg-primary-700"
                            >
                              Take Quiz
                            </Link>
                          )}

                          {isCourseTeacher && (
                            <button
                              className="ml-2 text-gray-500 hover:text-red-600"
                              onClick={() => handleDeleteQuiz(quiz._id)}
                            >
                              <TrashIcon className="h-4 w-4" />
                            </button>
                          )}
                        </div>
                      </div>
                    </motion.div>
                  );
                })
              ) : (
                <div className="text-center py-8">
                  <p className="text-gray-500">No quizzes available for this course yet.</p>
                </div>
              )}
            </div>
          </Tab.Panel>

          {/* Notices Tab */}
          <Tab.Panel className="p-6">
            {isCourseTeacher && (
              <div className="mb-4">
                <Link
                  to={`/teacher/notices/create/${course._id}`}
                  className="inline-flex items-center px-4 py-2 bg-primary-600 border border-transparent rounded-md font-medium text-sm text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                >
                  <PlusIcon className="h-4 w-4 mr-2" /> Add Notice
                </Link>
              </div>
            )}
            
            <div className="space-y-4">
              {notices.length > 0 ? (
                notices.map((notice) => (
                  <motion.div
                    key={notice._id}
                    initial={{ opacity: 0, y: 10 }}
                    animate={{ opacity: 1, y: 0 }}
                    className={`p-4 rounded-lg border ${
                      notice.priority === 'high'
                        ? 'bg-red-50 border-red-200'
                        : notice.priority === 'medium'
                        ? 'bg-yellow-50 border-yellow-200'
                        : 'bg-gray-50 border-gray-200'
                    }`}
                  >
                    <div className="flex justify-between items-start">
                      <div>
                        <div className="flex items-center">
                          <h3 className="font-medium text-gray-800">{notice.title}</h3>
                          {notice.pinned && (
                            <span className="ml-2 px-2 py-0.5 text-xs bg-blue-100 text-blue-800 rounded-full">
                              Pinned
                            </span>
                          )}
                          <span
                            className={`ml-2 px-2 py-0.5 text-xs rounded-full ${
                              notice.priority === 'high'
                                ? 'bg-red-100 text-red-800'
                                : notice.priority === 'medium'
                                ? 'bg-yellow-100 text-yellow-800'
                                : 'bg-green-100 text-green-800'
                            }`}
                          >
                            {notice.priority.charAt(0).toUpperCase() + notice.priority.slice(1)} Priority
                          </span>
                        </div>
                        <p className="text-sm text-gray-600 mt-1">{notice.content}</p>
                        <p className="text-xs text-gray-500 mt-2">
                          Posted: {moment(notice.createdAt).format('MMMM D, YYYY')} by {notice.author.name}
                        </p>
                      </div>
                      {isCourseTeacher && (
                        <button
                          className="text-gray-500 hover:text-red-600"
                          onClick={() => handleDeleteNotice(notice._id)}
                        >
                          <TrashIcon className="h-4 w-4" />
                        </button>
                      )}
                    </div>
                  </motion.div>
                ))
              ) : (
                <div className="text-center py-8">
                  <p className="text-gray-500">No notices available for this course yet.</p>
                </div>
              )}
            </div>
          </Tab.Panel>
        </Tab.Panels>
      </Tab.Group>
    </div>
  );
};

export default CourseDetails;

==================================================
FILE_PATH: client\src\pages\courses\Courses.js
==================================================
// src/pages/courses/Courses.js (THAY THẾ HOÀN TOÀN FILE CŨ)
import React, { useState, useEffect, useContext } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { motion } from 'framer-motion';
import axios from 'axios';
import { toast } from 'react-toastify';
import AuthContext from '../../context/AuthContext';
import { PlusCircleIcon, PencilIcon, TrashIcon } from '@heroicons/react/outline';

const Courses = () => {
  const { user } = useContext(AuthContext);
  const navigate = useNavigate();
  const [courses, setCourses] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchAllCourses();
  }, []);

  const fetchAllCourses = async () => {
    try {
      const token = localStorage.getItem('token');
      const res = await axios.get('/api/courses', {
        headers: { Authorization: `Bearer ${token}` }
      });
      setCourses(res.data.courses || []);
    } catch (err) {
      toast.error('Không tải được danh sách khóa học');
      console.error(err);
    } finally {
      setLoading(false);
    }
  };

  const handleDelete = async (id) => {
    if (!window.confirm('Xóa khóa học này? Toàn bộ dữ liệu sẽ mất!')) return;
    try {
      const token = localStorage.getItem('token');
      await axios.delete(`/api/courses/${id}`, {
        headers: { Authorization: `Bearer ${token}` }
      });
      toast.success('Xóa khóa học thành công!');
      setCourses(courses.filter(c => c._id !== id));
    } catch (err) {
      toast.error('Không thể xóa khóa học');
    }
  };

  if (loading) return <div className="text-center py-20 text-xl">Đang tải...</div>;

  return (
    <div className="max-w-7xl mx-auto py-10 px-4">
      <div className="flex justify-between items-center mb-10">
        <h1 className="text-4xl font-bold text-gray-900">
          {user?.role === 'teacher' ? 'Quản Lý Tất Cả Khóa Học' : 'Danh Sách Khóa Học'}
        </h1>
        {user?.role === 'teacher' && (
          <Link
            to="/teacher/create-course"
            className="flex items-center gap-3 bg-gradient-to-r from-primary-600 to-secondary-600 text-white px-6 py-3 rounded-xl hover:shadow-xl transition font-semibold"
          >
            <PlusCircleIcon className="w-6 h-6" />
            Tạo Khóa Học Mới
          </Link>
        )}
      </div>

      {courses.length === 0 ? (
        <div className="text-center py-20 bg-white rounded-2xl shadow">
          <p className="text-2xl text-gray-500">Chưa có khóa học nào</p>
        </div>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
          {courses.map((course) => (
            <motion.div
              key={course._id}
              whileHover={{ scale: 1.03 }}
              className="bg-white rounded-2xl shadow-lg overflow-hidden border border-gray-100"
            >
              <div
                className="h-48 bg-cover bg-center"
                style={{
                  backgroundImage: `url(${course.coverImageUrl || '/img/default-course.jpg'})`
                }}
              />
              <div className="p-5">
                <h3 className="text-xl font-bold text-gray-900 mb-2 line-clamp-1">{course.title}</h3>
                <p className="text-sm text-gray-600 mb-3">Mã: <strong>{course.code}</strong></p>
                <p className="text-sm text-gray-600 mb-4">GV: {course.teacher?.name || 'N/A'}</p>

                <div className="flex justify-between items-center">
                  <Link
                    to={`/courses/${course._id}`}
                    className="text-primary-600 font-medium hover:underline"
                  >
                    Xem chi tiết
                  </Link>

                  {user?.role === 'teacher' && (
                    <div className="flex gap-3">
                      <Link
                        to={`/teacher/edit-course/${course._id}`}
                        className="text-blue-600 hover:text-blue-800"
                        title="Sửa"
                      >
                        <PencilIcon className="w-5 h-5" />
                      </Link>
                      <button
                        onClick={() => handleDelete(course._id)}
                        className="text-red-600 hover:text-red-800"
                        title="Xóa"
                      >
                        <TrashIcon className="w-5 h-5" />
                      </button>
                    </div>
                  )}
                </div>
              </div>
            </motion.div>
          ))}
        </div>
      )}
    </div>
  );
};

export default Courses;

==================================================
FILE_PATH: client\src\pages\dashboard\Dashboard.js
==================================================
import React, { useContext } from 'react';
import TeacherDashboard from './TeacherDashboard';
import StudentDashboard from './StudentDashboard';
import AuthContext from '../../context/AuthContext';
// If using any Heroicons, update imports to v2 format
import { UserIcon } from '@heroicons/react/24/outline';
import { motion } from 'framer-motion';

const Dashboard = () => {
  const { user } = useContext(AuthContext);

  return (
    <div className="min-h-screen bg-gray-100">
      <div className="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
        <h1 className="text-3xl font-bold text-gray-900 mb-6">Dashboard</h1>
        <div className="bg-white shadow rounded-lg p-6">
          <div className="flex items-center mb-4">
            <UserIcon className="h-10 w-10 text-gray-500 mr-4" aria-hidden="true" />
            <h2 className="text-xl font-semibold text-gray-800">
              Welcome, {user ? user.name : 'Guest'}
            </h2>
          </div>
          {user ? (
            user.role === 'teacher' ? (
              <TeacherDashboard />
            ) : (
              <StudentDashboard />
            )
          ) : (
            <p className="text-gray-600">
              Please log in to access your dashboard.
            </p>
          )}
        </div>
      </div>
    </div>
  );
};

export default Dashboard;

==================================================
FILE_PATH: client\src\pages\dashboard\StudentDashboard.js
==================================================
// Updated imports for Heroicons v2
import {
  BookOpenIcon,
  ClipboardDocumentCheckIcon,
  DocumentTextIcon,
  AcademicCapIcon,
  BellIcon,
  ClockIcon,
  CheckCircleIcon,
  ExclamationCircleIcon,
  ChartBarIcon
} from '@heroicons/react/24/outline';

import React, { useState, useEffect, useContext } from 'react';
import { Link } from 'react-router-dom';
import axios from 'axios';
import moment from 'moment';
import AuthContext from '../../context/AuthContext';
import { motion } from 'framer-motion';

const StudentDashboard = () => {
  const { user, logout } = useContext(AuthContext);
  const [courses, setCourses] = useState([]);
  const [assignments, setAssignments] = useState([]);
  const [quizzes, setQuizzes] = useState([]);
  const [quizResults, setQuizResults] = useState([]);
  const [notices, setNotices] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchDashboard = async () => {
      try {
        const token = localStorage.getItem('token');
        const res = await axios.get('/api/users/me/dashboard', {
          headers: { Authorization: `Bearer ${token}` }
        });
        if (res.data.success) {
          setCourses(res.data.courses || []);
          setAssignments(res.data.assignments || []);
          setQuizzes(res.data.quizzes || []);
          setQuizResults(res.data.quizResults || []);
          setNotices(res.data.notices || []);
        }
      } catch (error) {
        console.error('Error fetching dashboard data:', error);
      } finally {
        setLoading(false);
      }
    };
    fetchDashboard();
  }, []);

  // After fetching assignments, quizzes, quizResults, etc. from backend:
  // Mark assignments as submitted if the student has a submission
  const userId = user?._id;
  const assignmentsWithStatus = assignments.map(a => ({
    ...a,
    submitted: a.submissions && Array.isArray(a.submissions)
      ? a.submissions.some(sub => sub.student?.toString() === userId)
      : false
  }));
  // Mark quizzes as completed if the student has a quiz result
  const quizIdsWithResults = new Set((quizResults || []).map(qr => qr.quizId?.toString()));
  const quizzesWithStatus = quizzes.map(q => ({
    ...q,
    completed: quizIdsWithResults.has(q._id?.toString())
  }));

  // Defensive: always ensure assignments is an array
  const safeAssignments = Array.isArray(assignmentsWithStatus) ? assignmentsWithStatus : [];

  if (loading) {
    return (
      <div className="flex justify-center items-center h-64">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"></div>
      </div>
    );
  }

  return (
    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 bg-neutral-50 min-h-screen">
      {/* Header */}
      <motion.div initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8">
        <div className="flex items-center gap-4">
          <img
            src={`https://ui-avatars.com/api/?name=${encodeURIComponent(user?.name || 'S')}`}
            alt={user?.name}
            className="h-12 w-12 rounded-full border-2 border-primary-400 shadow"
          />
          <div>
            <h1 className="text-2xl font-extrabold font-heading text-text-dark">Welcome, {user?.name}</h1>
            <p className="text-text-medium mt-1">Your learning dashboard</p>
          </div>
        </div>
        <div className="mt-4 sm:mt-0 flex space-x-3">
          <Link
            to="/courses"
            className="inline-flex items-center px-4 py-2 border border-primary-100 shadow-sm text-base font-semibold rounded-xl text-primary-500 bg-white/80 hover:bg-primary-50 transition-all"
          >
            Explore Courses
          </Link>
          <button
            onClick={logout}
            className="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-base font-semibold rounded-xl text-white bg-action-red hover:bg-action-orange transition-all"
          >
            Logout
          </button>
        </div>
      </motion.div>
      {/* Stats Grid */}
      <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.1 }} className="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-8">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.2 }} className="bg-white/90 shadow-card rounded-2xl p-6 flex flex-col items-center border border-primary-50 hover:shadow-card-hover transition-all">
          <AcademicCapIcon className="h-8 w-8 text-primary-400 mb-2" />
          <div className="text-3xl font-extrabold text-text-dark">{courses?.length || 0}</div>
          <div className="text-text-medium mt-1">Enrolled Courses</div>
        </motion.div>
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.3 }} className="bg-white/90 shadow-card rounded-2xl p-6 flex flex-col items-center border border-primary-50 hover:shadow-card-hover transition-all">
          <ClipboardDocumentCheckIcon className="h-8 w-8 text-accent-green mb-2" />
          <div className="text-3xl font-extrabold text-text-dark">{quizResults?.length || 0}</div>
          <div className="text-text-medium mt-1">Completed Quizzes</div>
        </motion.div>
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.4 }} className="bg-white/90 shadow-card rounded-2xl p-6 flex flex-col items-center border border-primary-50 hover:shadow-card-hover transition-all">
          <DocumentTextIcon className="h-8 w-8 text-accent-yellow mb-2" />
          <div className="text-3xl font-extrabold text-text-dark">{safeAssignments.filter(a => !a.submitted).length}</div>
          <div className="text-text-medium mt-1">Pending Assignments</div>
        </motion.div>
      </motion.div>
      {/* My Courses */}
      <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.5 }} className="bg-white/90 shadow-card rounded-2xl mb-8 border border-primary-50">
        <div className="px-4 py-5 sm:px-6 flex justify-between items-center">
          <h3 className="text-lg font-bold text-text-dark">My Courses</h3>
          <Link to="/courses" className="text-base text-primary-500 hover:text-secondary-500 font-semibold">View all</Link>
        </div>
        <div className="border-t border-neutral-50">
          {courses.length > 0 ? (
            <ul className="divide-y divide-neutral-50">
              {courses.slice(0, 5).map((course, idx) => (
                <motion.li key={course._id} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 + idx * 0.05 }} className="px-4 py-4 sm:px-6 hover:bg-primary-50/60 flex justify-between items-center rounded-xl transition-all">
                  <Link to={`/courses/${course._id}`} className="flex justify-between items-center w-full">
                    <div className="flex items-center">
                      <AcademicCapIcon className="h-6 w-6 text-primary-400 mr-3" />
                      <div>
                        <p className="font-semibold text-text-dark">{course.title}</p>
                        <p className="text-sm text-text-medium">{course.teacher?.name || 'Instructor'}</p>
                      </div>
                    </div>
                    <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-primary-100 text-primary-700 border border-primary-400 shadow">{course.code || 'Course'}</span>
                  </Link>
                </motion.li>
              ))}
            </ul>
          ) : (
            <div className="px-4 py-6 text-text-medium">You are not enrolled in any courses yet.</div>
          )}
        </div>
      </motion.div>
      {/* Recent Assignments & Quizzes */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        {/* Recent Assignments */}
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.3 }} className="bg-white/90 shadow-card rounded-2xl border border-primary-50">
          <div className="px-4 py-5 sm:px-6 flex justify-between items-center">
            <h3 className="text-lg font-bold text-text-dark">Recent Assignments</h3>
            <Link to="/assignments" className="text-base text-primary-500 hover:text-secondary-500 font-semibold">View all</Link>
          </div>
          <div className="border-t border-neutral-50">
            {safeAssignments.length > 0 ? (
              <ul className="divide-y divide-neutral-50">
                {safeAssignments.slice(0, 5).map((assignment, idx) => (
                  <motion.li key={assignment._id} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 + idx * 0.05 }} className="px-4 py-4 sm:px-6 hover:bg-accent-yellow/10 flex justify-between items-center rounded-xl transition-all">
                    <div>
                      <p className="font-semibold text-text-dark">{assignment.title}</p>
                      <p className="text-xs text-text-medium">Due: {moment(assignment.deadline).format('MMM D, YYYY')}</p>
                    </div>
                    <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold ${assignment.submitted ? 'bg-accent-green text-white' : 'bg-accent-yellow text-text-dark'} border shadow`}>{assignment.submitted ? 'Submitted' : 'Pending'}</span>
                  </motion.li>
                ))}
              </ul>
            ) : (
              <div className="px-4 py-6 text-text-medium">No assignments found.</div>
            )}
          </div>
        </motion.div>
        {/* Recent Quizzes */}
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.4 }} className="bg-white/90 shadow-card rounded-2xl border border-primary-50">
          <div className="px-4 py-5 sm:px-6 flex justify-between items-center">
            <h3 className="text-lg font-bold text-text-dark">Recent Quizzes</h3>
            <Link to="/quizzes" className="text-base text-primary-500 hover:text-secondary-500 font-semibold">View all</Link>
          </div>
          <div className="border-t border-neutral-50">
            {quizzesWithStatus.length > 0 ? (
              <ul className="divide-y divide-neutral-50">
                {quizzesWithStatus.slice(0, 5).map((quiz, idx) => (
                  <motion.li key={quiz._id} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.4 + idx * 0.05 }} className="px-4 py-4 sm:px-6 hover:bg-accent-yellow/10 flex justify-between items-center rounded-xl transition-all">
                    <div>
                      <p className="font-semibold text-text-dark">{quiz.title}</p>
                      <p className="text-xs text-text-medium">Questions: {quiz.questions?.length || 0}</p>
                    </div>
                    <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold ${quiz.completed ? 'bg-accent-green text-white' : 'bg-accent-yellow text-text-dark'} border shadow`}>{quiz.completed ? 'Completed' : 'Pending'}</span>
                  </motion.li>
                ))}
              </ul>
            ) : (
              <div className="px-4 py-6 text-text-medium">No quizzes found.</div>
            )}
          </div>
        </motion.div>
      </div>
      {/* Notices */}
      <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.5 }} className="bg-white/90 shadow-card rounded-2xl mb-8 border border-primary-50">
        <div className="px-4 py-5 sm:px-6 flex justify-between items-center">
          <h3 className="text-lg font-bold text-text-dark">Notices</h3>
        </div>
        <div className="border-t border-neutral-50">
          {notices.length > 0 ? (
            <ul className="divide-y divide-neutral-50">
              {notices.slice(0, 5).map((notice, idx) => (
                <motion.li key={notice._id} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.5 + idx * 0.05 }} className="px-4 py-4 sm:px-6 hover:bg-primary-50/60 flex justify-between items-center rounded-xl transition-all">
                  <div>
                    <p className="font-semibold text-text-dark">{notice.title}</p>
                    <p className="text-xs text-text-medium">{moment(notice.createdAt).format('MMM D, YYYY')}</p>
                  </div>
                  <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold ${notice.priority === 'high' ? 'bg-action-red text-white' : notice.priority === 'medium' ? 'bg-action-orange text-white' : 'bg-primary-100 text-primary-700'} border shadow`}>{notice.priority?.charAt(0).toUpperCase() + notice.priority?.slice(1) || 'Low'}</span>
                </motion.li>
              ))}
            </ul>
          ) : (
            <div className="px-4 py-6 text-text-medium">No notices found.</div>
          )}
        </div>
      </motion.div>
    </div>
  );
};

export default StudentDashboard;

==================================================
FILE_PATH: client\src\pages\dashboard\TeacherDashboard.js
==================================================
import React, { useState, useEffect, useContext } from 'react';
import { Link } from 'react-router-dom';
import axios from 'axios';
import AuthContext from '../../context/AuthContext';
import { toast } from 'react-toastify';
import { motion } from 'framer-motion';

const TeacherDashboard = () => {
  const { user, logout } = useContext(AuthContext);
  const [courses, setCourses] = useState([]);
  const [notices, setNotices] = useState([]);
  const [assignments, setAssignments] = useState([]);
  const [quizzes, setQuizzes] = useState([]);
  const [loading, setLoading] = useState(true);
  const [studentCount, setStudentCount] = useState(0);

  useEffect(() => {
    const fetchDashboard = async () => {
      try {
        const token = localStorage.getItem('token');
        const res = await axios.get('/api/users/me/dashboard-teacher', {
          headers: { Authorization: `Bearer ${token}` }
        });
        if (res.data.success) {
          setCourses(res.data.courses || []);
          setAssignments(res.data.assignments || []);
          setQuizzes(res.data.quizzes || []);
          setNotices(res.data.notices || []);
          setStudentCount(res.data.studentCount || 0);
        }
      } catch (error) {
        console.error('Error fetching dashboard data:', error);
      } finally {
        setLoading(false);
      }
    };
    fetchDashboard();
  }, []);

  const handleLogout = () => {
    logout();
  };

  if (loading) {
    return (
      <div className="flex justify-center items-center h-64">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"></div>
      </div>
    );
  }

  return (
    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 bg-neutral-50 min-h-screen">
      {/* Header */}
      <motion.div initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8">
        <div className="flex items-center gap-4">
          <img
            src={`https://ui-avatars.com/api/?name=${encodeURIComponent(user?.name || 'T')}`}
            alt={user?.name}
            className="h-12 w-12 rounded-full border-2 border-primary-400 shadow"
          />
          <div>
            <h1 className="text-2xl font-extrabold font-heading text-text-dark">Welcome, {user?.name}</h1>
            <p className="text-text-medium mt-1">Your teaching dashboard</p>
          </div>
        </div>
        <button
          onClick={handleLogout}
          className="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-base font-semibold rounded-xl text-white bg-action-red hover:bg-action-orange transition-all"
        >
          Logout
        </button>
      </motion.div>
      {/* Stats Grid */}
      <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.1 }} className="grid grid-cols-1 sm:grid-cols-4 gap-6 mb-8">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.2 }} className="bg-white/90 shadow-card rounded-2xl p-6 flex flex-col items-center border border-primary-50 hover:shadow-card-hover transition-all">
          <span className="text-3xl font-extrabold text-primary-400">{courses.length}</span>
          <span className="text-text-medium mt-1">Courses</span>
        </motion.div>
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.3 }} className="bg-white/90 shadow-card rounded-2xl p-6 flex flex-col items-center border border-primary-50 hover:shadow-card-hover transition-all">
          <span className="text-3xl font-extrabold text-accent-yellow">{assignments.length}</span>
          <span className="text-text-medium mt-1">Assignments</span>
        </motion.div>
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.4 }} className="bg-white/90 shadow-card rounded-2xl p-6 flex flex-col items-center border border-primary-50 hover:shadow-card-hover transition-all">
          <span className="text-3xl font-extrabold text-accent-green">{quizzes.length}</span>
          <span className="text-text-medium mt-1">Quizzes</span>
        </motion.div>
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.5 }} className="bg-white/90 shadow-card rounded-2xl p-6 flex flex-col items-center border border-primary-50 hover:shadow-card-hover transition-all">
          <span className="text-3xl font-extrabold text-secondary-500">{studentCount}</span>
          <span className="text-text-medium mt-1">Students</span>
        </motion.div>
      </motion.div>
      {/* My Courses */}
      <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.6 }} className="bg-white/90 shadow-card rounded-2xl mb-8 border border-primary-50">
        <div className="px-4 py-5 sm:px-6 flex justify-between items-center">
          <h3 className="text-lg font-bold text-text-dark">My Courses</h3>
          <Link to="/create-course" className="text-base text-primary-500 hover:text-secondary-500 font-semibold">Add New</Link>
        </div>
        <div className="border-t border-neutral-50">
          {courses.length > 0 ? (
            <ul className="divide-y divide-neutral-50">
              {courses.slice(0, 5).map((course, idx) => (
                <motion.li key={course._id} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 + idx * 0.05 }} className="px-4 py-4 sm:px-6 hover:bg-primary-50/60 flex justify-between items-center rounded-xl transition-all">
                  <div>
                    <p className="font-semibold text-text-dark">{course.title}</p>
                    <p className="text-sm text-text-medium">{course.code}</p>
                  </div>
                  <div className="flex gap-2">
                    <Link to={`/courses/${course._id}`} className="text-primary-500 hover:text-secondary-500 font-semibold">View</Link>
                    <Link to={`/edit-course/${course._id}`} className="text-accent-green hover:text-accent-yellow font-semibold">Edit</Link>
                  </div>
                </motion.li>
              ))}
            </ul>
          ) : (
            <div className="px-4 py-6 text-text-medium">No courses found.</div>
          )}
        </div>
      </motion.div>
      {/* Recent Assignments & Quizzes */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        {/* Recent Assignments */}
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.7 }} className="bg-white/90 shadow-card rounded-2xl border border-primary-50">
          <div className="px-4 py-5 sm:px-6 flex justify-between items-center">
            <h3 className="text-lg font-bold text-text-dark">Recent Assignments</h3>
            <Link to="/teacher/assignments/create" className="text-base text-primary-500 hover:text-secondary-500 font-semibold">Add</Link>
          </div>
          <div className="border-t border-neutral-50">
            {assignments.length > 0 ? (
              <ul className="divide-y divide-neutral-50">
                {assignments.slice(0, 5).map((assignment, idx) => (
                  <motion.li key={assignment._id} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 + idx * 0.05 }} className="px-4 py-4 sm:px-6 hover:bg-accent-yellow/10 flex justify-between items-center rounded-xl transition-all">
                    <div>
                      <p className="font-semibold text-text-dark">{assignment.title}</p>
                      <p className="text-xs text-text-medium">Due: {assignment.deadline}</p>
                    </div>
                    <Link to={`/assignments/${assignment._id}`} className="text-primary-500 hover:text-secondary-500 font-semibold">View</Link>
                  </motion.li>
                ))}
              </ul>
            ) : (
              <div className="px-4 py-6 text-text-medium">No assignments found.</div>
            )}
          </div>
        </motion.div>
        {/* Recent Quizzes */}
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.8 }} className="bg-white/90 shadow-card rounded-2xl border border-primary-50">
          <div className="px-4 py-5 sm:px-6 flex justify-between items-center">
            <h3 className="text-lg font-bold text-text-dark">Recent Quizzes</h3>
            <Link to="/teacher/quizzes/create" className="text-base text-primary-500 hover:text-secondary-500 font-semibold">Add</Link>
          </div>
          <div className="border-t border-neutral-50">
            {quizzes.length > 0 ? (
              <ul className="divide-y divide-neutral-50">
                {quizzes.slice(0, 5).map((quiz, idx) => (
                  <motion.li key={quiz._id} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.4 + idx * 0.05 }} className="px-4 py-4 sm:px-6 hover:bg-accent-yellow/10 flex justify-between items-center rounded-xl transition-all">
                    <div>
                      <p className="font-semibold text-text-dark">{quiz.title}</p>
                      <p className="text-xs text-text-medium">Questions: {quiz.questions?.length || 0}</p>
                    </div>
                    <Link to={`/quizzes/${quiz._id}`} className="text-primary-500 hover:text-secondary-500 font-semibold">View</Link>
                  </motion.li>
                ))}
              </ul>
            ) : (
              <div className="px-4 py-6 text-text-medium">No quizzes found.</div>
            )}
          </div>
        </motion.div>
      </div>
      {/* Notices */}
      <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.9 }} className="bg-white/90 shadow-card rounded-2xl mb-8 border border-primary-50">
        <div className="px-4 py-5 sm:px-6 flex justify-between items-center">
          <h3 className="text-lg font-bold text-text-dark">Notices</h3>
          <Link to="/teacher/notices/create" className="text-base text-primary-500 hover:text-secondary-500 font-semibold">Add</Link>
        </div>
        <div className="border-t border-neutral-50">
          {notices.length > 0 ? (
            <ul className="divide-y divide-neutral-50">
              {notices.slice(0, 5).map((notice, idx) => (
                <motion.li key={notice._id} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.5 + idx * 0.05 }} className="px-4 py-4 sm:px-6 hover:bg-primary-50/60 flex justify-between items-center rounded-xl transition-all">
                  <div>
                    <p className="font-semibold text-text-dark">{notice.title}</p>
                    <p className="text-xs text-text-medium">{notice.createdAt}</p>
                  </div>
                  <Link to={`/notices/${notice._id}`} className="text-primary-500 hover:text-secondary-500 font-semibold">View</Link>
                </motion.li>
              ))}
            </ul>
          ) : (
            <div className="px-4 py-6 text-text-medium">No notices found.</div>
          )}
        </div>
      </motion.div>
      {/* Call to Action */}
      <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 1 }} className="flex gap-4">
        <Link to="/create-course" className="inline-block px-4 py-2 bg-accent-green text-white rounded-xl hover:bg-primary-400 transition-colors font-semibold shadow">Create New Course</Link>
        <Link to="/teacher/assignments/create" className="inline-block px-4 py-2 bg-primary-400 text-white rounded-xl hover:bg-accent-yellow transition-colors font-semibold shadow">Add Assignment</Link>
        <Link to="/teacher/quizzes/create" className="inline-block px-4 py-2 bg-secondary-500 text-white rounded-xl hover:bg-primary-400 transition-colors font-semibold shadow">Add Quiz</Link>
        <Link to="/teacher/notices/create" className="inline-block px-4 py-2 bg-action-orange text-white rounded-xl hover:bg-action-red transition-colors font-semibold shadow">Add Notice</Link>
      </motion.div>
    </div>
  );
};

export default TeacherDashboard;

==================================================
FILE_PATH: client\src\pages\Home.js
==================================================
import React, { useContext, useRef, useEffect, useState } from 'react';
import { Link } from 'react-router-dom';
import { motion } from 'framer-motion';
import AuthContext from '../context/AuthContext';
import { 
  AcademicCapIcon, 
  BookOpenIcon, 
  UserGroupIcon, 
  CheckCircleIcon,
  ArrowRightIcon 
} from '@heroicons/react/outline';
import Footer from '../components/layout/Footer';

const Home = () => {
  const { isAuthenticated, user } = useContext(AuthContext);

  // Parallax state (giữ nguyên như cũ)
  const [parallaxY, setParallaxY] = useState(0);
  const [parallaxY2, setParallaxY2] = useState(0);
  const [parallaxY3, setParallaxY3] = useState(0);
  const heroRef = useRef(null);
  const featuresRef = useRef(null);
  const benefitsRef = useRef(null);

  useEffect(() => {
    const handleScroll = () => {
      if (heroRef.current) {
        const rect = heroRef.current.getBoundingClientRect();
        setParallaxY(Math.max(0, -rect.top * 0.3));
      }
      if (featuresRef.current) {
        const rect = featuresRef.current.getBoundingClientRect();
        setParallaxY2(Math.max(0, -rect.top * 0.15));
      }
      if (benefitsRef.current) {
        const rect = benefitsRef.current.getBoundingClientRect();
        setParallaxY3(Math.max(0, -rect.top * 0.1));
      }
    };
    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  // Animation variants (giữ nguyên)
  const containerVariants = {
    hidden: { opacity: 0 },
    visible: { opacity: 1, transition: { staggerChildren: 0.2 } }
  };
  
  const itemVariants = {
    hidden: { opacity: 0, y: 20 },
    visible: { opacity: 1, y: 0 }
  };

  const features = [
    { icon: <BookOpenIcon className="h-6 w-6" />, title: 'Digital Course Materials', description: 'Access all your learning resources in one place, from any device, anywhere.' },
    { icon: <UserGroupIcon className="h-6 w-6" />, title: 'Collaborative Learning', description: 'Stay connected with classmates and instructors through announcements and updates.' },
    { icon: <AcademicCapIcon className="h-6 w-6" />, title: 'Real-time Quizzes', description: 'Test your knowledge with interactive quizzes and get instant results.' },
    { icon: <UserGroupIcon className="h-6 w-6" />, title: 'Collaborative Learning', description: 'Stay connected with classmates and instructors through announcements and updates.' },
  ];

  const testimonials = [
    { quote: "This LMS platform has completely transformed how I manage my courses. It's intuitive and saves me so much time!", author: "Dr. Sarah Johnson", role: "Professor of Computer Science" },
    { quote: "As a student, I love how easy it is to access all my course materials and submit assignments in one place.", author: "Michael Chen", role: "Engineering Student" }
  ];

  const featureImages = [
    'https://images.unsplash.com/photo-1519389950473-47ba0277781c?auto=format&fit=crop&w=600&q=80',
    'https://images.unsplash.com/photo-1503676382389-4809596d5290?auto=format&fit=crop&w=600&q=80',
    'https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=600&q=80',
    'https://images.unsplash.com/photo-1513258496099-48168024aec0?auto=format&fit=crop&w=600&q=80',
  ];

  return (
    <div className="bg-white">

      {/* ==================== HERO SECTION - CÓ LỚP PHỦ XÁM MỜ ==================== */}
<section 
  ref={heroRef}
  className="relative min-h-[60vh] md:min-h-[75vh] flex items-center justify-center overflow-hidden"
>
  <video
    autoPlay
    loop
    muted
    playsInline
    preload="auto"
    className="absolute inset-0 w-full h-full object-cover z-0"
  >
    <source src="/banner-main.mp4" type="video/mp4" />
  </video>

  {/* Lớp phủ màu xám mờ */}
  <div className="absolute inset-0 bg-[#1f1f1f]/60 z-10"></div>

  <motion.div
    className="relative z-20 text-center px-6 max-w-4xl mx-auto"
    style={{ y: parallaxY * 0.2 }}
    initial={{ opacity: 0, y: 60 }}
    animate={{ opacity: 1, y: 0 }}
    transition={{ duration: 1.2 }}
  >
    {/* GIẢM CỠ CHỮ TẠI ĐÂY */}
    <h1 className="text-4xl md:text-5xl font-extrabold text-white mb-6 drop-shadow-2xl">
      Hi there!, <span className="text-yellow-400">I'm PhamNgocBaoPhuc</span>
    </h1>

    <p className="text-lg md:text-xl text-white/90 mb-10 max-w-3xl mx-auto font-light leading-relaxed drop-shadow-lg">
      We bring together world-class instructors, interactive content, and a supportive community to help you achieve your personal and professional goals.
    </p>

    <a
      href={isAuthenticated ? "/dashboard" : "/login"}
      className="inline-block px-8 py-4 text-lg font-semibold bg-white text-primary-700 rounded-full shadow-2xl hover:bg-gray-100 transform hover:scale-105 transition-all duration-300"
    >
      {isAuthenticated ? "Go to Dashboard" : "Get Started"}
    </a>
  </motion.div>

  <motion.div
    className="absolute bottom-4 left-1/2 -translate-x-1/2 z-20"
    animate={{ y: [0, 15, 0] }}
    transition={{ repeat: Infinity, duration: 2 }}
  >
    <svg className="w-7 h-7 text-white opacity-70" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 14l-7 7m0 0l-7-7m7 7V3" />
    </svg>
  </motion.div>
</section>

{/* ==================== END HERO ==================== */}


      {/* ==================== TỪ ĐÂY TRỞ XUỐNG GIỮ NGUYÊN 100% CỦA BẠN ==================== */}
      <motion.section
        ref={featuresRef}
        className="py-16 md:py-24 relative"
        variants={containerVariants}
        initial="hidden"
        whileInView="visible"
        viewport={{ once: true, amount: 0.2 }}
      >
        <motion.div
          className="absolute -top-32 left-1/2 w-96 h-96 bg-gradient-to-br from-primary-200 to-accent-yellow rounded-full blur-3xl opacity-30 z-0"
          style={{ y: parallaxY2 * 0.5 }}
        />
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <motion.div className="text-center mb-16" variants={itemVariants}>
            <h2 className="text-3xl md:text-4xl font-bold text-gray-900 mb-4">Designed for Modern Learning</h2>
            <p className="max-w-2xl mx-auto text-lg text-gray-600">
              Our platform provides all the tools you need for effective teaching and engaging learning experiences.
            </p>
          </motion.div>
          
          <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
            {features.map((feature, index) => (
              <motion.div
                key={index}
                variants={itemVariants}
                whileHover={{ scale: 1.04, boxShadow: '0 8px 32px 0 rgba(31, 38, 135, 0.2)' }}
                className="bg-white/80 backdrop-blur-lg rounded-xl p-8 border border-primary-50 shadow-card hover:shadow-xl transition-all duration-300 flex flex-col md:flex-row items-center gap-6"
                style={{ y: parallaxY2 * (0.1 + index * 0.05) }}
              >
                <motion.img
                  src={featureImages[index]}
                  alt={feature.title}
                  className="w-28 h-28 object-cover rounded-2xl shadow-lg mb-4 md:mb-0 md:mr-6"
                  style={{ y: parallaxY2 * 0.15 }}
                  initial={{ opacity: 0, y: 30 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.2 + index * 0.1, duration: 0.7, type: 'spring' }}
                />
                <div>
                  <div className="w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center text-primary-600 mb-5">
                    {feature.icon}
                  </div>
                  <h3 className="text-xl font-semibold text-gray-900 mb-3">{feature.title}</h3>
                  <p className="text-gray-600">{feature.description}</p>
                </div>
              </motion.div>
            ))}
          </div>
        </div>
      </motion.section>

      <motion.section className="bg-gray-50 py-16 md:py-24" variants={containerVariants} initial="hidden" whileInView="visible" viewport={{ once: true, amount: 0.2 }}>
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <motion.div className="text-center mb-16" variants={itemVariants}>
            <h2 className="text-3xl md:text-4xl font-bold text-gray-900 mb-4">Benefits for Everyone</h2>
            <p className="max-w-2xl mx-auto text-lg text-gray-600">
              Whether you're a teacher or a student, our platform enhances the learning experience.
            </p>
          </motion.div>
          
          <div className="md:flex md:items-center md:justify-between">
            <motion.div className="md:w-1/2 mb-10 md:mb-0" variants={itemVariants}>
              <h3 className="text-2xl font-semibold text-gray-900 mb-6">For Teachers</h3>
              <ul className="space-y-4">
                {['Create and manage courses with ease','Share materials in various formats','Design assessments and quizzes','Track student progress and engagement','Communicate effectively with students'].map((item, i) => (
                  <li key={i} className="flex items-start">
                    <CheckCircleIcon className="h-6 w-6 text-green-500 mr-2 flex-shrink-0" />
                    <span className="text-gray-700">{item}</span>
                  </li>
                ))}
              </ul>
            </motion.div>
            
            <motion.div className="md:w-1/2" variants={itemVariants}>
              <h3 className="text-2xl font-semibold text-gray-900 mb-6">For Students</h3>
              <ul className="space-y-4">
                {['Access all course materials in one place','Submit assignments digitally','Take quizzes and get instant feedback','Track your grades and progress','Stay updated with course announcements'].map((item, i) => (
                  <li key={i} className="flex items-start">
                    <CheckCircleIcon className="h-6 w-6 text-green-500 mr-2 flex-shrink-0" />
                    <span className="text-gray-700">{item}</span>
                  </li>
                ))}
              </ul>
            </motion.div>
          </div>
        </div>
      </motion.section>

      <motion.section
        className="py-16 md:py-24 bg-white relative overflow-hidden"
        variants={containerVariants}
        initial="hidden"
        whileInView="visible"
        viewport={{ once: true, amount: 0.2 }}
      >
        <motion.div
          className="absolute -top-24 right-1/4 w-80 h-80 bg-gradient-to-br from-accent-green to-primary-100 rounded-full blur-3xl opacity-30 z-0"
          style={{ y: parallaxY3 * 0.7 }}
        />
        <div className="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
          <motion.h2
            className="text-3xl md:text-4xl font-bold text-center mb-12 text-gray-900"
            initial={{ opacity: 0, y: 40 }}
            whileInView={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.7, delay: 0.1 }}
          >
            What Our Users Say
          </motion.h2>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
            {testimonials.map((testimonial, idx) => (
              <motion.div
                key={idx}
                className="bg-white/80 backdrop-blur-lg rounded-2xl p-8 border border-primary-50 shadow-card hover:shadow-xl transition-all duration-300 flex flex-col items-center text-center"
                style={{ y: parallaxY3 * (0.1 + idx * 0.08) }}
                initial={{ opacity: 0, y: 40 }}
                whileInView={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.7, delay: 0.2 + idx * 0.1 }}
              >
                <div className="w-20 h-20 bg-gray-200 rounded-full mb-4 border-4 border-primary-100" /> {/* placeholder avatar */}
                <p className="text-gray-700 mb-4 italic">“{testimonial.quote}”</p>
                <div className="font-semibold text-primary-700">{testimonial.author}</div>
                <div className="text-sm text-gray-500">{testimonial.role}</div>
              </motion.div>
            ))}
          </div>
        </div>
      </motion.section>

      <motion.section
        className="bg-primary-700 py-16 md:py-20 text-white"
        initial={{ opacity: 0 }}
        whileInView={{ opacity: 1 }}
        viewport={{ once: true }}
        transition={{ duration: 0.6 }}
      >
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
          <h2 className="text-3xl md:text-4xl font-bold mb-6">Ready to transform your learning experience?</h2>
          <p className="text-lg text-primary-100 mb-8 max-w-2xl mx-auto">
            Join thousands of teachers and students who are already using our platform to enhance their educational journey.
          </p>
          <Link
            to={isAuthenticated ? (user?.role === 'teacher' ? '/teacher/dashboard' : '/student/dashboard') : '/register'}
            className="inline-flex items-center px-6 py-3 bg-white text-primary-700 rounded-md font-medium hover:bg-gray-100 transition-colors shadow-lg"
          >
            {isAuthenticated ? 'Go to Dashboard' : 'Get Started For Free'}
            <ArrowRightIcon className="ml-2 h-5 w-5" />
          </Link>
        </div>
      </motion.section>

      <div className="absolute inset-0 overflow-hidden pointer-events-none">
        <motion.div
          initial={{ opacity: 0, scale: 0.8 }}
          animate={{ opacity: 0.2, scale: 1 }}
          transition={{ duration: 1.2, delay: 0.2 }}
          className="absolute left-1/4 top-0 w-96 h-96 bg-gradient-to-br from-accent-yellow to-primary-400 rounded-full blur-3xl opacity-60 animate-pulse"
        />
        <motion.div
          initial={{ opacity: 0, scale: 0.8 }}
          animate={{ opacity: 0.15, scale: 1 }}
          transition={{ duration: 1.2, delay: 0.4 }}
          className="absolute right-1/4 bottom-0 w-96 h-96 bg-gradient-to-tr from-secondary-500 to-primary-600 rounded-full blur-3xl opacity-60 animate-pulse"
        />
      </div>

      <Footer />
    </div>
  );
};

export default Home;

==================================================
FILE_PATH: client\src\pages\materials\Materials.js
==================================================
import React, { useState, useEffect, useContext } from 'react';
import { Link } from 'react-router-dom';
import { motion } from 'framer-motion';
import axios from 'axios';
import moment from 'moment';
import AuthContext from '../../context/AuthContext';
import { 
  DocumentTextIcon,
  PhotographIcon, // Changed from PhotoIcon
  FilmIcon,
  LinkIcon,
  DocumentIcon,
  SearchIcon, // Changed from MagnifyingGlassIcon
  TrashIcon
} from '@heroicons/react/outline';

const BACKEND_URL = process.env.REACT_APP_BACKEND_URL || 'http://localhost:5000';

const Materials = () => {
  const { user } = useContext(AuthContext);
  const [courses, setCourses] = useState([]);
  const [selectedCourse, setSelectedCourse] = useState('');
  const [materials, setMaterials] = useState([]);
  const [filteredMaterials, setFilteredMaterials] = useState([]);
  const [searchTerm, setSearchTerm] = useState('');
  const [loading, setLoading] = useState(true);
  
  const isTeacher = user?.role === 'teacher';
  
  useEffect(() => {
    const fetchCourses = async () => {
      try {
        const res = await axios.get('/api/courses');
        setCourses(res.data.courses);
        
        // If there are courses, select the first one by default
        if (res.data.courses.length > 0) {
          setSelectedCourse(res.data.courses[0]._id);
        } else {
          setLoading(false);
        }
      } catch (error) {
        console.error('Error fetching courses:', error);
        setLoading(false);
      }
    };
    
    fetchCourses();
  }, []);
  
  // Fetch materials whenever the selected course changes
  useEffect(() => {
    const fetchMaterials = async () => {
      if (!selectedCourse) return;
      
      setLoading(true);
      try {
        const res = await axios.get(`/api/materials/course/${selectedCourse}`);
        setMaterials(res.data.materials);
        setFilteredMaterials(res.data.materials);
        setLoading(false);
      } catch (error) {
        console.error('Error fetching materials:', error);
        setLoading(false);
      }
    };
    
    fetchMaterials();
  }, [selectedCourse]);
  
  // Filter materials based on search term
  useEffect(() => {
    if (searchTerm.trim() === '') {
      setFilteredMaterials(materials);
      return;
    }
    
    const filtered = materials.filter(material => 
      material.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
      material.description.toLowerCase().includes(searchTerm.toLowerCase())
    );
    
    setFilteredMaterials(filtered);
  }, [searchTerm, materials]);
  
  const getMaterialIcon = (type) => {
    switch (type) {
      case 'pdf':
        return <DocumentTextIcon className="h-6 w-6 text-red-500" />;
      case 'image':
        return <PhotographIcon className="h-6 w-6 text-green-500" />;
      case 'video':
        return <FilmIcon className="h-6 w-6 text-blue-500" />;
      case 'link':
        return <LinkIcon className="h-6 w-6 text-purple-500" />;
      default:
        return <DocumentIcon className="h-6 w-6 text-gray-500" />;
    }
  };
  
  const handleDeleteMaterial = async (materialId) => {
    if (!window.confirm('Are you sure you want to delete this material? This action cannot be undone.')) return;
    try {
      await axios.delete(`/api/materials/${materialId}`);
      setMaterials(prev => prev.filter(m => m._id !== materialId));
    } catch (err) {
      alert('Failed to delete material.');
    }
  };
  
  const handleDownload = async (fileName, originalName) => {
    const token = localStorage.getItem('token');
    try {
      const response = await axios.get(
        `${BACKEND_URL}/api/materials/download/${encodeURIComponent(fileName)}`,
        {
          responseType: 'blob',
          headers: { Authorization: `Bearer ${token}` }
        }
      );
      const url = window.URL.createObjectURL(new Blob([response.data]));
      const link = document.createElement('a');
      link.href = url;
      link.setAttribute('download', originalName || fileName);
      document.body.appendChild(link);
      link.click();
      link.remove();
      window.URL.revokeObjectURL(url);
    } catch (error) {
      alert('Download failed: ' + (error.response?.data?.message || error.message));
    }
  };
  
  if (loading && courses.length === 0) {
    return (
      <div className="flex justify-center items-center h-64">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"></div>
      </div>
    );
  }
  
  if (courses.length === 0) {
    return (
      <div className="text-center py-12">
        <h2 className="text-xl font-semibold text-gray-800 mb-2">No Courses Found</h2>
        <p className="text-gray-600">You are not enrolled in any courses yet.</p>
        <Link to="/courses" className="mt-4 inline-block text-primary-600 hover:underline">
          Browse Courses
        </Link>
      </div>
    );
  }
  
  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-2xl font-bold text-gray-800">Study Materials</h1>
        <p className="text-gray-600">
          Access course materials and resources
        </p>
      </div>
      
      <div className="flex flex-col md:flex-row gap-4">
        {/* Course Selector */}
        <div className="md:w-1/3">
          <label htmlFor="courseSelect" className="block text-sm font-medium text-gray-700 mb-1">
            Select Course
          </label>
          <select
            id="courseSelect"
            value={selectedCourse}
            onChange={(e) => setSelectedCourse(e.target.value)}
            className="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm"
          >
            {courses.map((course) => (
              <option key={course._id} value={course._id}>
                {course.title}
              </option>
            ))}
          </select>
        </div>
        
        {/* Search Bar */}
        <div className="md:w-2/3 relative">
          <label htmlFor="searchMaterials" className="block text-sm font-medium text-gray-700 mb-1">
            Search Materials
          </label>
          <div className="relative">
            <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <SearchIcon className="h-5 w-5 text-gray-400" />
            </div>
            <input
              id="searchMaterials"
              type="text"
              className="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm"
              placeholder="Search by title or description..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
            />
          </div>
        </div>
      </div>
      
      {/* Materials List */}
      {loading ? (
        <div className="flex justify-center items-center h-32">
          <div className="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary-500"></div>
        </div>
      ) : filteredMaterials.length > 0 ? (
        <div className="bg-white rounded-lg shadow-md overflow-hidden">
          <ul className="divide-y divide-gray-200">
            {filteredMaterials.map((material, index) => (
              <motion.li 
                key={material._id}
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.3, delay: index * 0.05 }}
                className="p-4 hover:bg-gray-50"
              >
                <div className="flex items-center">
                  <div className="flex-shrink-0 p-2 bg-gray-100 rounded-lg">
                    {getMaterialIcon(material.type)}
                  </div>
                  <div className="ml-4 flex-1">
                    <div className="flex items-center justify-between">
                      <h3 className="text-lg font-medium text-gray-800">{material.title}</h3>
                      <p className="text-sm text-gray-500">
                        {moment(material.createdAt).format('MMM D, YYYY')}
                      </p>
                    </div>
                    {material.description && (
                      <p className="text-sm text-gray-600 mt-1">{material.description}</p>
                    )}
                    <div className="mt-2 flex items-center">
                      {material.type === 'link' ? (
                        <a
                          href={material.link}
                          target="_blank"
                          rel="noreferrer"
                          className="text-primary-600 hover:text-primary-700 text-sm font-medium flex items-center"
                        >
                          <LinkIcon className="h-4 w-4 mr-1" /> Open Link
                        </a>
                      ) : (
                        material.fileName && (
                          <button
                            onClick={() => handleDownload(material.fileName, material.originalName)}
                            className="text-primary-600 hover:text-primary-700 text-sm font-medium flex items-center"
                          >
                            <DocumentIcon className="h-4 w-4 mr-1" /> Download {material.originalName || material.fileName}
                          </button>
                        )
                      )}
                      {isTeacher && (
                        <button
                          onClick={() => handleDeleteMaterial(material._id)}
                          className="ml-2 p-2 rounded-full hover:bg-red-100 text-red-600"
                          title="Delete Material"
                        >
                          <TrashIcon className="h-5 w-5" />
                        </button>
                      )}
                    </div>
                  </div>
                </div>
              </motion.li>
            ))}
          </ul>
        </div>
      ) : (
        <div className="text-center py-10 bg-white rounded-lg shadow-md">
          <p className="text-gray-500">No materials found for this course.</p>
          {isTeacher && (
            <Link
              to={`/teacher/materials/create/${selectedCourse}`}
              className="mt-4 inline-block px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700"
            >
              Add Material
            </Link>
          )}
        </div>
      )}
      
      {/* Add Material Button for Teachers */}
      {isTeacher && filteredMaterials.length > 0 && (
        <div className="flex justify-end">
          <Link
            to={`/teacher/materials/create/${selectedCourse}`}
            className="px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700"
          >
            Add Material
          </Link>
        </div>
      )}
    </div>
  );
};

export default Materials;


==================================================
FILE_PATH: client\src\pages\NotFound.js
==================================================
import React from 'react';
import { Link } from 'react-router-dom';
import { motion } from 'framer-motion';

const NotFound = () => {
  return (
    <div className="min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
      <div className="max-w-md w-full space-y-8 text-center">
        <motion.div
          initial={{ opacity: 0, y: -20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5 }}
        >
          <h1 className="text-9xl font-extrabold text-primary-600">404</h1>
          <h2 className="mt-6 text-3xl font-bold text-gray-900">Page Not Found</h2>
          <p className="mt-3 text-gray-600">
            Sorry, we couldn't find the page you're looking for.
          </p>
          <div className="mt-8">
            <Link
              to="/"
              className="inline-flex items-center justify-center px-5 py-3 border border-transparent text-base font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700"
            >
              Go back home
            </Link>
          </div>
        </motion.div>
      </div>
    </div>
  );
};

export default NotFound;


==================================================
FILE_PATH: client\src\pages\notices\Notices.js
==================================================
import React, { useState, useEffect, useContext } from 'react';
import { Link } from 'react-router-dom';
import { motion } from 'framer-motion';
import axios from 'axios';
import moment from 'moment';
import AuthContext from '../../context/AuthContext';
import { 
  BellIcon, 
  ExclamationIcon, // Changed from ExclamationTriangleIcon
  DocumentTextIcon,
  PlusIcon,
  TrashIcon
} from '@heroicons/react/outline';

const BACKEND_URL = process.env.REACT_APP_BACKEND_URL || 'http://localhost:5000';

const Notices = () => {
  const { user } = useContext(AuthContext);
  const [notices, setNotices] = useState([]);
  const [loading, setLoading] = useState(true);
  const [activeTab, setActiveTab] = useState('all'); // 'all', 'course', 'general'
  
  const isTeacher = user?.role === 'teacher';
  
  useEffect(() => {
    const fetchNotices = async () => {
      try {
        // Fetch all notices the user has access to
        const res = await axios.get('/api/notices');
        
        // Sort notices: pinned first, then by date
        const sortedNotices = res.data.notices.sort((a, b) => {
          if (a.pinned && !b.pinned) return -1;
          if (!a.pinned && b.pinned) return 1;
          return new Date(b.createdAt) - new Date(a.createdAt);
        });
        
        setNotices(sortedNotices);
        setLoading(false);
      } catch (error) {
        console.error('Error fetching notices:', error);
        setLoading(false);
      }
    };
    
    fetchNotices();
  }, []);
  
  // Filter notices based on active tab
  const filteredNotices = notices.filter(notice => {
    if (activeTab === 'all') return true;
    // Robustly check for course-linked notices
    if (activeTab === 'course') return notice.course || notice.courseId;
    if (activeTab === 'general') return !notice.course && !notice.courseId;
    return true;
  });
  
  const getPriorityStyles = (priority) => {
    switch (priority) {
      case 'high':
        return {
          icon: <ExclamationIcon className="h-5 w-5 text-red-500" />,
          badge: 'bg-red-100 text-red-800'
        };
      case 'medium':
        return {
          icon: <BellIcon className="h-5 w-5 text-yellow-500" />,
          badge: 'bg-yellow-100 text-yellow-800'
        };
      case 'low':
      default:
        return {
          icon: <BellIcon className="h-5 w-5 text-blue-500" />,
          badge: 'bg-blue-100 text-blue-800'
        };
    }
  };
  
  const handleDeleteNotice = async (noticeId) => {
    if (!window.confirm('Are you sure you want to delete this notice? This action cannot be undone.')) return;
    try {
      await axios.delete(`/api/notices/${noticeId}`);
      setNotices(prev => prev.filter(n => n._id !== noticeId));
    } catch (err) {
      alert('Failed to delete notice.');
    }
  };
  
  const handleDownload = async (fileName, originalName) => {
    const token = localStorage.getItem('token');
    try {
      const response = await axios.get(
        `${BACKEND_URL}/api/materials/download/${encodeURIComponent(fileName)}`,
        {
          responseType: 'blob',
          headers: { Authorization: `Bearer ${token}` }
        }
      );
      const url = window.URL.createObjectURL(new Blob([response.data]));
      const link = document.createElement('a');
      link.href = url;
      link.setAttribute('download', originalName || fileName);
      document.body.appendChild(link);
      link.click();
      link.remove();
      window.URL.revokeObjectURL(url);
    } catch (error) {
      alert('Download failed: ' + (error.response?.data?.message || error.message));
    }
  };
  
  if (loading) {
    return (
      <div className="flex justify-center items-center h-64">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"></div>
      </div>
    );
  }
  
  return (
    <div className="max-w-4xl mx-auto py-8 px-2 sm:px-6 lg:px-8 bg-neutral-50 min-h-screen">
      <motion.div initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className="mb-8">
        <h1 className="text-2xl font-extrabold font-heading text-primary-400 mb-1 drop-shadow-lg tracking-tight bg-gradient-to-r from-primary-400 to-secondary-500 bg-clip-text text-transparent">
          Notices & Announcements
        </h1>
        <p className="text-text-medium">Stay updated with important information</p>
      </motion.div>
      
      {/* Tab Navigation */}
      <div className="border-b border-neutral-50 mb-6">
        <nav className="flex -mb-px space-x-8">
          <button
            onClick={() => setActiveTab('all')}
            className={`py-4 px-1 border-b-2 font-medium text-sm ${
              activeTab === 'all'
                ? 'border-primary-500 text-primary-600'
                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
            }`}
          >
            All Notices
          </button>
          <button
            onClick={() => setActiveTab('course')}
            className={`py-4 px-1 border-b-2 font-medium text-sm ${
              activeTab === 'course'
                ? 'border-primary-500 text-primary-600'
                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
            }`}
          >
            Course Notices
          </button>
          <button
            onClick={() => setActiveTab('general')}
            className={`py-4 px-1 border-b-2 font-medium text-sm ${
              activeTab === 'general'
                ? 'border-primary-500 text-primary-600'
                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
            }`}
          >
            General Announcements
          </button>
        </nav>
      </div>
      
      {/* Notices List */}
      <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5, delay: 0.1 }}>
        {filteredNotices.length > 0 ? (
          <div className="space-y-4">
            {filteredNotices.map((notice, index) => {
              const priorityStyle = getPriorityStyles(notice.priority);
              return (
                <motion.div
                  key={notice._id}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ duration: 0.3, delay: index * 0.05 }}
                  className={`p-5 bg-white/90 rounded-xl shadow-card border border-primary-50 ${notice.pinned ? 'border-l-4 border-primary-400' : ''}`}
                >
                  <div className="sm:flex sm:justify-between sm:items-start">
                    <div className="flex">
                      <div className="flex-shrink-0">{priorityStyle.icon}</div>
                      <div className="ml-3">
                        <div className="flex items-center">
                          <h3 className="text-lg font-bold text-text-dark">{notice.title}</h3>
                          {notice.pinned && (
                            <span className="ml-2 px-2 py-0.5 text-xs bg-primary-100 text-primary-800 rounded-full border border-primary-400">Pinned</span>
                          )}
                          {(notice.course?.title || notice.courseId) && (
                            <span className="ml-2 px-2 py-0.5 text-xs bg-secondary-50 text-secondary-500 rounded-full border border-secondary-400">
                              {notice.course?.title || notice.courseId?.toString().slice(-6)}
                            </span>
                          )}
                        </div>
                        <span className={`ml-2 px-2 py-0.5 text-xs rounded-full border font-bold ${priorityStyle.badge}`}>{notice.priority.charAt(0).toUpperCase() + notice.priority.slice(1)}</span>
                      </div>
                    </div>
                  </div>
                  <div className="mt-2 text-text-medium">
                    {notice.content}
                  </div>
                  <div className="mt-2 text-xs text-text-medium">
                    {moment(notice.createdAt).format('MMM D, YYYY [at] h:mm A')}
                  </div>
                </motion.div>
              );
            })}
          </div>
        ) : (
          <div className="text-center py-12 text-text-medium">No notices found.</div>
        )}
      </motion.div>
    </div>
  );
};

export default Notices;


==================================================
FILE_PATH: client\src\pages\quizzes\QuizDetails.js
==================================================
import React, { useState, useEffect, useContext } from 'react';
import { useParams, Link, useNavigate } from 'react-router-dom';
import { motion } from 'framer-motion';
import axios from 'axios';
import moment from 'moment';
import AuthContext from '../../context/AuthContext';
import { 
  ArrowLeftIcon,
  ClockIcon,
  UserIcon,
  CheckCircleIcon,
  ExclamationCircleIcon,
  DocumentTextIcon, // Added missing import
  CheckIcon, // Added missing import
  XIcon // Added missing import (XMarkIcon in v2 is XIcon in v1)
} from '@heroicons/react/outline';

const QuizDetails = () => {
  const { id } = useParams();
  const navigate = useNavigate();
  const { user } = useContext(AuthContext);
  
  const [quiz, setQuiz] = useState(null);
  const [results, setResults] = useState([]);
  const [studentResult, setStudentResult] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  
  const isTeacher = user?.role === 'teacher';
  const isStudent = user?.role === 'student';
  
  useEffect(() => {
    const fetchQuizDetails = async () => {
      try {
        const res = await axios.get(`/api/quizzes/${id}`);
        setQuiz(res.data.data);
        
        // For teachers, get all results
        if (isTeacher) {
          setResults(res.data.data?.results || []);
        }
        
        // For students, get their result if they've taken the quiz
        if (isStudent) {
          const result = (res.data.data?.results || []).find(
            r => r.student?._id === user._id
          );
          
          if (result) {
            // Get detailed result with correct answers
            const resultRes = await axios.get(`/api/quizzes/${id}/result`);
            setStudentResult(resultRes.data.result);
          }
        }
        
        setLoading(false);
      } catch (error) {
        console.error('Error fetching quiz details:', error);
        setError('Failed to load quiz details');
        setLoading(false);
      }
    };
    
    fetchQuizDetails();
  }, [id, isTeacher, isStudent, user._id]);
  
  if (loading) {
    return (
      <div className="flex justify-center items-center h-64">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"></div>
      </div>
    );
  }
  
  if (error) {
    return (
      <div className="text-center py-12">
        <h2 className="text-xl font-semibold text-gray-800 mb-2">Error</h2>
        <p className="text-gray-600">{error}</p>
        <button
          onClick={() => navigate(-1)}
          className="mt-4 inline-block px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700"
        >
          Go Back
        </button>
      </div>
    );
  }
  
  if (!quiz) {
    return (
      <div className="text-center py-12">
        <h2 className="text-xl font-semibold text-gray-800 mb-2">Quiz Not Found</h2>
        <p className="text-gray-600">The quiz you're looking for doesn't exist or you don't have access to it.</p>
        <button
          onClick={() => navigate('/quizzes')}
          className="mt-4 inline-block px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700"
        >
          Go to Quizzes
        </button>
      </div>
    );
  }
  
  return (
    <div className="max-w-4xl mx-auto py-8 px-2 sm:px-6 lg:px-8 bg-neutral-50 min-h-screen">
      <motion.div initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className="bg-white/90 shadow-card rounded-2xl p-6 mb-8 border border-primary-50">
        <h1 className="text-2xl font-extrabold font-heading text-primary-400 mb-2 drop-shadow-lg tracking-tight bg-gradient-to-r from-primary-400 to-secondary-500 bg-clip-text text-transparent">
          {quiz.title}
        </h1>
        <div className="flex flex-wrap gap-2 mb-4">
          <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-primary-100 text-primary-700 border border-primary-400 shadow">
            Questions: {quiz.questions?.length || 0}
          </span>
          <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-accent-yellow text-text-dark border border-accent-yellow shadow">
            Time Limit: {quiz.timeLimit || 'No limit'} min
          </span>
          {quiz.availableFrom && (
            <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-accent-green text-white border border-accent-green shadow">
              Available from: {moment(quiz.availableFrom).format('MMM D, YYYY')}
            </span>
          )}
          {quiz.availableTo && (
            <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-action-orange text-white border border-action-orange shadow">
              Available until: {moment(quiz.availableTo).format('MMM D, YYYY')}
            </span>
          )}
        </div>
        <div className="prose max-w-none text-text-dark">
          {quiz.description}
        </div>
      </motion.div>
      
      {/* Back Button */}
      <div className="mb-6">
        <button
          onClick={() => navigate(-1)}
          className="flex items-center text-gray-600 hover:text-primary-600"
        >
          <ArrowLeftIcon className="h-4 w-4 mr-1" />
          Back
        </button>
      </div>
      
      <div className="bg-white rounded-lg shadow-md p-6 mb-6">
        <div className="sm:flex sm:justify-between sm:items-start mb-6">
          <div>
            <h1 className="text-2xl font-bold text-gray-800 mb-2">{quiz.title}</h1>
            <p className="text-gray-600 mb-4">
              Course: {quiz.course?.title || 'Unknown Course'}
            </p>
            
            <div className="flex flex-wrap gap-3">
              <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                <DocumentTextIcon className="h-3 w-3 mr-1" />
                {quiz.questions?.length} Questions
              </span>
              
              {quiz.timeLimit && (
                <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                  <ClockIcon className="h-3 w-3 mr-1" />
                  Time Limit: {quiz.timeLimit} minutes
                </span>
              )}
              
              {quiz.isPublished ? (
                <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                  Published
                </span>
              ) : (
                <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                  Draft
                </span>
              )}
              
              {quiz.results?.length > 0 && (
                <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                  <UserIcon className="h-3 w-3 mr-1" />
                  {(quiz.results || []).length} {(quiz.results || []).length === 1 ? 'Attempt' : 'Attempts'}
                </span>
              )}
            </div>
          </div>
          
          {isStudent && !studentResult && (
            <div className="mt-4 sm:mt-0">
              <Link
                to={`/quizzes/${quiz._id}/take`}
                className={`inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500`}
              >
                Take Quiz
              </Link>
            </div>
          )}
        </div>
        
        <div className="border-t border-gray-200 pt-4">
          <div className="prose max-w-none text-gray-700">
            {quiz.description}
          </div>
          
          {quiz.availableFrom && (
            <div className="mt-4 text-sm text-gray-600">
              <p>
                Available: {moment(quiz.availableFrom).format('MMM D, YYYY [at] h:mm A')}
                {quiz.availableTo && (
                  <> to {moment(quiz.availableTo).format('MMM D, YYYY [at] h:mm A')}</>
                )}
              </p>
            </div>
          )}
        </div>
      </div>
      
      {/* Student Result Section */}
      {isStudent && studentResult && (
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          className="bg-white rounded-lg shadow-md p-6 mb-6"
        >
          <h2 className="text-xl font-semibold text-gray-800 mb-4">Your Results</h2>
          
          <div className="bg-blue-50 rounded-lg p-4 mb-6">
            <div className="sm:flex sm:justify-between sm:items-center">
              <div>
                <p className="text-gray-700">
                  Score: 
                  <span className="font-semibold text-lg ml-2">
                    {studentResult.score} / {studentResult.totalPossibleScore}
                  </span>
                </p>
                <p className="text-gray-700">
                  Percentage: 
                  <span className="font-semibold ml-2">
                    {Math.round((studentResult.score / studentResult.totalPossibleScore) * 100)}%
                  </span>
                </p>
              </div>
              <div className="mt-4 sm:mt-0">
                <p className="text-sm text-gray-600">
                  Submitted: {moment(studentResult.submittedAt).format('MMM D, YYYY [at] h:mm A')}
                </p>
              </div>
            </div>
          </div>
          
          <h3 className="font-medium text-gray-800 mb-3">Question Review</h3>
          
          <div className="space-y-6">
            {studentResult.answers?.map((answer, index) => (
              <div key={index} className={`p-4 rounded-lg ${
                answer.isCorrect 
                  ? 'bg-green-50 border border-green-200' 
                  : 'bg-red-50 border border-red-200'
              }`}>
                <div className="flex items-start">
                  <div className={`p-1 rounded-full ${
                    answer.isCorrect ? 'bg-green-100' : 'bg-red-100'
                  } mr-3`}>
                    {answer.isCorrect ? (
                      <CheckIcon className="h-5 w-5 text-green-600" />
                    ) : (
                      <XIcon className="h-5 w-5 text-red-600" />
                    )}
                  </div>
                  <div className="flex-1">
                    <p className="font-medium text-gray-800">{answer.questionText}</p>
                    
                    <div className="mt-3">
                      <p className="text-sm text-gray-700">Your answer: {answer.selectedOptionText}</p>
                      {!answer.isCorrect && (
                        <p className="text-sm font-medium text-green-800 mt-1">
                          Correct answer: {answer.correctOption?.text}
                        </p>
                      )}
                    </div>
                    
                    {answer.explanation && (
                      <div className="mt-3 p-3 bg-gray-50 rounded text-sm text-gray-700">
                        <p className="font-medium">Explanation:</p>
                        <p>{answer.explanation}</p>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            ))}
          </div>
        </motion.div>
      )}
      
      {/* Teacher Results Section */}
      {isTeacher && (
        <div className="bg-white rounded-lg shadow-md p-6">
          <h2 className="text-xl font-semibold text-gray-800 mb-4">Student Results</h2>
          
          {results.length === 0 ? (
            <p className="text-gray-600 text-center py-6">No students have attempted this quiz yet.</p>
          ) : (
            <div className="overflow-x-auto">
              <table className="min-w-full divide-y divide-gray-200">
                <thead className="bg-gray-50">
                  <tr>
                    <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Student
                    </th>
                    <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Score
                    </th>
                    <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Percentage
                    </th>
                    <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                      Date Submitted
                    </th>
                  </tr>
                </thead>
                <tbody className="bg-white divide-y divide-gray-200">
                  {results.map((result) => (
                    <tr key={result._id}>
                      <td className="px-6 py-4 whitespace-nowrap">
                        <div className="flex items-center">
                          <div className="ml-4">
                            <div className="text-sm font-medium text-gray-900">
                              {result.student?.name || 'Unknown Student'}
                            </div>
                            <div className="text-sm text-gray-500">
                              {result.student?.email}
                            </div>
                          </div>
                        </div>
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap">
                        <span className="text-sm text-gray-900">
                          {result.score} / {result.totalPossibleScore}
                        </span>
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap">
                        <span className={`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${
                          (result.score / result.totalPossibleScore) * 100 >= 70
                            ? 'bg-green-100 text-green-800'
                            : (result.score / result.totalPossibleScore) * 100 >= 50
                            ? 'bg-yellow-100 text-yellow-800'
                            : 'bg-red-100 text-red-800'
                        }`}>
                          {Math.round((result.score / result.totalPossibleScore) * 100)}%
                        </span>
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        {moment(result.submittedAt).format('MMM D, YYYY [at] h:mm A')}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}
        </div>
      )}
      
      {isTeacher && (!quiz.results || quiz.results.length === 0) && (
        <div className="mt-4 sm:mt-0">
          <Link
            to={`/quizzes/${quiz._id}/edit`}
            className="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-yellow-600 hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500"
          >
            Edit Quiz
          </Link>
        </div>
      )}
    </div>
  );
};

export default QuizDetails;


==================================================
FILE_PATH: client\src\pages\quizzes\QuizResult.js
==================================================
import React, { useState, useEffect } from 'react';
import { useParams, Link } from 'react-router-dom';
import axios from 'axios';
import { toast } from 'react-toastify';
import moment from 'moment';
import {
  CheckCircleIcon,
  XCircleIcon,
  ExclamationCircleIcon,
  ArrowLeftIcon,
  DocumentDownloadIcon,
} from '@heroicons/react/outline';
import { motion } from 'framer-motion';

const QuizResult = () => {
  const { id: quizId } = useParams();
  const [result, setResult] = useState(null);
  const [quiz, setQuiz] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchQuizResult = async () => {
      try {
        const token = localStorage.getItem('token');
        const res = await axios.get(`/api/quizzes/${quizId}/result`, {
          headers: { Authorization: `Bearer ${token}` }
        });
        if (res.data.success) {
          setResult(res.data.result);
          // Fetch quiz details separately if needed
          const quizRes = await axios.get(`/api/quizzes/${quizId}`, {
            headers: { Authorization: `Bearer ${token}` }
          });
          if (quizRes.data.success) {
            setQuiz(quizRes.data.data);
          }
        } else {
          toast.error('Failed to load quiz results');
        }
      } catch (error) {
        console.error('Error fetching quiz results:', error);
        toast.error('Error loading quiz results');
      } finally {
        setLoading(false);
      }
    };
    fetchQuizResult();
  }, [quizId]);

  // Function to download quiz results as PDF
  const downloadResults = () => {
    // Create a text-based report that can be downloaded
    const report = generateQuizReport();
    const blob = new Blob([report], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${quiz?.title || 'Quiz'}_Results_${moment().format('YYYY-MM-DD_HH-mm')}.txt`;
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
    toast.success('Results downloaded successfully!');
  };

  // Function to generate quiz report
  const generateQuizReport = () => {
    const correctAnswers = result.answers?.filter(a => a.isCorrect).length || 0;
    const totalQuestions = result.answers?.length || 0;
    const percentage = result.totalPossibleScore ? Math.round((result.score / result.totalPossibleScore) * 100) : 0;
    const isPassed = percentage >= 70;
    
    // Format time taken
    const formatTime = (seconds) => {
      if (!seconds) return 'Not recorded';
      const hours = Math.floor(seconds / 3600);
      const minutes = Math.floor((seconds % 3600) / 60);
      const secs = seconds % 60;
      
      if (hours > 0) {
        return `${hours}h ${minutes}m ${secs}s`;
      } else if (minutes > 0) {
        return `${minutes}m ${secs}s`;
      } else {
        return `${secs}s`;
      }
    };

    let report = `QUIZ RESULTS REPORT\n`;
    report += `==================\n\n`;
    report += `Quiz Title: ${quiz?.title || 'Unknown Quiz'}\n`;
    report += `Completed: ${moment(result.submittedAt).format('MMMM D, YYYY [at] h:mm A')}\n`;
    report += `Time Taken: ${formatTime(result.timeTaken)}\n`;
    report += `Score: ${result.score}/${result.totalPossibleScore} (${percentage}%)\n`;
    report += `Status: ${isPassed ? 'PASSED' : 'FAILED'}\n`;
    report += `Correct Answers: ${correctAnswers}/${totalQuestions}\n\n`;
    
    report += `QUESTION REVIEW\n`;
    report += `===============\n\n`;
    
    result.answers?.forEach((answer, idx) => {
      const questionNum = idx + 1;
      report += `Question ${questionNum}:\n`;
      report += `Question: ${answer.questionText}\n`;
      report += `Your Answer: `;
      
      if (answer.textAnswer) {
        report += answer.textAnswer;
      } else if (answer.selectedOptionTexts && answer.selectedOptionTexts.length > 0) {
        report += answer.selectedOptionTexts.join(', ');
      } else {
        report += 'No answer provided';
      }
      
      report += `\nResult: ${answer.isCorrect ? 'CORRECT' : 'INCORRECT'}\n`;
      
      if (!answer.isCorrect) {
        report += `Correct Answer: `;
        if (answer.correctTextAnswers && answer.correctTextAnswers.length > 0) {
          report += answer.correctTextAnswers.join(', ');
        } else if (answer.correctOptionTexts && answer.correctOptionTexts.length > 0) {
          report += answer.correctOptionTexts.join(', ');
        } else {
          report += 'Not available';
        }
        report += `\n`;
      }
      
      if (answer.explanation) {
        report += `Explanation: ${answer.explanation}\n`;
      }
      
      report += `\n`;
    });
    
    return report;
  };

  if (loading) {
    return (
      <div className="flex justify-center items-center h-64">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"></div>
      </div>
    );
  }

  if (!result || !quiz) {
    return (
      <div className="max-w-3xl mx-auto p-4">
        <div className="bg-red-50 p-4 rounded-md">
          <div className="flex">
            <div className="flex-shrink-0">
              <ExclamationCircleIcon className="h-5 w-5 text-red-400" />
            </div>
            <div className="ml-3">
              <h3 className="text-sm font-medium text-red-800">Results not available</h3>
            </div>
          </div>
        </div>
        
        <Link
          to="/dashboard"
          className="mt-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700"
        >
          <ArrowLeftIcon className="w-5 h-5 mr-2" />
          Back to Dashboard
        </Link>
      </div>
    );
  }

  // Calculate correct answers and percentage
  const correctAnswers = result.answers?.filter(a => a.isCorrect).length || 0;
  const totalQuestions = result.answers?.length || 0;
  const percentage = result.totalPossibleScore ? Math.round((result.score / result.totalPossibleScore) * 100) : 0;
  const isPassed = percentage >= 70; // Default passing score

  // Format time taken
  const formatTime = (seconds) => {
    if (!seconds) return 'Not recorded';
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;
    
    if (hours > 0) {
      return `${hours}h ${minutes}m ${secs}s`;
    } else if (minutes > 0) {
      return `${minutes}m ${secs}s`;
    } else {
      return `${secs}s`;
    }
  };

  return (
    <div className="max-w-3xl mx-auto py-8 px-2 sm:px-6 lg:px-8 bg-neutral-50 min-h-screen">
      <motion.div initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className="bg-white/90 shadow-card rounded-2xl p-8 mb-8 border border-primary-50 backdrop-blur-md">
        <h1 className="text-2xl font-extrabold font-heading text-primary-400 mb-2 drop-shadow-lg tracking-tight bg-gradient-to-r from-primary-400 to-secondary-500 bg-clip-text text-transparent">
          Quiz Results
        </h1>
        <div className="flex flex-wrap gap-2 mb-4">
          <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-primary-100 text-primary-700 border border-primary-400 shadow">
            Score: {result.score} / {result.totalPossibleScore}
          </span>
          <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold border shadow ${isPassed ? 'bg-accent-green text-white' : 'bg-action-red text-white'}`}>
            {isPassed ? 'Passed' : 'Failed'}
          </span>
        </div>
        <div className="prose max-w-none text-text-dark mb-4">
          {result.feedback}
        </div>
        <div className="mt-4 text-sm opacity-80">
          Completed: {moment(result.submittedAt).format('MMMM D, YYYY [at] h:mm A')}
        </div>
        <div className="mt-4 text-sm opacity-80">
          Time Taken: {formatTime(result.timeTaken)}
        </div>
        <div className="mt-4 text-sm opacity-80">
          Correct Answers: {correctAnswers}/{totalQuestions}
        </div>
        <div className="mt-4 text-sm opacity-80">
          Passing Score: 70%
        </div>
      </motion.div>
      
      <div className="mt-8">
        <h2 className="text-lg font-semibold text-gray-800 mb-4">Question Review</h2>
        
        <div className="space-y-6">
          {result.answers?.map((answer, idx) => {
            const isCorrect = answer.isCorrect;
            
            return (
              <motion.div
                key={answer.question || idx}
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.4, delay: idx * 0.08 }}
                className={`p-4 rounded-2xl border shadow-card backdrop-blur-md ${isCorrect ? 'bg-green-50/80 border-green-200' : 'bg-red-50/80 border-red-200'}`}
              >
                <div className="flex">
                  <div className="flex-shrink-0 mt-1">
                    {isCorrect ? (
                      <CheckCircleIcon className="h-5 w-5 text-green-500" />
                    ) : (
                      <XCircleIcon className="h-5 w-5 text-red-500" />
                    )}
                  </div>
                  <div className="ml-3 flex-1">
                    <h3 className="font-medium">Question {idx + 1}</h3>
                    <p className="text-gray-800 mt-1">{answer.questionText}</p>
                    
                    <div className="mt-3">
                      <p className="text-sm font-medium text-gray-500">Your Answer:</p>
                      <div className="mt-1 text-sm">
                        {answer.textAnswer ? (
                          <p className="italic bg-gray-100/80 p-2 rounded-lg shadow-inner">{answer.textAnswer}</p>
                        ) : answer.selectedOptionTexts ? (
                          <ul className="list-disc pl-5 space-y-1">
                            {answer.selectedOptionTexts.map((text, i) => (
                              <li key={i} className="bg-gray-100/80 p-1 rounded-lg shadow-inner">
                                {text}
                              </li>
                            ))}
                          </ul>
                        ) : (
                          <p className="text-gray-400 italic">No answer provided</p>
                        )}
                      </div>
                    </div>
                    
                    {!isCorrect && (
                      <div className="mt-3 bg-white/80 p-2 rounded-lg border border-gray-200 shadow-inner">
                        <p className="text-sm font-medium text-gray-500">Correct Answer:</p>
                        <div className="mt-1 text-sm">
                          {answer.correctTextAnswers ? (
                            <ul className="list-disc pl-5 space-y-1">
                              {answer.correctTextAnswers.map((text, i) => (
                                <li key={i} className="text-green-700 font-medium">
                                  {text}
                                </li>
                              ))}
                            </ul>
                          ) : answer.correctOptionTexts ? (
                            <ul className="list-disc pl-5 space-y-1">
                              {answer.correctOptionTexts.map((text, i) => (
                                <li key={i} className="text-green-700 font-medium">
                                  {text}
                                </li>
                              ))}
                            </ul>
                          ) : (
                            <p className="text-gray-400 italic">Correct answer not available</p>
                          )}
                        </div>
                      </div>
                    )}
                    
                    {answer.explanation && (
                      <div className="mt-3 bg-blue-50/80 p-2 rounded-lg border border-blue-200 shadow-inner">
                        <p className="text-sm font-medium text-blue-700">Explanation:</p>
                        <p className="mt-1 text-sm text-blue-800">{answer.explanation}</p>
                      </div>
                    )}
                  </div>
                </div>
              </motion.div>
            );
          })}
        </div>
      </div>
      
      <div className="mt-8 flex flex-wrap gap-4">
        <Link
          to={`/courses/${quiz?.course || '#'}`}
          className="inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg shadow-sm text-sm font-semibold text-gray-700 bg-white/80 hover:bg-gray-50 transition-all"
        >
          <ArrowLeftIcon className="mr-2 h-4 w-4" />
          Back to Course
        </Link>
        
        <button
          onClick={downloadResults}
          className="inline-flex items-center px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-semibold text-white bg-gradient-to-r from-primary-400 to-secondary-500 hover:from-primary-500 hover:to-secondary-600 transition-all"
        >
          <DocumentDownloadIcon className="mr-2 h-4 w-4" />
          Download Results
        </button>
      </div>
    </div>
  );
};

export default QuizResult;


==================================================
FILE_PATH: client\src\pages\quizzes\Quizzes.js
==================================================
import React, { useState, useEffect, useContext } from 'react';
import { Link } from 'react-router-dom';
import { motion } from 'framer-motion';
import axios from 'axios';
import { toast } from 'react-toastify';
import moment from 'moment';
import AuthContext from '../../context/AuthContext';
import {
  AcademicCapIcon,
  ClockIcon,
  SearchIcon,
  DocumentTextIcon,
  TrashIcon
} from '@heroicons/react/outline';

const Quizzes = () => {
  const { user } = useContext(AuthContext);
  const [quizzes, setQuizzes] = useState([]);
  const [filteredQuizzes, setFilteredQuizzes] = useState([]);
  const [searchTerm, setSearchTerm] = useState('');
  const [loading, setLoading] = useState(true);
  const [filter, setFilter] = useState('all'); // 'all', 'available', 'completed', 'upcoming', 'expired'
  
  const isTeacher = user?.role === 'teacher';
  const isStudent = user?.role === 'student';
  
  useEffect(() => {
    const fetchQuizzes = async () => {
      try {
        const endpoint = isTeacher ? '/api/quizzes/teacher' : '/api/quizzes/student';
        const res = await axios.get(endpoint);
        
        setQuizzes(res.data.quizzes);
        setFilteredQuizzes(res.data.quizzes);
        setLoading(false);
      } catch (error) {
        console.error('Error fetching quizzes:', error);
        setLoading(false);
      }
    };
    
    fetchQuizzes();
  }, [isTeacher]);
  
  // Filter quizzes based on search term and filter
  useEffect(() => {
    let filtered = quizzes;
    
    // Apply search filter
    if (searchTerm.trim() !== '') {
      filtered = filtered.filter(
        (quiz) =>
          quiz.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
          quiz.course?.title.toLowerCase().includes(searchTerm.toLowerCase())
      );
    }
    
    // Apply status filter for students
    if (isStudent) {
      if (filter === 'available') {
        filtered = filtered.filter(quiz => !quiz.submitted);
      } else if (filter === 'completed') {
        filtered = filtered.filter(quiz => quiz.submitted);
      } else if (filter === 'upcoming') {
        filtered = filtered.filter(quiz => 
          new Date(quiz.availableFrom) > new Date()
        );
      } else if (filter === 'expired') {
        filtered = filtered.filter(quiz => 
          quiz.availableTo && new Date(quiz.availableTo) < new Date() && !quiz.submitted
        );
      }
    }
    // For teachers, filter by status
    else if (isTeacher) {
      if (filter === 'active') {
        filtered = filtered.filter(quiz => 
          quiz.isPublished && 
          (!quiz.availableTo || new Date(quiz.availableTo) > new Date())
        );
      } else if (filter === 'draft') {
        filtered = filtered.filter(quiz => !quiz.isPublished);
      } else if (filter === 'completed') {
        filtered = filtered.filter(quiz => 
          quiz.availableTo && new Date(quiz.availableTo) < new Date()
        );
      } else if (filter === 'results') {
        filtered = filtered.filter(quiz => quiz.results && quiz.results.length > 0);
      }
    }
    
    setFilteredQuizzes(filtered);
  }, [searchTerm, filter, quizzes, isStudent, isTeacher]);
  
  const getQuizStatus = (quiz) => {
    if (isStudent) {
      if (quiz.submitted) {
        return {
          label: 'Completed',
          color: 'bg-green-100 text-green-800'
        };
      } else if (new Date(quiz.availableFrom) > new Date()) {
        return {
          label: 'Coming Soon',
          color: 'bg-purple-100 text-purple-800'
        };
      } else if (quiz.availableTo && new Date(quiz.availableTo) < new Date()) {
        return {
          label: 'Expired',
          color: 'bg-red-100 text-red-800'
        };
      } else {
        return {
          label: 'Available',
          color: 'bg-blue-100 text-blue-800'
        };
      }
    } else {
      // For teachers
      if (!quiz.isPublished) {
        return {
          label: 'Draft',
          color: 'bg-gray-100 text-gray-800'
        };
      } else if (quiz.availableTo && new Date(quiz.availableTo) < new Date()) {
        return {
          label: 'Expired',
          color: 'bg-red-100 text-red-800'
        };
      } else if (new Date(quiz.availableFrom) > new Date()) {
        return {
          label: 'Scheduled',
          color: 'bg-purple-100 text-purple-800'
        };
      } else {
        return {
          label: 'Active',
          color: 'bg-green-100 text-green-800'
        };
      }
    }
  };
  
  const handleDeleteQuiz = async (quizId) => {
    if (!window.confirm('Are you sure you want to delete this quiz? This action cannot be undone.')) return;
    
    try {
      const response = await axios.delete(`/api/quizzes/${quizId}`);
      
      if (response.data.success) {
        toast.success('Quiz deleted successfully!');
        setQuizzes(prev => prev.filter(q => q._id !== quizId));
        setFilteredQuizzes(prev => prev.filter(q => q._id !== quizId));
      } else {
        toast.error('Failed to delete quiz');
      }
    } catch (error) {
      console.error('Error deleting quiz:', error);
      const errorMessage = error.response?.data?.message || 'Failed to delete quiz';
      toast.error(errorMessage);
    }
  };
  
  if (loading) {
    return (
      <div className="flex justify-center items-center h-64">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"></div>
      </div>
    );
  }
  
  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-2xl font-bold text-gray-800">Quizzes</h1>
        <p className="text-gray-600">
          {isTeacher ? 'Manage your quizzes and view results' : 'Take quizzes and check your results'}
        </p>
      </div>
      
      <div className="flex flex-col md:flex-row gap-4">
        {/* Search Bar */}
        <div className="relative flex-grow">
          <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <SearchIcon className="h-5 w-5 text-gray-400" />
          </div>
          <input
            type="text"
            className="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm"
            placeholder="Search quizzes..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
          />
        </div>
        
        {/* Filter Dropdown */}
        <div>
          <select
            value={filter}
            onChange={(e) => setFilter(e.target.value)}
            className="block w-full px-3 py-2 border border-gray-300 rounded-md leading-5 bg-white focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm"
          >
            <option value="all">All Quizzes</option>
            {isStudent ? (
              <>
                <option value="available">Available</option>
                <option value="completed">Completed</option>
                <option value="upcoming">Coming Soon</option>
                <option value="expired">Expired</option>
              </>
            ) : (
              <>
                <option value="active">Active</option>
                <option value="draft">Draft</option>
                <option value="completed">Expired</option>
                <option value="results">Has Results</option>
              </>
            )}
          </select>
        </div>
      </div>
      
      {/* Quizzes List */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {filteredQuizzes.length > 0 ? (
          filteredQuizzes.map((quiz, index) => {
            const status = getQuizStatus(quiz);
            const hasTimeLimit = quiz.timeLimit && quiz.timeLimit > 0;
            
            return (
              <motion.div
                key={quiz._id}
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.3, delay: index * 0.05 }}
                className="bg-white rounded-lg shadow-md overflow-hidden"
              >
                <div className="p-6">
                  <div className="flex items-center justify-between mb-3">
                    <span className={`text-xs px-2 py-1 rounded-full ${status.color}`}>
                      {status.label}
                    </span>
                    {quiz.results && (
                      <span className="text-sm text-gray-600">
                        {quiz.results.length} {quiz.results.length === 1 ? 'Attempt' : 'Attempts'}
                      </span>
                    )}
                  </div>
                  
                  <h2 className="text-lg font-semibold text-gray-800 mb-2">{quiz.title}</h2>
                  
                  <p className="text-sm text-gray-600 mb-4">
                    {quiz.course?.title || 'Unknown Course'}
                  </p>
                  
                  <div className="flex items-start space-x-4 text-xs text-gray-500 mb-4">
                    <div className="flex items-center">
                      <DocumentTextIcon className="h-4 w-4 mr-1" />
                      {quiz.questions?.length || 0} Questions
                    </div>
                    
                    {hasTimeLimit && (
                      <div className="flex items-center">
                        <ClockIcon className="h-4 w-4 mr-1" />
                        {quiz.timeLimit} mins
                      </div>
                    )}
                  </div>
                  
                  <div className="flex items-center justify-between">
                    {isStudent ? (
                      <Link
                        to={quiz.submitted ? `/quizzes/${quiz._id}` : `/quizzes/${quiz._id}/take`}
                        className={`px-4 py-2 rounded-md text-sm font-medium ${
                          !quiz.submitted && status.label === 'Available'
                            ? 'bg-primary-600 text-white hover:bg-primary-700'
                            : quiz.submitted
                            ? 'bg-green-100 text-green-800 hover:bg-green-200'
                            : 'bg-gray-100 text-gray-500 cursor-not-allowed'
                        }`}
                        onClick={(e) => {
                          if (status.label !== 'Available' && !quiz.submitted) {
                            e.preventDefault();
                          }
                        }}
                      >
                        {quiz.submitted ? 'View Results' : 'Start Quiz'}
                      </Link>
                    ) : (
                      <Link
                        to={`/quizzes/${quiz._id}`}
                        className="px-4 py-2 bg-primary-600 text-white rounded-md text-sm font-medium hover:bg-primary-700"
                      >
                        View Details
                      </Link>
                    )}
                    
                    {quiz.availableFrom && quiz.availableTo && (
                      <span className="text-xs text-gray-500">
                        {moment(quiz.availableFrom).format('MMM D')} - {moment(quiz.availableTo).format('MMM D')}
                      </span>
                    )}
                  </div>
                  {isTeacher && (
                    <button
                      onClick={() => handleDeleteQuiz(quiz._id)}
                      className="ml-2 p-2 rounded-full hover:bg-red-100 text-red-600"
                      title="Delete Quiz"
                    >
                      <TrashIcon className="h-5 w-5" />
                    </button>
                  )}
                </div>
              </motion.div>
            );
          })
        ) : (
          <div className="text-center py-10 bg-white rounded-lg shadow-md col-span-full">
            <p className="text-gray-500">No quizzes found matching your criteria.</p>
          </div>
        )}
      </div>
    </div>
  );
};

export default Quizzes;


==================================================
FILE_PATH: client\src\pages\quizzes\TakeQuiz.js
==================================================
import React, { useState, useEffect, useContext } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import axios from 'axios';
import { toast } from 'react-toastify';
import AuthContext from '../../context/AuthContext';
import { ClockIcon, ExclamationIcon } from '@heroicons/react/outline';
import { motion } from 'framer-motion';

const TakeQuiz = () => {
  const { id } = useParams();
  const navigate = useNavigate();
  const { user } = useContext(AuthContext);

  const [quiz, setQuiz] = useState(null);
  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
  const [answers, setAnswers] = useState({});
  const [timeLeft, setTimeLeft] = useState(null);
  const [loading, setLoading] = useState(true);
  const [submitting, setSubmitting] = useState(false);
  const [quizStarted, setQuizStarted] = useState(false);
  const [error, setError] = useState(null);
  const [resultId, setResultId] = useState(null); // Added missing state variable
  const [startTime, setStartTime] = useState(null); // Add start time tracking

  useEffect(() => {
    const fetchQuiz = async () => {
      try {
        console.log('Fetching quiz with ID:', id);
        const token = localStorage.getItem('token');
        
        // Add error handling with specific timeout and headers
        const res = await axios.get(`/api/quizzes/${id}`, {
          headers: { 
            Authorization: `Bearer ${token}`,
            'Accept': 'application/json',
            'Cache-Control': 'no-cache'
          },
          timeout: 15000
        });
        
        console.log("Quiz API response:", res.data);
        
        if (res.data && res.data.success && res.data.data) {
          const quizData = res.data.data;
          setQuiz(quizData);
          
          // Initialize answers with proper checks
          if (quizData.questions && Array.isArray(quizData.questions) && quizData.questions.length > 0) {
            const initialAnswers = {};
            quizData.questions.forEach((q) => {
              if (q && q._id) {
                // Initialize based on question type
                if (q.type === 'multiple') {
                  initialAnswers[q._id] = [];
                } else {
                  initialAnswers[q._id] = '';
                }
              }
            });
            setAnswers(initialAnswers);
            console.log('Initialized answers:', initialAnswers);
          } else {
            console.warn("Quiz has no questions or questions array is not valid");
          }
          
          if (quizData.timeLimit && typeof quizData.timeLimit === 'number') {
            setTimeLeft(quizData.timeLimit * 60);
          }
        } else {
          console.error("Invalid quiz data or 'success' is false:", res.data);
          setError('Failed to load quiz data');
          toast.error('Failed to load quiz data');
        }
      } catch (error) {
        console.error('Error fetching quiz:', error);
        setError(error.response?.data?.message || 'Error loading quiz');
        toast.error(error.response?.data?.message || 'Error loading quiz');
      } finally {
        setLoading(false);
      }
    };

    fetchQuiz();
  }, [id]);

  // Timer effect
  useEffect(() => {
    if (!quizStarted || timeLeft === null) return;
    
    const timer = timeLeft > 0 && setInterval(() => {
      setTimeLeft(timeLeft - 1);
    }, 1000);
    
    if (timeLeft === 0) {
      handleSubmit();
    }
    
    return () => clearInterval(timer);
  }, [timeLeft, quizStarted]);
  
  const handleStartQuiz = () => {
    setQuizStarted(true);
    setStartTime(new Date().getTime());
  };
  
  const handleAnswerChange = (questionId, value, isMultiple = false) => {
    setAnswers(prev => {
      if (isMultiple) {
        // Store option IDs directly
        const currentAnswers = prev[questionId] || [];
        const newAnswers = currentAnswers.includes(value)
          ? currentAnswers.filter(v => v !== value)
          : [...currentAnswers, value];
        return {
          ...prev,
          [questionId]: newAnswers
        };
      } else {
        return {
          ...prev,
          [questionId]: value
        };
      }
    });
  };
  
  const handleSubmit = async () => {
    setSubmitting(true);
    try {
      const token = localStorage.getItem('token');
      
      // Prepare answers based on question type
      const formattedAnswers = Object.entries(answers).map(([questionId, answer]) => {
        const question = quiz.questions.find(q => q._id === questionId);
        
        if (!question) {
          return null; // Skip invalid questions
        }
        
        if (question.type === 'text') {
          return {
            question: questionId,
            textAnswer: answer
          };
        } else if (question.type === 'multiple') {
          // Use the array of option IDs directly
          return {
            question: questionId,
            selectedOptions: Array.isArray(answer) ? answer : []
          };
        } else {
          // Single choice - convert option index to option ID
          const selectedOptionId = question.options[answer]?._id;
          
          return {
            question: questionId,
            selectedOption: selectedOptionId
          };
        }
      }).filter(Boolean); // Remove null entries
      
      console.log('Submitting answers:', formattedAnswers);
      
      const res = await axios.post(
        `/api/quizzes/${id}/submit`,
        { answers: formattedAnswers, startTime },
        { headers: { Authorization: `Bearer ${token}` } }
      );
      
      if (res.data.success) {
        toast.success('Quiz submitted successfully!');
        navigate(`/quizzes/${id}/result`);
      } else {
        toast.error(res.data.message || 'Failed to submit quiz');
      }
    } catch (error) {
      console.error('Error submitting quiz:', error);
      toast.error(error.response?.data?.message || 'Error submitting quiz');
    } finally {
      setSubmitting(false);
    }
  };
  
  const handleNextQuestion = () => {
    if (currentQuestionIndex < quiz.questions.length - 1) {
      setCurrentQuestionIndex(currentQuestionIndex + 1);
    }
  };
  
  const handlePreviousQuestion = () => {
    if (currentQuestionIndex > 0) {
      setCurrentQuestionIndex(currentQuestionIndex - 1);
    }
  };
  
  // Update the quiz start section to handle potential data problems
  const startQuizSection = () => {
    if (!quiz) {
      return (
        <div className="bg-yellow-50 p-4 rounded-md mb-6 text-center">
          <p className="text-yellow-800">Quiz data not available. Please try again later.</p>
        </div>
      );
    }
    
    const hasQuestions = quiz.questions && Array.isArray(quiz.questions) && quiz.questions.length > 0;
    
    return (
      <div className="bg-white shadow-md rounded-lg p-6">
        <h1 className="text-2xl font-bold text-gray-800 mb-4">{quiz.title}</h1>
        <div className="mb-6">
          <p className="text-gray-700">{quiz.description || 'No description available'}</p>
        </div>
        
        <div className="bg-gray-50 p-4 rounded-md mb-6">
          <h2 className="font-medium text-gray-700 mb-2">Quiz Information</h2>
          <ul className="space-y-2 text-sm text-gray-600">
            <li className="flex items-center">
              <span className="w-32">Questions:</span>
              <span>{hasQuestions ? quiz.questions.length : 0}</span>
            </li>
            {quiz.timeLimit && (
              <li className="flex items-center">
                <span className="w-32">Time Limit:</span>
                <span>{quiz.timeLimit} minutes</span>
              </li>
            )}
            <li className="flex items-center">
              <span className="w-32">Points:</span>
              <span>
                {hasQuestions ? quiz.questions.reduce((total, q) => total + (q.points || 1), 0) : 0}
              </span>
            </li>
          </ul>
        </div>
        
        {!hasQuestions && (
          <div className="bg-yellow-50 p-4 rounded-md mb-6 text-center">
            <p className="text-yellow-800">This quiz has no questions yet. Please try again later.</p>
          </div>
        )}
        
        {hasQuestions && (
          <button
            onClick={handleStartQuiz}
            className="w-full px-6 py-3 bg-primary-600 text-white rounded-md font-medium hover:bg-primary-700"
          >
            Start Quiz
          </button>
        )}
      </div>
    );
  };

  if (loading) {
    return (
      <div className="flex justify-center items-center h-64">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"></div>
      </div>
    );
  }

  if (error) {
    return (
      <div className="max-w-3xl mx-auto p-4">
        <div className="bg-red-50 p-4 rounded-md">
          <div className="flex">
            <div className="flex-shrink-0">
              <ExclamationIcon className="h-5 w-5 text-red-400" />
            </div>
            <div className="ml-3">
              <h3 className="text-sm font-medium text-red-800">{error}</h3>
            </div>
          </div>
        </div>
        <button
          onClick={() => navigate('/dashboard')}
          className="mt-4 px-4 py-2 bg-primary-600 text-white rounded-md"
        >
          Go to Dashboard
        </button>
      </div>
    );
  }

  if (!quiz) {
    return (
      <div className="max-w-3xl mx-auto p-4">
        <div className="bg-red-50 p-4 rounded-md">
          <div className="flex">
            <div className="flex-shrink-0">
              <ExclamationIcon className="h-5 w-5 text-red-400" />
            </div>
            <div className="ml-3">
              <h3 className="text-sm font-medium text-red-800">Quiz not found</h3>
            </div>
          </div>
        </div>
      </div>
    );
  }

  if (!quizStarted) {
    return (
      <div className="max-w-3xl mx-auto p-4">
        {startQuizSection()}
      </div>
    );
  }
  
  // Quiz in progress
  const currentQuestion = quiz.questions[currentQuestionIndex];
  
  return (
    <div className="max-w-3xl mx-auto py-8 px-2 sm:px-6 lg:px-8 bg-neutral-50 min-h-screen">
      <motion.div initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className="bg-white/90 shadow-card rounded-2xl overflow-hidden border border-primary-50 backdrop-blur-md">
        {/* Header */}
        <div className="bg-gradient-to-r from-primary-400 to-secondary-500 text-white p-6 rounded-t-2xl">
          <div className="flex justify-between items-center">
            <h1 className="text-xl font-extrabold font-heading tracking-tight drop-shadow-lg">
              {quiz.title}
            </h1>
            {timeLeft !== null && (
              <div className="flex items-center bg-white/20 px-3 py-1 rounded-lg shadow-inner">
                <ClockIcon className="h-5 w-5 mr-2" />
                <span className="font-mono font-bold">
                  {Math.floor(timeLeft / 60)}:{String(timeLeft % 60).padStart(2, '0')}
                </span>
              </div>
            )}
          </div>
          <div className="flex justify-between mt-2 text-sm opacity-90">
            <span>Question {currentQuestionIndex + 1} of {quiz.questions?.length || 0}</span>
            <span>{currentQuestion?.points || 1} points</span>
          </div>
        </div>
        {/* Question */}
        <motion.div key={currentQuestionIndex} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.4 }} className="p-8">
          <h2 className="text-lg font-semibold text-text-dark mb-4">
            {currentQuestion?.questionText || 'No question available'}
          </h2>
          {currentQuestion?.image && (
            <div className="my-4">
              <img 
                src={currentQuestion.image} 
                alt="Question" 
                className="max-w-full h-auto max-h-64 mx-auto rounded-xl shadow-md"
              />
            </div>
          )}
          <div className="mt-6">
            {currentQuestion?.type === 'multiple' ? (
              <div className="space-y-3">
                {currentQuestion.options?.map((option) => {
                  const currentAnswers = answers[currentQuestion._id] || [];
                  const isChecked = Array.isArray(currentAnswers) && currentAnswers.includes(option._id);
                  return (
                    <label key={option._id} className="flex items-center space-x-3 cursor-pointer">
                      <input
                        type="checkbox"
                        className="h-5 w-5 text-primary-600 rounded border-gray-300 focus:ring-primary-500 transition-all"
                        checked={isChecked}
                        onChange={() => handleAnswerChange(currentQuestion._id, option._id, true)}
                      />
                      <span className="text-gray-700 font-medium">{option.text}</span>
                    </label>
                  );
                })}
              </div>
            ) : currentQuestion?.type === 'single' ? (
              <div className="space-y-3">
                {currentQuestion.options?.map((option, idx) => (
                  <label key={idx} className="flex items-center space-x-3 cursor-pointer">
                    <input
                      type="radio"
                      className="h-5 w-5 text-primary-600 border-gray-300 focus:ring-primary-500 transition-all"
                      checked={answers[currentQuestion._id] === idx}
                      onChange={() => handleAnswerChange(currentQuestion._id, idx)}
                      name={`question-${currentQuestion._id}`}
                    />
                    <span className="text-gray-700 font-medium">{option.text}</span>
                  </label>
                ))}
              </div>
            ) : (
              <textarea
                className="w-full px-3 py-2 text-gray-700 border-2 border-primary-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-400 focus:border-primary-400 transition-all bg-white/70 shadow-inner"
                rows="4"
                placeholder="Type your answer here..."
                value={answers[currentQuestion?._id] || ''}
                onChange={(e) => handleAnswerChange(currentQuestion._id, e.target.value)}
              ></textarea>
            )}
          </div>
        </motion.div>
        {/* Navigation */}
        <div className="px-8 py-4 bg-white/80 flex justify-between rounded-b-2xl border-t border-primary-50">
          <button
            onClick={handlePreviousQuestion}
            disabled={currentQuestionIndex === 0}
            className={`px-4 py-2 rounded-lg font-semibold transition-all shadow ${currentQuestionIndex === 0 ? 'bg-gray-200 text-gray-500 cursor-not-allowed' : 'bg-gradient-to-r from-primary-100 to-secondary-100 text-primary-700 hover:from-primary-200 hover:to-secondary-200'}`}
          >
            Previous
          </button>
          {currentQuestionIndex < (quiz.questions?.length - 1) ? (
            <button
              onClick={handleNextQuestion}
              className="px-4 py-2 rounded-lg font-semibold bg-gradient-to-r from-primary-400 to-secondary-500 text-white shadow hover:from-primary-500 hover:to-secondary-600 transition-all"
            >
              Next
            </button>
          ) : (
            <button
              onClick={handleSubmit}
              disabled={submitting}
              className={`px-4 py-2 rounded-lg font-semibold bg-gradient-to-r from-accent-green to-primary-400 text-white shadow hover:from-green-500 hover:to-primary-500 transition-all ${submitting ? 'opacity-70 cursor-not-allowed' : ''}`}
            >
              {submitting ? 'Submitting...' : 'Submit Quiz'}
            </button>
          )}
        </div>
        {/* Question navigation */}
        <div className="px-8 py-4 border-t border-primary-50 bg-white/70 rounded-b-2xl">
          <p className="text-sm text-gray-600 mb-2 font-semibold">Question Navigation:</p>
          <div className="flex flex-wrap gap-2">
            {quiz.questions?.map((question, idx) => {
              const questionAnswer = answers[question?._id];
              let hasAnswer = false;
              if (question?.type === 'multiple') {
                hasAnswer = Array.isArray(questionAnswer) && questionAnswer.length > 0;
              } else {
                hasAnswer = questionAnswer !== undefined && questionAnswer !== null && questionAnswer !== '';
              }
              return (
                <button
                  key={idx}
                  onClick={() => setCurrentQuestionIndex(idx)}
                  className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold shadow transition-all border-2 ${idx === currentQuestionIndex ? 'bg-primary-400 text-white border-primary-500 scale-110' : hasAnswer ? 'bg-accent-green/80 text-white border-accent-green' : 'bg-gray-200 text-gray-700 border-gray-300 hover:bg-gray-300'}`}
                >
                  {idx + 1}
                </button>
              );
            })}
          </div>
        </div>
      </motion.div>
    </div>
  );
};

export default TakeQuiz;


==================================================
FILE_PATH: client\src\pages\Register.js
==================================================
import React, { useState, useContext, useEffect } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { toast } from 'react-toastify';
import AuthContext from '../context/AuthContext';

const Register = () => {
  const navigate = useNavigate();
  const { register, isAuthenticated, error, clearErrors } = useContext(AuthContext);
  
  const [formData, setFormData] = useState({
    name: '',
    email: '',
    password: '',
    password2: '',
    role: 'student',
  });
  
  const { name, email, password, password2, role } = formData;
  
  useEffect(() => {
    if (isAuthenticated) {
      navigate('/');
    }
    
    if (error) {
      toast.error(error);
      clearErrors();
    }
  }, [isAuthenticated, error, navigate, clearErrors]);
  
  const onChange = e => {
    setFormData({ ...formData, [e.target.name]: e.target.value });
  };
  
  const onSubmit = e => {
    e.preventDefault();
    
    if (password !== password2) {
      toast.error('Passwords do not match');
    } else if (password.length < 6) {
      toast.error('Password must be at least 6 characters');
    } else {
      register({
        name,
        email,
        password,
        role
      });
    }
  };
  
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
      <div className="max-w-md w-full space-y-8">
        <div>
          <h2 className="mt-6 text-center text-3xl font-extrabold text-gray-900">Create your account</h2>
          <p className="mt-2 text-center text-sm text-gray-600">
            Or{' '}
            <Link to="/login" className="font-medium text-primary-600 hover:text-primary-500">
              sign in to your existing account
            </Link>
          </p>
        </div>
        <form className="mt-8 space-y-6" onSubmit={onSubmit}>
          <div className="rounded-md shadow-sm -space-y-px">
            <div>
              <label htmlFor="name" className="sr-only">
                Full Name
              </label>
              <input
                id="name"
                name="name"
                type="text"
                required
                className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm"
                placeholder="Full Name"
                value={name}
                onChange={onChange}
              />
            </div>
            <div>
              <label htmlFor="email" className="sr-only">
                Email address
              </label>
              <input
                id="email"
                name="email"
                type="email"
                required
                className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm"
                placeholder="Email address"
                value={email}
                onChange={onChange}
              />
            </div>
            <div>
              <label htmlFor="password" className="sr-only">
                Password
              </label>
              <input
                id="password"
                name="password"
                type="password"
                required
                className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm"
                placeholder="Password"
                value={password}
                onChange={onChange}
              />
            </div>
            <div>
              <label htmlFor="password2" className="sr-only">
                Confirm Password
              </label>
              <input
                id="password2"
                name="password2"
                type="password"
                required
                className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm"
                placeholder="Confirm Password"
                value={password2}
                onChange={onChange}
              />
            </div>
            <div>
              <label htmlFor="role" className="sr-only">
                Role
              </label>
              <select
                id="role"
                name="role"
                className="appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-primary-500 focus:border-primary-500 focus:z-10 sm:text-sm"
                value={role}
                onChange={onChange}
              >
                <option value="student">Student</option>
                <option value="teacher">Teacher</option>
              </select>
            </div>
          </div>

          <div>
            <button
              type="submit"
              className="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
            >
              Register
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

export default Register;


==================================================
FILE_PATH: client\src\pages\student\Dashboard.js
==================================================
import React, { useState, useEffect, useContext } from 'react';
import { Link } from 'react-router-dom';
import { motion } from 'framer-motion';
import axios from 'axios';
import moment from 'moment';
import AuthContext from '../../context/AuthContext';
import {
  BookOpenIcon,
  ClipboardCheckIcon, // Changed from ClipboardDocumentCheckIcon
  DocumentTextIcon,
  AcademicCapIcon
} from '@heroicons/react/outline';

const StudentDashboard = () => {
  const { user } = useContext(AuthContext);
  const [courses, setCourses] = useState([]);
  const [assignments, setAssignments] = useState([]);
  const [quizzes, setQuizzes] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchStudentData = async () => {
      try {
        // Fetch courses
        const coursesRes = await axios.get('/api/courses');
        setCourses(coursesRes.data.courses);

        // Fetch assignments
        const assignmentsRes = await axios.get('/api/assignments/student');
        setAssignments(assignmentsRes.data.assignments);

        // Fetch quizzes
        const quizzesRes = await axios.get('/api/quizzes/student');
        setQuizzes(quizzesRes.data.quizzes);

        setLoading(false);
      } catch (error) {
        console.error('Error fetching student data:', error);
        setLoading(false);
      }
    };

    fetchStudentData();
  }, []);

  // Defensive: always ensure arrays are defined
  const safeAssignments = Array.isArray(assignments) ? assignments : [];
  const safeCourses = Array.isArray(courses) ? courses : [];
  const safeQuizzes = Array.isArray(quizzes) ? quizzes : [];

  // Calculate upcoming deadlines
  const upcomingAssignments = safeAssignments
    .filter(assignment => {
      const submitted = assignment.submissions?.some(
        sub => sub.student.toString() === user?._id
      );
      const deadlinePassed = new Date(assignment.deadline) < new Date();
      return !submitted && !deadlinePassed;
    })
    .sort((a, b) => new Date(a.deadline) - new Date(b.deadline))
    .slice(0, 3);

  // Replace the 'Learning Progress' stat with 'Completed Assignments'
  const completedAssignments = safeAssignments.filter(a => a.submissions?.some(sub => sub.student.toString() === user?._id)).length;
  const totalAssignments = safeAssignments.length;
  const stats = [
    {
      title: 'Enrolled Courses',
      value: safeCourses.length,
      icon: <BookOpenIcon className="h-6 w-6 text-blue-500" />,
      color: 'bg-blue-100',
    },
    {
      title: 'Pending Assignments',
      value: upcomingAssignments.length,
      icon: <ClipboardCheckIcon className="h-6 w-6 text-yellow-500" />,
      color: 'bg-yellow-100',
    },
    {
      title: 'Available Quizzes',
      value: safeQuizzes.filter(q => !q.submitted).length,
      icon: <DocumentTextIcon className="h-6 w-6 text-green-500" />,
      color: 'bg-green-100',
    },
    {
      title: 'Completed Assignments',
      value: `${completedAssignments} / ${totalAssignments}`,
      icon: <AcademicCapIcon className="h-6 w-6 text-purple-500" />,
      color: 'bg-purple-100',
    },
  ];

  if (loading) {
    return (
      <div className="flex justify-center items-center h-64">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"></div>
      </div>
    );
  }

  return (
    <div className="space-y-8">
      <div>
        <h1 className="text-2xl font-bold text-gray-800">Student Dashboard</h1>
        <p className="text-gray-600">Welcome back, {user?.name}!</p>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        {stats.map((stat, index) => (
          <motion.div
            key={index}
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.3, delay: index * 0.1 }}
            className={`${stat.color} p-6 rounded-lg shadow-sm`}
          >
            <div className="flex items-center">
              <div className="p-3 rounded-full bg-white mr-4">
                {stat.icon}
              </div>
              <div>
                <p className="text-sm font-medium text-gray-600">{stat.title}</p>
                <p className="text-2xl font-bold text-gray-800">{stat.value}</p>
              </div>
            </div>
          </motion.div>
        ))}
      </div>

      {/* Upcoming Deadlines */}
      <div>
        <h2 className="text-xl font-semibold text-gray-800 mb-4">Upcoming Deadlines</h2>
        <div className="bg-white rounded-lg shadow-md overflow-hidden">
          {upcomingAssignments.length > 0 ? (
            <div className="divide-y divide-gray-200">
              {upcomingAssignments.map((assignment) => (
                <div key={assignment._id} className="p-4 hover:bg-gray-50">
                  <h3 className="font-medium text-gray-800">{assignment.title}</h3>
                  <p className="text-sm text-gray-600">
                    Course: {assignment.course.title}
                  </p>
                  <div className="flex justify-between items-center mt-2">
                    <span className="text-sm text-red-500">
                      Due: {moment(assignment.deadline).format('MMM D, YYYY')}
                    </span>
                    <Link
                      to={`/assignments/${assignment._id}`}
                      className="text-primary-600 hover:text-primary-700 text-sm font-medium"
                    >
                      View Details
                    </Link>
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <p className="text-gray-500 text-center py-8">
              No upcoming deadlines. You're all caught up!
            </p>
          )}
        </div>
      </div>

      {/* My Courses */}
      <div>
        <h2 className="text-xl font-semibold text-gray-800 mb-4">My Courses</h2>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {safeCourses.length > 0 ? (
            safeCourses.map((course, index) => (
              <motion.div
                key={course._id}
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.3, delay: index * 0.1 }}
                className="bg-white rounded-lg shadow-md overflow-hidden"
              >
                <div 
                  className="h-32 bg-cover bg-center" 
                  style={{ 
                    backgroundImage: `url(${course.coverImage ? `/uploads/${course.coverImage}` : '/img/default-course.jpg'})` 
                  }}
                ></div>
                <div className="p-4">
                  <h3 className="text-lg font-semibold text-gray-800">{course.title}</h3>
                  <p className="text-gray-600 text-sm mt-1">Instructor: {course.teacher.name}</p>
                  <div className="mt-4 flex justify-between items-center">
                    <Link
                      to={`/courses/${course._id}`}
                      className="text-primary-600 hover:text-primary-700 font-medium text-sm"
                    >
                      View Course
                    </Link>
                    <span className="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
                      {course.code}
                    </span>
                  </div>
                </div>
              </motion.div>
            ))
          ) : (
            <div className="col-span-full">
              <p className="text-gray-500 text-center py-8">
                You're not enrolled in any courses yet. 
                <Link to="/courses" className="text-primary-600 hover:underline ml-1">
                  Browse available courses
                </Link>
              </p>
            </div>
          )}
        </div>
      </div>

      {/* Available Quizzes */}
      <div>
        <h2 className="text-xl font-semibold text-gray-800 mb-4">Available Quizzes</h2>
        <div className="bg-white rounded-lg shadow-md overflow-hidden">
          {safeQuizzes.filter(q => !q.submitted).length > 0 ? (
            <div className="divide-y divide-gray-200">
              {safeQuizzes
                .filter(q => !q.submitted)
                .map((quiz) => (
                  <div key={quiz._id} className="p-4 hover:bg-gray-50">
                    <h3 className="font-medium text-gray-800">{quiz.title}</h3>
                    <p className="text-sm text-gray-600">
                      Course: {quiz.course.title}
                    </p>
                    <div className="flex justify-between items-center mt-2">
                      <span className="text-sm text-gray-500">
                        {quiz.questions?.length || 0} Questions
                      </span>
                      <Link
                        to={`/quizzes/${quiz._id}/take`}
                        className="text-primary-600 hover:text-primary-700 text-sm font-medium"
                      >
                        Take Quiz
                      </Link>
                    </div>
                  </div>
                ))}
            </div>
          ) : (
            <p className="text-gray-500 text-center py-8">
              No quizzes available at the moment.
            </p>
          )}
        </div>
      </div>
    </div>
  );
};

export default StudentDashboard;


==================================================
FILE_PATH: client\src\pages\student\SubmitAssignment.js
==================================================
import React, { useState, useEffect, useContext } from 'react';
import { useParams, useNavigate, Link } from 'react-router-dom';
import { motion } from 'framer-motion';
import axios from 'axios';
import moment from 'moment';
import { toast } from 'react-toastify';
import AuthContext from '../../context/AuthContext';
import { 
  ArrowLeftIcon, 
  CalendarIcon,
  ClockIcon,
  UploadIcon,
  ExclamationCircleIcon, // Added missing import
  DocumentIcon // Added missing import
} from '@heroicons/react/outline';

const BACKEND_URL = process.env.REACT_APP_BACKEND_URL || 'http://localhost:5000';

const handleDownload = async (fileName, originalName) => {
  const token = localStorage.getItem('token');
  try {
    const response = await axios.get(
      `${BACKEND_URL}/api/materials/download/${encodeURIComponent(fileName)}`,
      {
        responseType: 'blob',
        headers: { Authorization: `Bearer ${token}` }
      }
    );
    const url = window.URL.createObjectURL(new Blob([response.data]));
    const link = document.createElement('a');
    link.href = url;
    link.setAttribute('download', originalName || fileName);
    document.body.appendChild(link);
    link.click();
    link.remove();
    window.URL.revokeObjectURL(url);
  } catch (error) {
    alert('Download failed: ' + (error.response?.data?.message || error.message));
  }
};

const SubmitAssignment = () => {
  const { id } = useParams();
  const navigate = useNavigate();
  const { user } = useContext(AuthContext);
  
  const [assignment, setAssignment] = useState(null);
  const [submissionFile, setSubmissionFile] = useState(null);
  const [loading, setLoading] = useState(true);
  const [submitting, setSubmitting] = useState(false);
  const [error, setError] = useState(null);
  
  useEffect(() => {
    const fetchAssignmentDetails = async () => {
      try {
        const res = await axios.get(`/api/assignments/${id}`);
        setAssignment(res.data.assignment);
        
        // Check if the assignment belongs to a course the student is enrolled in
        const course = res.data.assignment.course;
        
        // Check if already submitted
        const alreadySubmitted = res.data.assignment.submissions?.some(
          submission => submission.student._id === user._id
        );
        
        if (alreadySubmitted) {
          setError('You have already submitted this assignment');
        }
        
        // Check if deadline passed
        const deadlinePassed = moment(res.data.assignment.deadline).isBefore(moment());
        if (deadlinePassed) {
          setError('The deadline for this assignment has passed');
        }
        
        setLoading(false);
      } catch (error) {
        console.error('Error fetching assignment:', error);
        setError('Error loading assignment details');
        setLoading(false);
      }
    };
    
    fetchAssignmentDetails();
  }, [id, user._id]);
  
  const handleFileChange = (e) => {
    setSubmissionFile(e.target.files[0]);
  };
  
  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!submissionFile) {
      toast.error('Please select a file to submit');
      return;
    }
    
    setSubmitting(true);
    
    try {
      const formData = new FormData();
      formData.append('file', submissionFile);
      
      await axios.post(`/api/assignments/${id}/submit`, formData, {
        headers: {
          'Content-Type': 'multipart/form-data',
        },
      });
      
      toast.success('Assignment submitted successfully!');
      navigate(`/assignments/${id}`);
    } catch (error) {
      console.error('Error submitting assignment:', error);
      toast.error(error.response?.data?.message || 'Error submitting assignment');
    } finally {
      setSubmitting(false);
    }
  };
  
  if (loading) {
    return (
      <div className="flex justify-center items-center h-64">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"></div>
      </div>
    );
  }
  
  if (error) {
    return (
      <div className="max-w-3xl mx-auto">
        <div className="mb-6">
          <button
            onClick={() => navigate(-1)}
            className="flex items-center text-gray-600 hover:text-primary-600"
          >
            <ArrowLeftIcon className="h-4 w-4 mr-1" />
            Back
          </button>
        </div>
        
        <div className="bg-white rounded-lg shadow-md p-6">
          <div className="flex items-center text-red-600 mb-4">
            <ExclamationCircleIcon className="h-6 w-6 mr-2" />
            <h1 className="text-xl font-bold">Cannot Submit Assignment</h1>
          </div>
          
          <p className="text-gray-700 mb-6">{error}</p>
          
          <div className="bg-gray-50 p-4 rounded-md mb-6">
            <h2 className="font-medium text-gray-800 mb-2">{assignment?.title}</h2>
            <p className="text-sm text-gray-600 mb-2">Course: {assignment?.course.title}</p>
            <div className="flex items-center text-sm">
              <ClockIcon className="h-4 w-4 mr-1 text-red-500" />
              <span className="text-red-500">
                Due: {moment(assignment?.deadline).format('MMM D, YYYY [at] h:mm A')}
              </span>
            </div>
          </div>
          
          <Link
            to={`/assignments/${id}`}
            className="inline-block px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700"
          >
            View Assignment Details
          </Link>
        </div>
      </div>
    );
  }
  
  return (
    <div className="max-w-2xl mx-auto py-8 px-2 sm:px-6 lg:px-8 bg-neutral-50 min-h-screen">
      <motion.div initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className="bg-white/90 shadow-card rounded-2xl p-8 border border-primary-50">
        <h1 className="text-2xl font-extrabold font-heading text-primary-400 mb-6 drop-shadow-lg tracking-tight bg-gradient-to-r from-primary-400 to-secondary-500 bg-clip-text text-transparent">
          Submit Assignment
        </h1>
        
        <div className="bg-gray-50 p-4 rounded-md mb-6">
          <h2 className="font-medium text-gray-800 mb-2">{assignment.title}</h2>
          <p className="text-sm text-gray-600 mb-4">Course: {assignment.course.title}</p>
          <p className="text-sm text-gray-600 mb-2">
            Total Points: <span className="font-medium">{assignment.totalPoints}</span>
          </p>
          <div className="flex items-center text-sm">
            <ClockIcon className="h-4 w-4 mr-1" />
            <span>
              Due: {moment(assignment.deadline).format('MMM D, YYYY [at] h:mm A')}
              {moment().isAfter(moment(assignment.deadline)) && (
                <span className="text-red-500 ml-2">(Deadline passed)</span>
              )}
            </span>
          </div>
        </div>
        
        <div className="mb-6">
          <h3 className="font-medium text-gray-800 mb-2">Assignment Instructions</h3>
          <p className="text-gray-700">{assignment.description}</p>
        </div>
        
        {assignment.attachments && assignment.attachments.length > 0 && (
          <div className="mb-6">
            <h3 className="font-medium text-gray-800 mb-2">Assignment Files</h3>
            <div className="space-y-2">
              {assignment.attachments.map((attachment, index) => (
                <div key={index} className="flex items-center">
                  <DocumentIcon className="h-5 w-5 text-gray-500 mr-2" />
                  <button
                    onClick={() => handleDownload(attachment, attachment)}
                    className="text-primary-600 hover:underline"
                  >
                    Download {attachment}
                  </button>
                </div>
              ))}
            </div>
          </div>
        )}
        
        <div className="border-t border-gray-200 pt-6">
          <h3 className="font-medium text-gray-800 mb-4">Your Submission</h3>
          
          <form onSubmit={handleSubmit}>
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-1">
                  Upload your work
                </label>
                <input
                  type="file"
                  onChange={handleFileChange}
                  className="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100"
                />
                <p className="mt-1 text-sm text-gray-500">
                  Upload a file (PDF, Word, etc.) for your assignment submission.
                </p>
              </div>
              
              <div>
                <button
                  type="submit"
                  disabled={submitting || !submissionFile}
                  className={`w-full py-2 px-4 border border-transparent rounded-md font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 ${
                    (submitting || !submissionFile) ? 'opacity-70 cursor-not-allowed' : ''
                  }`}
                >
                  {submitting ? 'Submitting...' : 'Submit Assignment'}
                </button>
              </div>
            </div>
          </form>
        </div>
      </motion.div>
    </div>
  );
};

export default SubmitAssignment;


==================================================
FILE_PATH: client\src\pages\student\TakeQuiz.js
==================================================
import React, { useState, useEffect, useContext } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import { motion } from 'framer-motion';
import axios from 'axios';
import { toast } from 'react-toastify';
import AuthContext from '../../context/AuthContext';

const TakeQuiz = () => {
  const { id } = useParams();
  const navigate = useNavigate();
  const { user } = useContext(AuthContext);
  
  const [quiz, setQuiz] = useState(null);
  const [currentQuestion, setCurrentQuestion] = useState(0);
  const [selectedOptions, setSelectedOptions] = useState({});
  const [textAnswers, setTextAnswers] = useState({});
  const [timeLeft, setTimeLeft] = useState(null);
  const [quizStarted, setQuizStarted] = useState(false);
  const [quizCompleted, setQuizCompleted] = useState(false);
  const [quizResult, setQuizResult] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [submitting, setSubmitting] = useState(false);
  
  useEffect(() => {
    const fetchQuizDetails = async () => {
      try {
        const res = await axios.get(`/api/quizzes/${id}`);
        
        // Check if the student has already taken this quiz
        const alreadyTaken = res.data.quiz.results?.some(
          result => result.student === user._id
        );
        
        if (alreadyTaken) {
          setQuizCompleted(true);
          
          // Fetch the results
          const resultRes = await axios.get(`/api/quizzes/${id}/result`);
          setQuizResult(resultRes.data.result);
        }
        
        setQuiz(res.data.quiz);
        
        // Set time left if there's a time limit
        if (res.data.quiz.timeLimit) {
          setTimeLeft(res.data.quiz.timeLimit * 60); // Convert minutes to seconds
        }
        
        setLoading(false);
      } catch (error) {
        console.error('Error fetching quiz details:', error);
        setError('Failed to load quiz');
        setLoading(false);
      }
    };
    
    fetchQuizDetails();
  }, [id, user._id]);
  
  // Timer effect
  useEffect(() => {
    let timer;
    if (quizStarted && timeLeft !== null && timeLeft > 0) {
      timer = setTimeout(() => {
        setTimeLeft(timeLeft - 1);
      }, 1000);
    } else if (quizStarted && timeLeft === 0) {
      // Auto-submit when timer reaches zero
      submitQuiz();
    }
    
    return () => clearTimeout(timer);
  }, [quizStarted, timeLeft]);
  
  const formatTime = (seconds) => {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = seconds % 60;
    return `${minutes}:${remainingSeconds < 10 ? '0' : ''}${remainingSeconds}`;
  };
  
  const startQuiz = () => {
    setQuizStarted(true);
  };
  
  const handleOptionSelect = (questionIndex, optionId) => {
    const currentQuestionData = quiz.questions[questionIndex];
    
    if (currentQuestionData.type === 'multiple') {
      // For multiple choice, toggle the option
      const currentSelected = selectedOptions[questionIndex] || [];
      const newSelected = currentSelected.includes(optionId)
        ? currentSelected.filter(id => id !== optionId)
        : [...currentSelected, optionId];
      
      setSelectedOptions({
        ...selectedOptions,
        [questionIndex]: newSelected,
      });
    } else {
      // For single choice, replace the selection
    setSelectedOptions({
      ...selectedOptions,
      [questionIndex]: optionId,
      });
    }
  };
  
  const handleTextAnswerChange = (questionIndex, value) => {
    setTextAnswers({
      ...textAnswers,
      [questionIndex]: value,
    });
  };
  
  const goToNextQuestion = () => {
    if (currentQuestion < quiz.questions.length - 1) {
      setCurrentQuestion(currentQuestion + 1);
    }
  };
  
  const goToPreviousQuestion = () => {
    if (currentQuestion > 0) {
      setCurrentQuestion(currentQuestion - 1);
    }
  };
  
  const submitQuiz = async () => {
    setSubmitting(true);
    
    try {
      // Prepare answers array
      const answers = quiz.questions.map((question, index) => {
        if (question.type === 'text') {
          return {
            question: question._id,
            textAnswer: textAnswers[index] || '',
          };
        } else {
          return {
            question: question._id,
            selectedOption: question.type === 'single' ? selectedOptions[index] : undefined,
            selectedOptions: question.type === 'multiple' ? (selectedOptions[index] || []) : undefined,
          };
        }
      });
      
      const res = await axios.post(`/api/quizzes/${id}/submit`, { answers });
      
      setQuizCompleted(true);
      setQuizResult(res.data.result);
      
      toast.success('Quiz submitted successfully!');
    } catch (error) {
      console.error('Error submitting quiz:', error);
      toast.error('Error submitting quiz');
    } finally {
      setSubmitting(false);
    }
  };
  
  if (loading) {
    return (
      <div className="flex justify-center items-center h-64">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"></div>
      </div>
    );
  }
  
  if (error) {
    return (
      <div className="text-center py-12">
        <h2 className="text-xl font-semibold text-gray-800 mb-2">Error</h2>
        <p className="text-gray-600">{error}</p>
        <button
          onClick={() => navigate(-1)}
          className="mt-4 inline-block px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700"
        >
          Go Back
        </button>
      </div>
    );
  }
  
  if (!quiz) {
    return (
      <div className="text-center py-12">
        <h2 className="text-xl font-semibold text-gray-800 mb-2">Quiz Not Found</h2>
        <p className="text-gray-600">The quiz you're looking for doesn't exist or you don't have access to it.</p>
        <button
          onClick={() => navigate(-1)}
          className="mt-4 inline-block px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700"
        >
          Go Back
        </button>
      </div>
    );
  }
  
  if (quizCompleted) {
    return (
      <div className="max-w-3xl mx-auto">
        <div className="bg-white rounded-lg shadow-md p-6">
          <div className="text-center py-6">
            <h1 className="text-2xl font-bold text-gray-800 mb-2">Quiz Completed!</h1>
            <p className="text-gray-600 mb-6">
              You've successfully completed the quiz: {quiz.title}
            </p>
            
            <div className="bg-blue-50 p-6 rounded-lg mb-8">
              <h2 className="text-xl font-semibold text-gray-800 mb-4">Your Results</h2>
              <div className="text-4xl font-bold text-primary-600 mb-2">
                {quizResult.score} / {quizResult.totalPossibleScore}
              </div>
              <p className="text-lg text-gray-700 mb-2">
                {Math.round((quizResult.score / quizResult.totalPossibleScore) * 100)}%
              </p>
              <p className="text-gray-500">
                Submitted on {new Date(quizResult.submittedAt).toLocaleDateString()}
              </p>
            </div>
            
            <button
              onClick={() => navigate(`/courses/${quiz.course}`)}
              className="px-6 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700"
            >
              Back to Course
            </button>
          </div>
        </div>
      </div>
    );
  }
  
  if (!quizStarted) {
    return (
      <div className="max-w-3xl mx-auto">
        <div className="bg-white rounded-lg shadow-md p-6">
          <div className="text-center py-6">
            <h1 className="text-2xl font-bold text-gray-800 mb-2">{quiz.title}</h1>
            <p className="text-gray-600 mb-6">
              {quiz.description}
            </p>
            
            <div className="bg-gray-50 p-6 rounded-lg mb-8">
              <h2 className="text-lg font-semibold text-gray-800 mb-4">Quiz Information</h2>
              <ul className="space-y-2 text-left">
                <li className="flex items-center">
                  <span className="font-medium text-gray-700 mr-2">Questions:</span>
                  <span>{quiz.questions.length}</span>
                </li>
                <li className="flex items-center">
                  <span className="font-medium text-gray-700 mr-2">Time Limit:</span>
                  <span>{quiz.timeLimit ? `${quiz.timeLimit} minutes` : 'No time limit'}</span>
                </li>
                <li className="flex items-center">
                  <span className="font-medium text-gray-700 mr-2">Total Points:</span>
                  <span>
                    {quiz.questions.reduce((total, question) => total + question.points, 0)}
                  </span>
                </li>
              </ul>
            </div>
            
            <div className="bg-yellow-50 p-4 rounded-lg mb-8">
              <p className="text-yellow-700">
                <strong>Note:</strong> Once you start the quiz, you must complete it. Make sure you're ready before starting.
                {quiz.timeLimit ? ' The timer will begin immediately.' : ''}
              </p>
            </div>
            
            <button
              onClick={startQuiz}
              className="px-6 py-3 bg-primary-600 text-white rounded-md hover:bg-primary-700"
            >
              Start Quiz
            </button>
          </div>
        </div>
      </div>
    );
  }
  
  // Quiz is in progress
  const currentQuestionData = quiz.questions[currentQuestion];
  const progress = Math.round(((currentQuestion + 1) / quiz.questions.length) * 100);
  
  return (
    <div className="max-w-3xl mx-auto">
      <div className="bg-white rounded-lg shadow-md p-6">
        {/* Header */}
        <div className="flex justify-between items-center mb-6">
          <h1 className="text-xl font-bold text-gray-800">{quiz.title}</h1>
          
          {timeLeft !== null && (
            <div className={`text-lg font-mono ${timeLeft < 60 ? 'text-red-600' : 'text-gray-700'}`}>
              Time: {formatTime(timeLeft)}
            </div>
          )}
        </div>
        
        {/* Progress bar */}
        <div className="w-full bg-gray-200 rounded-full h-2 mb-6">
          <div
            className="bg-primary-600 h-2 rounded-full"
            style={{ width: `${progress}%` }}
          ></div>
        </div>
        
        {/* Question */}
        <div className="mb-8">
          <h2 className="text-lg font-medium text-gray-800 mb-2">
            Question {currentQuestion + 1} of {quiz.questions.length}
          </h2>
          <p className="text-gray-700 mb-4">{currentQuestionData.questionText}</p>
          <p className="text-sm text-gray-500 mb-2">Points: {currentQuestionData.points}</p>
          <p className="text-sm text-gray-500">
            Type: {currentQuestionData.type === 'single' ? 'Single Choice' : 
                   currentQuestionData.type === 'multiple' ? 'Multiple Choice' : 'Text Answer'}
          </p>
        </div>
        
        {/* Answer Input */}
        {currentQuestionData.type === 'text' ? (
          <div className="mb-8">
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Your Answer
            </label>
            <textarea
              value={textAnswers[currentQuestion] || ''}
              onChange={(e) => handleTextAnswerChange(currentQuestion, e.target.value)}
              rows="4"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
              placeholder="Type your answer here..."
            />
          </div>
        ) : (
        <div className="space-y-3 mb-8">
            {currentQuestionData.options.map((option) => {
              let isSelected = false;
              
              if (currentQuestionData.type === 'single') {
                isSelected = selectedOptions[currentQuestion] === option._id;
              } else if (currentQuestionData.type === 'multiple') {
                const currentSelected = selectedOptions[currentQuestion] || [];
                isSelected = Array.isArray(currentSelected) && currentSelected.includes(option._id);
              }
              
              return (
            <motion.div
              key={option._id}
              whileTap={{ scale: 0.98 }}
              className={`p-3 border rounded-lg cursor-pointer ${
                    isSelected
                  ? 'bg-primary-50 border-primary-300'
                  : 'bg-white border-gray-200 hover:bg-gray-50'
              }`}
              onClick={() => handleOptionSelect(currentQuestion, option._id)}
            >
              <div className="flex items-center">
                <div className={`w-5 h-5 mr-3 rounded-full border ${
                      isSelected
                    ? 'border-primary-600'
                    : 'border-gray-300'
                }`}>
                      {isSelected && (
                    <div className="w-3 h-3 m-1 rounded-full bg-primary-600"></div>
                  )}
                </div>
                <span className="text-gray-700">{option.text}</span>
              </div>
            </motion.div>
              );
            })}
        </div>
        )}
        
        {/* Navigation buttons */}
        <div className="flex justify-between">
          <button
            onClick={goToPreviousQuestion}
            disabled={currentQuestion === 0}
            className={`px-4 py-2 border rounded-md ${
              currentQuestion === 0
                ? 'border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed'
                : 'border-gray-300 bg-white text-gray-700 hover:bg-gray-50'
            }`}
          >
            Previous
          </button>
          
          {currentQuestion < quiz.questions.length - 1 ? (
            <button
              onClick={goToNextQuestion}
              className="px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700"
            >
              Next
            </button>
          ) : (
            <button
              onClick={submitQuiz}
              disabled={submitting}
              className={`px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 ${
                submitting ? 'opacity-70 cursor-not-allowed' : ''
              }`}
            >
              {submitting ? 'Submitting...' : 'Submit Quiz'}
            </button>
          )}
        </div>
      </div>
      
      {/* Question navigator */}
      <div className="mt-6 bg-white rounded-lg shadow-md p-4">
        <h3 className="text-sm font-medium text-gray-700 mb-3">Question Navigator</h3>
        <div className="flex flex-wrap gap-2">
          {quiz.questions.map((question, index) => {
            let hasAnswer = false;
            
            if (question.type === 'text') {
              hasAnswer = textAnswers[index] && textAnswers[index].trim();
            } else if (question.type === 'single') {
              hasAnswer = selectedOptions[index] !== undefined && selectedOptions[index] !== null;
            } else if (question.type === 'multiple') {
              hasAnswer = selectedOptions[index] && Array.isArray(selectedOptions[index]) && selectedOptions[index].length > 0;
            }
            
            return (
            <button
              key={index}
              onClick={() => setCurrentQuestion(index)}
              className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${
                currentQuestion === index
                  ? 'bg-primary-600 text-white'
                    : hasAnswer
                  ? 'bg-green-100 text-green-800 border border-green-300'
                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
              }`}
            >
              {index + 1}
            </button>
            );
          })}
        </div>
      </div>
    </div>
  );
};

export default TakeQuiz;


==================================================
FILE_PATH: client\src\pages\teacher\CreateAssignment.js
==================================================
import React, { useState, useEffect, useContext } from 'react';
import { useNavigate, useParams } from 'react-router-dom';
import axios from 'axios';
import { toast } from 'react-toastify';
import AuthContext from '../../context/AuthContext';
import DatePicker from 'react-datepicker';
import 'react-datepicker/dist/react-datepicker.css';
import { motion } from 'framer-motion';

const CreateAssignment = () => {
  const { courseId } = useParams();
  const navigate = useNavigate();
  const { user } = useContext(AuthContext);
  
  const [formData, setFormData] = useState({
    title: '',
    description: '',
    courseId: courseId || '',
    dueDate: null,
    totalPoints: 100,
    attachments: []
  });
  
  const [courses, setCourses] = useState([]);
  const [loading, setLoading] = useState(false);
  const [loadingCourses, setLoadingCourses] = useState(true);
  
  useEffect(() => {
    const fetchTeacherCourses = async () => {
      try {
        const token = localStorage.getItem('token');
        
        const response = await axios.get('/api/courses/teacher', {
          headers: { Authorization: `Bearer ${token}` }
        });
        
        if (response.data.success) {
          setCourses(response.data.courses);
        } else {
          toast.error('Failed to load courses');
        }
      } catch (error) {
        console.error('Error fetching courses:', error);
        toast.error('Error loading courses');
      } finally {
        setLoadingCourses(false);
      }
    };
    
    fetchTeacherCourses();
  }, []);
  
  const handleInputChange = (e) => {
    setFormData({
      ...formData,
      [e.target.name]: e.target.value
    });
  };
  
  const handleDueDateChange = (date) => {
    setFormData({
      ...formData,
      dueDate: date
    });
  };
  
  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    
    try {
      console.log('Submitting assignment:', formData);
      const token = localStorage.getItem('token');
      
      const response = await axios.post('/api/assignments', formData, {
        headers: {
          'Content-Type': 'application/json',
          Authorization: `Bearer ${token}`
        }
      });
      
      if (response.data.success) {
        toast.success('Assignment created successfully');
        navigate(`/courses/${formData.courseId}`);
      } else {
        toast.error('Failed to create assignment');
      }
    } catch (error) {
      console.error('Error creating assignment:', error);
      toast.error(error.response?.data?.message || 'Failed to create assignment');
    } finally {
      setLoading(false);
    }
  };
  
  if (loadingCourses) {
    return (
      <div className="flex justify-center items-center h-64">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"></div>
      </div>
    );
  }
  
  return (
    <div className="max-w-2xl mx-auto py-8 px-2 sm:px-6 lg:px-8 bg-neutral-50 min-h-screen">
      <motion.div initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className="bg-white/90 shadow-card rounded-2xl p-8 border border-primary-50">
        <h1 className="text-2xl font-extrabold font-heading text-primary-400 mb-6 drop-shadow-lg tracking-tight bg-gradient-to-r from-primary-400 to-secondary-500 bg-clip-text text-transparent">
          Create Assignment
        </h1>
        
        <form onSubmit={handleSubmit} className="space-y-6">
          {/* Assignment Title */}
          <div>
            <label htmlFor="title" className="block text-sm font-medium text-gray-700 mb-1">
              Assignment Title*
            </label>
            <input
              type="text"
              id="title"
              name="title"
              value={formData.title}
              onChange={handleInputChange}
              required
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
              placeholder="e.g., Midterm Project"
            />
          </div>
          
          {/* Course Selection */}
          <div>
            <label htmlFor="courseId" className="block text-sm font-medium text-gray-700 mb-1">
              Course*
            </label>
            <select
              id="courseId"
              name="courseId"
              value={formData.courseId}
              onChange={handleInputChange}
              required
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
              disabled={courseId !== undefined}
            >
              <option value="">Select a course</option>
              {courses.map((course) => (
                <option key={course._id} value={course._id}>
                  {course.title}
                </option>
              ))}
            </select>
          </div>
          
          {/* Description */}
          <div>
            <label htmlFor="description" className="block text-sm font-medium text-gray-700 mb-1">
              Description
            </label>
            <textarea
              id="description"
              name="description"
              value={formData.description}
              onChange={handleInputChange}
              rows="6"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
              placeholder="Provide detailed instructions for the assignment"
            ></textarea>
          </div>
          
          {/* Due Date */}
          <div>
            <label htmlFor="dueDate" className="block text-sm font-medium text-gray-700 mb-1">
              Due Date
            </label>
            <DatePicker
              id="dueDate"
              selected={formData.dueDate}
              onChange={handleDueDateChange}
              showTimeSelect
              timeFormat="HH:mm"
              timeIntervals={15}
              timeCaption="time"
              dateFormat="MMMM d, yyyy h:mm aa"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
              placeholderText="Select due date and time"
            />
            <p className="mt-1 text-xs text-gray-500">
              Leave blank for no deadline
            </p>
          </div>
          
          {/* Total Points */}
          <div>
            <label htmlFor="totalPoints" className="block text-sm font-medium text-gray-700 mb-1">
              Total Points
            </label>
            <input
              type="number"
              id="totalPoints"
              name="totalPoints"
              value={formData.totalPoints}
              onChange={handleInputChange}
              min="0"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
            />
          </div>
          
          {/* Submit Button */}
          <div className="pt-4">
            <button
              type="submit"
              disabled={loading}
              className={`w-full py-2 px-4 border border-transparent rounded-md font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 ${
                loading ? 'opacity-70 cursor-not-allowed' : ''
              }`}
            >
              {loading ? 'Creating...' : 'Create Assignment'}
            </button>
          </div>
        </form>
      </motion.div>
    </div>
  );
};

export default CreateAssignment;


==================================================
FILE_PATH: client\src\pages\teacher\CreateCourse.js
==================================================
import React, { useState, useContext } from 'react';
import { useNavigate } from 'react-router-dom';
import { toast } from 'react-toastify';
import axios from 'axios';
import AuthContext from '../../context/AuthContext';
import { motion } from 'framer-motion';

const CreateCourse = () => {
  const { user } = useContext(AuthContext);
  const navigate = useNavigate();
  
  const [formData, setFormData] = useState({
    title: '',
    description: '',
    code: '',
    coverImageUrl: '',
  });
  
  const [loading, setLoading] = useState(false);
  
  const { title, description, code, coverImageUrl } = formData;
  
  const onChange = (e) => {
    setFormData({ ...formData, [e.target.name]: e.target.value });
  };
  
  const onSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    
    try {
      const token = localStorage.getItem('token');
      if (!token) {
        toast.error('You must be logged in to create a course');
        return;
      }
      
      const response = await axios.post('/api/courses', formData, {
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        }
      });
      
      if (response.data.success) {
        toast.success('Course created successfully');
        // Redirect after a short delay to allow the toast to be visible
        setTimeout(() => {
          navigate('/teacher/dashboard');
        }, 1000);
      }
    } catch (error) {
      console.error('Error creating course:', error);
      toast.error(error.response?.data?.message || 'Failed to create course');
    } finally {
      setLoading(false);
    }
  };
  
  return (
    <div className="max-w-2xl mx-auto py-8 px-2 sm:px-6 lg:px-8 bg-neutral-50 min-h-screen">
      <motion.div initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className="bg-white/90 shadow-card rounded-2xl p-8 border border-primary-50">
        <h1 className="text-2xl font-extrabold font-heading text-primary-400 mb-6 drop-shadow-lg tracking-tight bg-gradient-to-r from-primary-400 to-secondary-500 bg-clip-text text-transparent">
          Create Course
        </h1>
        
        <form onSubmit={onSubmit} className="space-y-6">
          {/* Course Title */}
          <div>
            <label htmlFor="title" className="block text-sm font-medium text-gray-700 mb-1">
              Course Title*
            </label>
            <input
              type="text"
              id="title"
              name="title"
              value={title}
              onChange={onChange}
              required
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
              placeholder="e.g., Introduction to Web Development"
            />
          </div>
          
          {/* Course Code */}
          <div>
            <label htmlFor="code" className="block text-sm font-medium text-gray-700 mb-1">
              Course Code*
            </label>
            <input
              type="text"
              id="code"
              name="code"
              value={code}
              onChange={onChange}
              required
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
              placeholder="e.g., WEB101"
            />
            <p className="mt-1 text-xs text-gray-500">
              A unique code for your course. Students will use this to find your course.
            </p>
          </div>
          
          {/* Course Description */}
          <div>
            <label htmlFor="description" className="block text-sm font-medium text-gray-700 mb-1">
              Description*
            </label>
            <textarea
              id="description"
              name="description"
              value={description}
              onChange={onChange}
              required
              rows="4"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
              placeholder="Provide a detailed description of your course"
            ></textarea>
          </div>
          
          {/* Cover Image URL */}
          <div>
            <label htmlFor="coverImageUrl" className="block text-sm font-medium text-gray-700 mb-1">
              Cover Image URL
            </label>
            <input
              type="text"
              id="coverImageUrl"
              name="coverImageUrl"
              value={coverImageUrl}
              onChange={onChange}
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
              placeholder="Paste an image URL (e.g., from Unsplash or Pexels)"
            />
            <p className="mt-1 text-xs text-gray-500">
              Paste a direct image URL from the internet. Recommended size: 1280x720 pixels (16:9 ratio)
            </p>
          </div>
          
          {/* Image Preview */}
          {coverImageUrl && (
            <div className="mt-4">
              <p className="text-sm font-medium text-gray-700 mb-2">Preview:</p>
              <div className="relative w-full h-48 rounded-lg overflow-hidden">
                <img
                  src={coverImageUrl}
                  alt="Course cover preview"
                  className="w-full h-full object-cover"
                />
              </div>
            </div>
          )}
          
          {/* Submit Button */}
          <div className="pt-4">
            <button
              type="submit"
              disabled={loading}
              className={`w-full py-2 px-4 border border-transparent rounded-md font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 ${
                loading ? 'opacity-70 cursor-not-allowed' : ''
              }`}
            >
              {loading ? 'Creating...' : 'Create Course'}
            </button>
          </div>
        </form>
      </motion.div>
    </div>
  );
};

export default CreateCourse;


==================================================
FILE_PATH: client\src\pages\teacher\CreateMaterial.js
==================================================
import React, { useState, useEffect, useContext } from 'react';
import { useNavigate, useParams } from 'react-router-dom';
import axios from 'axios';
import { toast } from 'react-toastify';
import AuthContext from '../../context/AuthContext';
import {
  DocumentIcon,
  LinkIcon,
  PhotographIcon,
  FilmIcon,
  DocumentTextIcon
} from '@heroicons/react/outline';
import { motion } from 'framer-motion';

const CreateMaterial = () => {
  const { courseId } = useParams();
  const navigate = useNavigate();
  const { user } = useContext(AuthContext);
  
  const [formData, setFormData] = useState({
    title: '',
    description: '',
    courseId: courseId || '',
    type: 'document',
    link: '',
  });
  
  const [file, setFile] = useState(null);
  const [courses, setCourses] = useState([]);
  const [loading, setLoading] = useState(false);
  const [loadingCourses, setLoadingCourses] = useState(true);
  
  useEffect(() => {
    const fetchTeacherCourses = async () => {
      try {
        const token = localStorage.getItem('token');
        
        const response = await axios.get('/api/courses/teacher', {
          headers: { Authorization: `Bearer ${token}` }
        });
        
        if (response.data.success) {
          setCourses(response.data.courses || []);
        } else {
          toast.error('Failed to load courses');
        }
      } catch (error) {
        console.error('Error fetching courses:', error);
        toast.error('Error loading courses');
      } finally {
        setLoadingCourses(false);
      }
    };
    
    fetchTeacherCourses();
  }, []);
  
  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData({ ...formData, [name]: value });
  };
  
  const handleFileChange = (e) => {
    setFile(e.target.files[0]);
  };
  
  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    
    try {
      const token = localStorage.getItem('token');
      
      // Create form data for file upload
      const materialFormData = new FormData();
      materialFormData.append('title', formData.title);
      materialFormData.append('description', formData.description);
      materialFormData.append('courseId', formData.courseId);
      materialFormData.append('type', formData.type);
      
      // Handle different material types
      if (formData.type === 'link') {
        materialFormData.append('link', formData.link);
      } else if (file) {
        materialFormData.append('file', file);
      }
      
      const response = await axios.post('/api/materials', materialFormData, {
        headers: {
          'Content-Type': 'multipart/form-data',
          Authorization: `Bearer ${token}`
        }
      });
      
      if (response.data.success) {
        toast.success('Material created successfully');
        navigate(`/courses/${formData.courseId}`);
      } else {
        toast.error('Failed to create material');
      }
    } catch (error) {
      console.error('Error creating material:', error);
      toast.error(error.response?.data?.message || 'Failed to create material');
    } finally {
      setLoading(false);
    }
  };
  
  if (loadingCourses) {
    return (
      <div className="flex justify-center items-center h-64">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"></div>
      </div>
    );
  }
  
  return (
    <div className="max-w-2xl mx-auto py-8 px-2 sm:px-6 lg:px-8 bg-neutral-50 min-h-screen">
      <motion.div initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className="bg-white/90 shadow-card rounded-2xl p-8 border border-primary-50">
        <h1 className="text-2xl font-extrabold font-heading text-primary-400 mb-6 drop-shadow-lg tracking-tight bg-gradient-to-r from-primary-400 to-secondary-500 bg-clip-text text-transparent">
          Upload Material
        </h1>
        
        <form onSubmit={handleSubmit} className="space-y-6">
          {/* Material Title */}
          <div>
            <label htmlFor="title" className="block text-sm font-medium text-gray-700 mb-1">
              Title*
            </label>
            <input
              type="text"
              id="title"
              name="title"
              value={formData.title}
              onChange={handleInputChange}
              required
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
              placeholder="e.g., Week 1 Lecture Notes"
            />
          </div>
          
          {/* Course Selection */}
          <div>
            <label htmlFor="courseId" className="block text-sm font-medium text-gray-700 mb-1">
              Course*
            </label>
            <select
              id="courseId"
              name="courseId"
              value={formData.courseId}
              onChange={handleInputChange}
              required
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
              disabled={courseId !== undefined}
            >
              <option value="">Select a course</option>
              {courses.map((course) => (
                <option key={course._id} value={course._id}>
                  {course.title}
                </option>
              ))}
            </select>
          </div>
          
          {/* Material Description */}
          <div>
            <label htmlFor="description" className="block text-sm font-medium text-gray-700 mb-1">
              Description
            </label>
            <textarea
              id="description"
              name="description"
              value={formData.description}
              onChange={handleInputChange}
              rows="4"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
              placeholder="Brief description of the material"
            ></textarea>
          </div>
          
          {/* Material Type */}
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Material Type*
            </label>
            <div className="grid grid-cols-2 sm:grid-cols-4 gap-3">
              <button
                type="button"
                onClick={() => setFormData({ ...formData, type: 'document' })}
                className={`p-3 flex flex-col items-center justify-center rounded-lg border ${
                  formData.type === 'document'
                    ? 'border-primary-500 bg-primary-50 text-primary-700'
                    : 'border-gray-300 hover:border-gray-400'
                }`}
              >
                <DocumentIcon className="h-8 w-8" />
                <span className="mt-1 text-sm">Document</span>
              </button>
              
              <button
                type="button"
                onClick={() => setFormData({ ...formData, type: 'image' })}
                className={`p-3 flex flex-col items-center justify-center rounded-lg border ${
                  formData.type === 'image'
                    ? 'border-primary-500 bg-primary-50 text-primary-700'
                    : 'border-gray-300 hover:border-gray-400'
                }`}
              >
                <PhotographIcon className="h-8 w-8" />
                <span className="mt-1 text-sm">Image</span>
              </button>
              
              <button
                type="button"
                onClick={() => setFormData({ ...formData, type: 'link' })}
                className={`p-3 flex flex-col items-center justify-center rounded-lg border ${
                  formData.type === 'link'
                    ? 'border-primary-500 bg-primary-50 text-primary-700'
                    : 'border-gray-300 hover:border-gray-400'
                }`}
              >
                <LinkIcon className="h-8 w-8" />
                <span className="mt-1 text-sm">Link</span>
              </button>
              
              <button
                type="button"
                onClick={() => setFormData({ ...formData, type: 'other' })}
                className={`p-3 flex flex-col items-center justify-center rounded-lg border ${
                  formData.type === 'other'
                    ? 'border-primary-500 bg-primary-50 text-primary-700'
                    : 'border-gray-300 hover:border-gray-400'
                }`}
              >
                <DocumentTextIcon className="h-8 w-8" />
                <span className="mt-1 text-sm">Other</span>
              </button>
            </div>
          </div>
          
          {/* Material Upload or Link */}
          {formData.type === 'link' ? (
            <div>
              <label htmlFor="link" className="block text-sm font-medium text-gray-700 mb-1">
                External Link*
              </label>
              <input
                type="url"
                id="link"
                name="link"
                value={formData.link}
                onChange={handleInputChange}
                required
                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                placeholder="https://example.com/resource"
              />
            </div>
          ) : (
            <div>
              <label htmlFor="file" className="block text-sm font-medium text-gray-700 mb-1">
                Upload File*
              </label>
              <input
                type="file"
                id="file"
                onChange={handleFileChange}
                required
                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
              />
              <p className="mt-1 text-xs text-gray-500">
                Max file size: 10MB. Accepted formats: PDF, Word, Excel, PowerPoint, images, zip.
              </p>
            </div>
          )}
          
          {/* Submit Button */}
          <div className="pt-4">
            <button
              type="submit"
              disabled={loading}
              className={`w-full py-2 px-4 border border-transparent rounded-md font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 ${
                loading ? 'opacity-70 cursor-not-allowed' : ''
              }`}
            >
              {loading ? 'Uploading...' : 'Upload Material'}
            </button>
          </div>
        </form>
      </motion.div>
    </div>
  );
};

export default CreateMaterial;


==================================================
FILE_PATH: client\src\pages\teacher\CreateNotice.js
==================================================
import React, { useState, useEffect, useContext } from 'react';
import { useNavigate, useParams } from 'react-router-dom';
import axios from 'axios';
import { toast } from 'react-toastify';
import AuthContext from '../../context/AuthContext';
import { motion } from 'framer-motion';

const CreateNotice = () => {
  const { courseId } = useParams();
  const navigate = useNavigate();
  const { user } = useContext(AuthContext);
  
  const [formData, setFormData] = useState({
    title: '',
    content: '',
    courseId: courseId || '',
    priority: 'low',
    pinned: false,
    attachments: []
  });
  
  const [courses, setCourses] = useState([]);
  const [loading, setLoading] = useState(false);
  const [loadingCourses, setLoadingCourses] = useState(true);
  
  useEffect(() => {
    const fetchTeacherCourses = async () => {
      try {
        const token = localStorage.getItem('token');
        
        const response = await axios.get('/api/courses/teacher', {
          headers: { Authorization: `Bearer ${token}` }
        });
        
        if (response.data.success) {
          setCourses(response.data.courses || []);
        } else {
          toast.error('Failed to load courses');
        }
      } catch (error) {
        console.error('Error fetching courses:', error);
        toast.error('Error loading courses');
      } finally {
        setLoadingCourses(false);
      }
    };
    
    fetchTeacherCourses();
  }, []);
  
  const handleInputChange = (e) => {
    const { name, value, type, checked } = e.target;
    setFormData({
      ...formData,
      [name]: type === 'checkbox' ? checked : value
    });
  };
  
  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    
    try {
      const token = localStorage.getItem('token');
      
      console.log('Submitting notice data:', formData);
      const response = await axios.post('/api/notices', formData, {
        headers: {
          'Content-Type': 'application/json',
          Authorization: `Bearer ${token}`
        }
      });
      
      if (response.data.success) {
        toast.success('Notice created successfully');
        navigate(`/courses/${formData.courseId}`);
      } else {
        toast.error('Failed to create notice');
      }
    } catch (error) {
      console.error('Error creating notice:', error);
      toast.error(error.response?.data?.message || 'Failed to create notice');
    } finally {
      setLoading(false);
    }
  };
  
  if (loadingCourses) {
    return (
      <div className="flex justify-center items-center h-64">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"></div>
      </div>
    );
  }
  
  return (
    <div className="max-w-2xl mx-auto py-8 px-2 sm:px-6 lg:px-8 bg-neutral-50 min-h-screen">
      <motion.div initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className="bg-white/90 shadow-card rounded-2xl p-8 border border-primary-50">
        <h1 className="text-2xl font-extrabold font-heading text-primary-400 mb-6 drop-shadow-lg tracking-tight bg-gradient-to-r from-primary-400 to-secondary-500 bg-clip-text text-transparent">
          Create Notice
        </h1>
        
        <form onSubmit={handleSubmit} className="space-y-6">
          {/* Notice Title */}
          <div>
            <label htmlFor="title" className="block text-sm font-medium text-gray-700 mb-1">
              Notice Title*
            </label>
            <input
              type="text"
              id="title"
              name="title"
              value={formData.title}
              onChange={handleInputChange}
              required
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
              placeholder="e.g., Important Announcement"
            />
          </div>
          
          {/* Course Selection */}
          <div>
            <label htmlFor="courseId" className="block text-sm font-medium text-gray-700 mb-1">
              Course*
            </label>
            <select
              id="courseId"
              name="courseId"
              value={formData.courseId}
              onChange={handleInputChange}
              required
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
              disabled={courseId !== undefined}
            >
              <option value="">Select a course</option>
              {courses.map((course) => (
                <option key={course._id} value={course._id}>
                  {course.title}
                </option>
              ))}
            </select>
          </div>
          
          {/* Notice Content */}
          <div>
            <label htmlFor="content" className="block text-sm font-medium text-gray-700 mb-1">
              Content*
            </label>
            <textarea
              id="content"
              name="content"
              value={formData.content}
              onChange={handleInputChange}
              required
              rows="6"
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
              placeholder="Enter your notice content here"
            ></textarea>
          </div>
          
          {/* Priority Selection */}
          <div>
            <label htmlFor="priority" className="block text-sm font-medium text-gray-700 mb-1">
              Priority
            </label>
            <select
              id="priority"
              name="priority"
              value={formData.priority}
              onChange={handleInputChange}
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
            >
              <option value="low">Low</option>
              <option value="medium">Medium</option>
              <option value="high">High</option>
            </select>
          </div>
          
          {/* Pin Notice Checkbox */}
          <div className="flex items-center">
            <input
              type="checkbox"
              id="pinned"
              name="pinned"
              checked={formData.pinned}
              onChange={handleInputChange}
              className="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"
            />
            <label htmlFor="pinned" className="ml-2 block text-sm text-gray-700">
              Pin this notice to the top
            </label>
          </div>
          
          {/* Submit Button */}
          <div className="pt-4">
            <button
              type="submit"
              disabled={loading}
              className={`w-full py-2 px-4 border border-transparent rounded-md font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 ${
                loading ? 'opacity-70 cursor-not-allowed' : ''
              }`}
            >
              {loading ? 'Creating...' : 'Create Notice'}
            </button>
          </div>
        </form>
      </motion.div>
    </div>
  );
};

export default CreateNotice;
             

==================================================
FILE_PATH: client\src\pages\teacher\CreateQuiz.js
==================================================
import React, { useState, useEffect } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import axios from 'axios';
import DatePicker from 'react-datepicker';
import 'react-datepicker/dist/react-datepicker.css';
import { toast } from 'react-toastify';
import { motion, AnimatePresence } from 'framer-motion';
import {
  ArrowLeftIcon,
  PlusCircleIcon,
  TrashIcon,
  CheckCircleIcon,
  XCircleIcon,
} from '@heroicons/react/solid';

const CreateQuiz = () => {
  const { courseId } = useParams();
  const navigate = useNavigate();
  
  const [formData, setFormData] = useState({
    title: '',
    description: '',
    timeLimit: 0,
    isPublished: false,
    availableFrom: null,
    availableTo: null,
  });
  const [questions, setQuestions] = useState([]);
  const [submitting, setSubmitting] = useState(false);
  const [loading, setLoading] = useState(true);
  const [course, setCourse] = useState(null);
  
  useEffect(() => {
    const fetchCourse = async () => {
      try {
        const res = await axios.get(`/api/courses/${courseId}`);
        setCourse(res.data.course);
        setLoading(false);
      } catch (error) {
        console.error('Error fetching course:', error);
        setLoading(false);
      }
    };
    
    fetchCourse();
  }, [courseId]);
  
  const handleInputChange = (e) => {
    const { name, value, type, checked } = e.target;
    setFormData({
      ...formData,
      [name]: type === 'checkbox' ? checked : value,
    });
  };
  
  const handleQuestionChange = (index, field, value) => {
    const updatedQuestions = [...questions];
    updatedQuestions[index][field] = value;
    
    // If question type is changed, update the structure accordingly
    if (field === 'type') {
      if (value === 'text') {
        // For text questions, remove options and add correctTextAnswers
        updatedQuestions[index] = {
          ...updatedQuestions[index],
          options: [],
          correctTextAnswers: [''] // Initialize with one empty answer
        };
      } else {
        // For choice questions, add options and remove correctTextAnswers
        updatedQuestions[index] = {
          ...updatedQuestions[index],
          options: [
            { text: '', isCorrect: false },
            { text: '', isCorrect: false },
            { text: '', isCorrect: false },
            { text: '', isCorrect: false }
          ],
          correctTextAnswers: []
        };
      }
    }
    
    setQuestions(updatedQuestions);
  };
  
  const handleOptionChange = (questionIndex, optionIndex, field, value) => {
    const updatedQuestions = [...questions];
    updatedQuestions[questionIndex].options[optionIndex][field] = value;
    setQuestions(updatedQuestions);
  };
  
  const handleCorrectOptionChange = (questionIndex, optionIndex) => {
    const updatedQuestions = [...questions];
    const question = updatedQuestions[questionIndex];
    if (question.type === 'multiple') {
      // Toggle independently
      question.options[optionIndex].isCorrect = !question.options[optionIndex].isCorrect;
    } else {
      // Only one correct
      question.options.forEach((option, idx) => {
        option.isCorrect = idx === optionIndex ? !option.isCorrect : false;
      });
    }
    setQuestions(updatedQuestions);
  };
  
  const addQuestion = () => {
    setQuestions([
      ...questions,
      {
        questionText: '',
        points: 1,
        explanation: '',
        type: 'single',
        options: [
          { text: '', isCorrect: false },
          { text: '', isCorrect: false },
          { text: '', isCorrect: false },
          { text: '', isCorrect: false }
        ],
        correctTextAnswers: [],
      }
    ]);
  };
  
  const removeQuestion = (index) => {
    if (questions.length > 1) {
      const updatedQuestions = [...questions];
      updatedQuestions.splice(index, 1);
      setQuestions(updatedQuestions);
    } else {
      toast.error('Quiz must have at least one question');
    }
  };
  
  const addOption = (questionIndex) => {
    const updatedQuestions = [...questions];
    if (updatedQuestions[questionIndex].options.length < 6) {
      updatedQuestions[questionIndex].options.push({ text: '', isCorrect: false });
      setQuestions(updatedQuestions);
    } else {
      toast.error('Maximum 6 options allowed per question');
    }
  };
  
  const removeOption = (questionIndex, optionIndex) => {
    const updatedQuestions = [...questions];
    if (updatedQuestions[questionIndex].options.length > 2) {
      updatedQuestions[questionIndex].options.splice(optionIndex, 1);
      setQuestions(updatedQuestions);
    } else {
      toast.error('Question must have at least 2 options');
    }
  };
  
  const validateForm = () => {
    // Check basic form data
    if (!formData.title.trim() || !formData.description.trim()) {
      toast.error('Quiz title and description are required');
      return false;
    }
    
    // Validate questions
    for (let i = 0; i < questions.length; i++) {
      const question = questions[i];
      if (!question.questionText.trim()) {
        toast.error(`Question ${i + 1} text is required`);
        return false;
      }
      
      if (question.type === 'text') {
        // Validate text questions
        if (!question.correctTextAnswers || question.correctTextAnswers.length === 0 || 
            question.correctTextAnswers.some(ans => !ans.trim())) {
          toast.error(`Question ${i + 1} must have at least one correct text answer`);
          return false;
        }
      } else {
        // Validate choice questions
        // Check if at least one option is marked as correct
        const hasCorrectOption = question.options.some(option => option.isCorrect);
        if (!hasCorrectOption) {
          toast.error(`Question ${i + 1} must have at least one correct answer`);
          return false;
        }
        
        // Check if all options have text
        for (let j = 0; j < question.options.length; j++) {
          if (!question.options[j].text.trim()) {
            toast.error(`Option ${j + 1} in Question ${i + 1} is empty`);
            return false;
          }
        }
      }
    }
    
    return true;
  };
  
  const handleSubmit = async (e) => {
    e.preventDefault();
    
    if (!validateForm()) {
      return;
    }
    
    setSubmitting(true);
    
    try {
      // Prepare questions data - filter out options for text questions
      const preparedQuestions = questions.map(question => {
        if (question.type === 'text') {
          return {
            questionText: question.questionText,
            type: question.type,
            points: question.points,
            explanation: question.explanation,
            correctTextAnswers: question.correctTextAnswers || []
          };
        } else {
          return {
            questionText: question.questionText,
            type: question.type,
            points: question.points,
            explanation: question.explanation,
            options: question.options
          };
        }
      });
      
      const quizData = {
        ...formData,
        course: courseId,
        questions: preparedQuestions,
      };
      
      console.log('Submitting quiz data:', JSON.stringify(quizData, null, 2));
      
      const res = await axios.post('/api/quizzes', quizData);
      
      toast.success('Quiz created successfully!');
      navigate(`/quizzes/${res.data.quiz._id}`);
    } catch (error) {
      console.error('Error creating quiz:', error);
      if (error.response?.data?.errors) {
        error.response.data.errors.forEach(err => toast.error(err));
      } else {
        toast.error(error.response?.data?.message || 'Error creating quiz');
      }
    } finally {
      setSubmitting(false);
    }
  };
  
  if (loading) {
    return (
      <div className="flex justify-center items-center h-64">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"></div>
      </div>
    );
  }
  
  return (
    <div className="max-w-2xl mx-auto py-8 px-2 sm:px-6 lg:px-8 bg-neutral-50 min-h-screen">
      <motion.div initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className="bg-white/90 shadow-card rounded-2xl p-8 border border-primary-50">
        <h1 className="text-2xl font-extrabold font-heading text-primary-400 mb-6 drop-shadow-lg tracking-tight bg-gradient-to-r from-primary-400 to-secondary-500 bg-clip-text text-transparent">
          Create Quiz
        </h1>
        {/* Back Button */}
        <div className="mb-6">
          <button
            onClick={() => navigate(-1)}
            className="flex items-center text-gray-600 hover:text-primary-600"
          >
            <ArrowLeftIcon className="h-4 w-4 mr-1" />
            Back to Course
          </button>
        </div>
        
        <div className="bg-white rounded-lg shadow-md p-6 mb-6">
          <h2 className="text-lg font-semibold text-gray-800 mb-6">Create New Quiz</h2>
          
          <div className="mb-6 p-4 bg-blue-50 rounded-md">
            <p className="text-blue-700">
              Creating quiz for: <span className="font-semibold">{course.title}</span>
            </p>
          </div>
          
          <form onSubmit={handleSubmit}>
            {/* Quiz Basic Information */}
            <div className="space-y-6 mb-8">
              <h3 className="text-lg font-semibold text-gray-800">Quiz Details</h3>
              
              {/* Title */}
              <div>
                <label htmlFor="title" className="block text-sm font-medium text-gray-700 mb-1">
                  Quiz Title*
                </label>
                <input
                  type="text"
                  id="title"
                  name="title"
                  value={formData.title}
                  onChange={handleInputChange}
                  required
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                  placeholder="e.g., Chapter 5 Quiz: Advanced Concepts"
                />
              </div>
              
              {/* Description */}
              <div>
                <label htmlFor="description" className="block text-sm font-medium text-gray-700 mb-1">
                  Description*
                </label>
                <textarea
                  id="description"
                  name="description"
                  value={formData.description}
                  onChange={handleInputChange}
                  required
                  rows="3"
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                  placeholder="Provide a description of what this quiz covers"
                ></textarea>
              </div>
              
              {/* Time Limit and Publish Status - 2 columns */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label htmlFor="timeLimit" className="block text-sm font-medium text-gray-700 mb-1">
                    Time Limit (minutes)
                  </label>
                  <input
                    type="number"
                    id="timeLimit"
                    name="timeLimit"
                    value={formData.timeLimit}
                    onChange={handleInputChange}
                    min="0"
                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                    placeholder="Enter 0 for no time limit"
                  />
                  <p className="mt-1 text-xs text-gray-500">
                    Enter 0 for no time limit
                  </p>
                </div>
                
                <div className="flex items-center">
                  <input
                    type="checkbox"
                    id="isPublished"
                    name="isPublished"
                    checked={formData.isPublished}
                    onChange={handleInputChange}
                    className="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"
                  />
                  <label htmlFor="isPublished" className="ml-2 block text-sm text-gray-700">
                    Publish quiz immediately
                  </label>
                </div>
              </div>
              
              {/* Date Range - 2 columns */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label htmlFor="availableFrom" className="block text-sm font-medium text-gray-700 mb-1">
                    Available From
                  </label>
                  <DatePicker
                    selected={formData.availableFrom}
                    onChange={(date) => setFormData({ ...formData, availableFrom: date })}
                    showTimeSelect
                    dateFormat="MMMM d, yyyy h:mm aa"
                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                  />
                </div>
                
                <div>
                  <label htmlFor="availableTo" className="block text-sm font-medium text-gray-700 mb-1">
                    Available Until
                  </label>
                  <DatePicker
                    selected={formData.availableTo}
                    onChange={(date) => setFormData({ ...formData, availableTo: date })}
                    showTimeSelect
                    dateFormat="MMMM d, yyyy h:mm aa"
                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                  />
                </div>
              </div>
            </div>
            
            {/* Questions Section */}
            <div className="border-t border-gray-200 pt-6 mb-8">
              <div className="flex justify-between items-center mb-6">
                <h3 className="text-lg font-semibold text-gray-800">Questions</h3>
                <button
                  type="button"
                  onClick={addQuestion}
                  className="inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                >
                  <PlusCircleIcon className="h-4 w-4 mr-1" />
                  Add Question
                </button>
              </div>
              <div className="mb-4 p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded">
                <p className="text-sm text-yellow-800">
                  <b>Tip:</b> For <b>Multiple Choice</b> questions, you can select more than one correct answer. For <b>Single Choice</b>, only one correct answer is allowed. For <b>Text Answer</b> questions, you can add multiple acceptable answers (case-insensitive match).
                </p>
              </div>
              <AnimatePresence>
                {questions.map((question, qIndex) => (
                  <motion.div
                    key={qIndex}
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    exit={{ opacity: 0, height: 0 }}
                    className="p-4 border border-gray-200 rounded-lg mb-6"
                  >
                    <div className="flex justify-between items-start mb-4">
                      <h4 className="font-medium text-gray-800">Question {qIndex + 1}</h4>
                      <button
                        type="button"
                        onClick={() => removeQuestion(qIndex)}
                        className="text-red-500 hover:text-red-700"
                      >
                        <TrashIcon className="h-5 w-5" />
                      </button>
                    </div>
                    
                    {/* Question Text */}
                    <div className="mb-4">
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Question Text*
                      </label>
                      <textarea
                        value={question.questionText}
                        onChange={(e) => handleQuestionChange(qIndex, 'questionText', e.target.value)}
                        rows="2"
                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                        placeholder="Enter your question here"
                        required
                      ></textarea>
                    </div>
                    
                    {/* Points */}
                    <div className="mb-4">
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Points
                      </label>
                      <input
                        type="number"
                        value={question.points}
                        onChange={(e) => handleQuestionChange(qIndex, 'points', parseInt(e.target.value) || 1)}
                        min="1"
                        className="w-32 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                      />
                    </div>
                    
                    {/* Question Type */}
                    <div className="mb-4">
                      <label className="block text-sm font-medium text-gray-700 mb-1">Question Type*</label>
                      <select
                        value={question.type || 'single'}
                        onChange={e => handleQuestionChange(qIndex, 'type', e.target.value)}
                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                      >
                        <option value="single">Single Choice (Radio)</option>
                        <option value="multiple">Multiple Choice (Checkboxes)</option>
                        <option value="text">Text Answer</option>
                      </select>
                    </div>
                    
                    {/* Answer Options */}
                    {question.type !== 'text' && (
                      <div className="mb-4">
                        <label className="block text-sm font-medium text-gray-700 mb-3">
                          Answer Options
                        </label>
                        {question.type === 'multiple' && (
                          <div className="mb-2 text-xs text-blue-600 font-medium">You can select <b>multiple</b> correct answers for this question.</div>
                        )}
                        {question.type === 'single' && (
                          <div className="mb-2 text-xs text-blue-600 font-medium">Only <b>one</b> correct answer can be selected for this question.</div>
                        )}
                        <div className="space-y-3">
                          {question.options.map((option, oIndex) => (
                            <div key={oIndex} className="flex items-center">
                              <button
                                type="button"
                                onClick={() => handleCorrectOptionChange(qIndex, oIndex)}
                                className={`flex-shrink-0 mr-2 ${
                                  option.isCorrect
                                    ? 'text-green-600 hover:text-green-700'
                                    : 'text-gray-400 hover:text-gray-500'
                                }`}
                              >
                                {option.isCorrect ? (
                                  <CheckCircleIcon className="h-5 w-5" />
                                ) : (
                                  <XCircleIcon className="h-5 w-5" />
                                )}
                              </button>
                              <input
                                type="text"
                                value={option.text}
                                onChange={e => handleOptionChange(qIndex, oIndex, 'text', e.target.value)}
                                className={`flex-grow px-3 py-2 border rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${
                                  option.isCorrect
                                    ? 'border-green-300 bg-green-50'
                                    : 'border-gray-300'
                                }`}
                                placeholder={`Option ${oIndex + 1}`}
                                required
                              />
                              <button
                                type="button"
                                onClick={() => removeOption(qIndex, oIndex)}
                                className="flex-shrink-0 ml-2 text-red-500 hover:text-red-700"
                                disabled={question.options.length <= 2}
                              >
                                <TrashIcon className="h-5 w-5" />
                              </button>
                            </div>
                          ))}
                        </div>
                        <button
                          type="button"
                          onClick={() => addOption(qIndex)}
                          className="mt-3 inline-flex items-center px-2 py-1 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                        >
                          <PlusCircleIcon className="h-4 w-4 mr-1" />
                          Add Option
                        </button>
                      </div>
                    )}
                    
                    {/* Explanation */}
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Explanation (Optional)
                      </label>
                      <textarea
                        value={question.explanation}
                        onChange={(e) => handleQuestionChange(qIndex, 'explanation', e.target.value)}
                        rows="2"
                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                        placeholder="Explain why the correct answer is right (shown after quiz submission)"
                      ></textarea>
                    </div>
                    
                    {/* Text Answer */}
                    {question.type === 'text' && (
                      <div className="mb-4">
                        <label className="block text-sm font-medium text-gray-700 mb-1">
                          Correct Text Answer(s)*
                        </label>
                        {question.correctTextAnswers && question.correctTextAnswers.length > 0 && question.correctTextAnswers.map((ans, ansIdx) => (
                          <div key={ansIdx} className="flex items-center mb-2">
                            <input
                              type="text"
                              value={ans}
                              onChange={e => {
                                const updatedQuestions = [...questions];
                                updatedQuestions[qIndex].correctTextAnswers[ansIdx] = e.target.value;
                                setQuestions(updatedQuestions);
                              }}
                              className="flex-grow px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                              placeholder={`Correct Answer ${ansIdx + 1}`}
                              required
                            />
                            <button
                              type="button"
                              onClick={() => {
                                const updatedQuestions = [...questions];
                                updatedQuestions[qIndex].correctTextAnswers.splice(ansIdx, 1);
                                setQuestions(updatedQuestions);
                              }}
                              className="ml-2 text-red-500 hover:text-red-700"
                              disabled={question.correctTextAnswers.length <= 1}
                            >
                              <TrashIcon className="h-5 w-5" />
                            </button>
                          </div>
                        ))}
                        <button
                          type="button"
                          onClick={() => {
                            const updatedQuestions = [...questions];
                            if (!updatedQuestions[qIndex].correctTextAnswers) updatedQuestions[qIndex].correctTextAnswers = [''];
                            else updatedQuestions[qIndex].correctTextAnswers.push('');
                            setQuestions(updatedQuestions);
                          }}
                          className="mt-2 inline-flex items-center px-2 py-1 border border-yellow-400 text-sm font-medium rounded-md text-yellow-800 bg-yellow-50 hover:bg-yellow-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                        >
                          <PlusCircleIcon className="h-4 w-4 mr-1" />
                          Add Another Answer
                        </button>
                        <p className="text-xs text-yellow-700 mt-1 font-medium">You can add multiple acceptable answers (case-insensitive match).</p>
                      </div>
                    )}
                  </motion.div>
                ))}
              </AnimatePresence>
            </div>
            
            {/* Submit Button */}
            <div className="border-t border-gray-200 pt-6">
              <button
                type="submit"
                disabled={submitting}
                className={`w-full py-3 px-4 border border-transparent rounded-md font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 ${
                  submitting ? 'opacity-70 cursor-not-allowed' : ''
                }`}
              >
                {submitting ? 'Creating Quiz...' : 'Create Quiz'}
              </button>
            </div>
          </form>
        </div>
      </motion.div>
    </div>
  );
};

export default CreateQuiz;

==================================================
FILE_PATH: client\src\pages\teacher\Dashboard.js
==================================================
import React, { useEffect, useState, useContext } from 'react';
import { Link } from 'react-router-dom';
import axios from 'axios';
import AuthContext from '../../context/AuthContext';
import {
  BookOpenIcon,
  ClipboardCheckIcon,
  DocumentTextIcon,
  UserGroupIcon,
  BellIcon,
  PlusCircleIcon
} from '@heroicons/react/outline';
import { motion } from 'framer-motion';

const TeacherDashboard = () => {
  const { user } = useContext(AuthContext);
  const [courses, setCourses] = useState([]);
  const [stats, setStats] = useState({
    totalCourses: 0,
    totalStudents: 0,
    pendingAssignments: 0,
    completedQuizzes: 0,
  });
  const [recentActivities, setRecentActivities] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchTeacherData = async () => {
      try {
        // Fetch courses
        const coursesRes = await axios.get('/api/courses');
        setCourses(coursesRes.data.courses);

        // Calculate stats
        const courseCount = coursesRes.data.courses.length;
        let studentCount = 0;
        let pendingCount = 0;
        
        // Fetch assignments
        const assignmentsRes = await axios.get('/api/assignments/teacher');
        pendingCount = assignmentsRes.data.assignments.filter(
          ass => ass.submissions?.some(sub => !sub.graded)
        ).length;
        
        // Count unique students across all courses
        const studentIds = new Set();
        coursesRes.data.courses.forEach(course => {
          course.students?.forEach(student => {
            studentIds.add(student._id);
          });
        });
        
        // Get recent activities
        const activitiesRes = await axios.get('/api/activities/recent');
        setRecentActivities(activitiesRes.data.activities);
        
        setStats({
          totalCourses: courseCount,
          totalStudents: studentIds.size,
          pendingAssignments: pendingCount,
          completedQuizzes: 0, // This would come from a quizzes API
        });
        
        setLoading(false);
      } catch (error) {
        console.error('Error fetching teacher data:', error);
        setLoading(false);
      }
    };

    fetchTeacherData();
  }, []);

  const statCards = [
    {
      title: 'Courses',
      value: stats.totalCourses,
      icon: <BookOpenIcon className="h-6 w-6 text-blue-500" />,
      color: 'bg-blue-100',
    },
    {
      title: 'Students',
      value: stats.totalStudents,
      icon: <DocumentTextIcon className="h-6 w-6 text-green-500" />,
      color: 'bg-green-100',
    },
    {
      title: 'Pending Submissions',
      value: stats.pendingAssignments,
      icon: <ClipboardCheckIcon className="h-6 w-6 text-yellow-500" />,
      color: 'bg-yellow-100',
    },
    {
      title: 'Announcements',
      value: recentActivities.length,
      icon: <BellIcon className="h-6 w-6 text-purple-500" />,
      color: 'bg-purple-100',
    },
  ];

  if (loading) {
    return (
      <div className="flex justify-center items-center h-64">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"></div>
      </div>
    );
  }

  return (
    <div className="space-y-8">
      <div className="flex flex-col md:flex-row md:items-center md:justify-between">
        <div>
          <h1 className="text-2xl font-bold text-gray-800">Teacher Dashboard</h1>
          <p className="text-gray-600">Welcome back, {user?.name}!</p>
        </div>
        <div className="mt-4 md:mt-0">
          <Link
            to="/teacher/courses/create"
            className="inline-flex items-center px-4 py-2 bg-primary-600 border border-transparent rounded-md font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
          >
            <PlusCircleIcon className="mr-2 h-5 w-5" />
            Create New Course
          </Link>
        </div>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        {statCards.map((stat, index) => (
          <motion.div
            key={index}
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.3, delay: index * 0.1 }}
            className={`${stat.color} p-6 rounded-lg shadow-sm`}
          >
            <div className="flex items-center">
              <div className="p-3 rounded-full bg-white mr-4">
                {stat.icon}
              </div>
              <div>
                <p className="text-sm font-medium text-gray-600">{stat.title}</p>
                <p className="text-2xl font-bold text-gray-800">{stat.value}</p>
              </div>
            </div>
          </motion.div>
        ))}
      </div>

      {/* My Courses */}
      <div>
        <h2 className="text-xl font-semibold text-gray-800 mb-4">My Courses</h2>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {courses.length > 0 ? (
            courses.map((course, index) => (
              <motion.div
                key={course._id}
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.3, delay: index * 0.1 }}
                className="bg-white rounded-lg shadow-md overflow-hidden"
              >
                <div 
                  className="h-32 bg-cover bg-center" 
                  style={{ 
                    backgroundImage: `url(${course.coverImage ? `/uploads/${course.coverImage}` : '/img/default-course.jpg'})` 
                  }}
                ></div>
                <div className="p-4">
                  <h3 className="text-lg font-semibold text-gray-800">{course.title}</h3>
                  <p className="text-gray-600 text-sm mt-1">Code: {course.code}</p>
                  <p className="text-gray-600 text-sm mt-1">
                    {course.students?.length || 0} Students
                  </p>
                  <div className="mt-4">
                    <Link
                      to={`/courses/${course._id}`}
                      className="text-primary-600 hover:text-primary-700 font-medium text-sm"
                    >
                      View Course
                    </Link>
                  </div>
                </div>
              </motion.div>
            ))
          ) : (
            <div className="col-span-full">
              <p className="text-gray-500 text-center py-8">
                You haven't created any courses yet. 
                <Link to="/teacher/courses/create" className="text-primary-600 hover:underline ml-1">
                  Create your first course
                </Link>
              </p>
            </div>
          )}
        </div>
      </div>

      {/* Recent Activities */}
      <div>
        <h2 className="text-xl font-semibold text-gray-800 mb-4">Recent Activities</h2>
        <div className="bg-white rounded-lg shadow-md overflow-hidden">
          {recentActivities.length > 0 ? (
            <div className="divide-y divide-gray-200">
              {recentActivities.map((activity, index) => (
                <div key={activity._id} className="p-4 hover:bg-gray-50">
                  <p className="text-gray-800">{activity.description}</p>
                  <div className="flex justify-between items-center mt-2">
                    <span className="text-sm text-gray-500">
                      {new Date(activity.createdAt).toLocaleDateString()}
                    </span>
                    {activity.link && (
                      <Link
                        to={activity.link}
                        className="text-primary-600 hover:text-primary-700 text-sm font-medium"
                      >
                        View Details
                      </Link>
                    )}
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <p className="text-gray-500 text-center py-8">No recent activities found.</p>
          )}
        </div>
      </div>
    </div>
  );
};

export default TeacherDashboard;

==================================================
FILE_PATH: client\src\pages\teacher\EditCourse.js
==================================================
// src/pages/teacher/EditCourse.js (THAY THẾ HOÀN TOÀN)
import React, { useState, useEffect, useContext } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import axios from 'axios';
import { toast } from 'react-toastify';
import AuthContext from '../../context/AuthContext';

const EditCourse = () => {
  const { id } = useParams();
  const navigate = useNavigate();
  const { user } = useContext(AuthContext);
  const [formData, setFormData] = useState({ title: '', description: '', code: '', coverImageUrl: '' });
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchCourse = async () => {
      try {
        const token = localStorage.getItem('token');
        const res = await axios.get(`/api/courses/${id}`, {
          headers: { Authorization: `Bearer ${token}` }
        });
        setFormData({
          title: res.data.course.title,
          description: res.data.course.description || '',
          code: res.data.course.code || '',
          coverImageUrl: res.data.course.coverImageUrl || ''
        });
        setLoading(false);
      } catch (err) {
        toast.error('Không tải được khóa học');
        navigate('/teacher/courses');
      }
    };
    fetchCourse();
  }, [id, navigate]);

  const onChange = (e) => setFormData({ ...formData, [e.target.name]: e.target.value });

  const onSubmit = async (e) => {
    e.preventDefault();
    try {
      const token = localStorage.getItem('token');
      await axios.put(`/api/courses/${id}`, formData, {
        headers: { Authorization: `Bearer ${token}` }
      });
      toast.success('Cập nhật khóa học thành công!');
      navigate('/teacher/courses');
    } catch (err) {
      toast.error('Cập nhật thất bại');
    }
  };

  if (loading) return <div className="text-center py-20">Đang tải...</div>;

  return (
    <div className="max-w-3xl mx-auto py-10 px-4">
      <h1 className="text-4xl font-bold mb-8 text-center">Sửa Khóa Học</h1>
      <form onSubmit={onSubmit} className="bg-white p-8 rounded-2xl shadow-xl space-y-6">
        <input name="title" value={formData.title} onChange={onChange} placeholder="Tên khóa học" required className="w-full px-4 py-3 border rounded-lg" />
        <input name="code" value={formData.code} onChange={onChange} placeholder="Mã khóa học" required className="w-full px-4 py-3 border rounded-lg" />
        <textarea name="description" value={formData.description} onChange={onChange} placeholder="Mô tả" rows="5" className="w-full px-4 py-3 border rounded-lg" />
        <input name="coverImageUrl" value={formData.coverImageUrl} onChange={onChange} placeholder="URL ảnh bìa" className="w-full px-4 py-3 border rounded-lg" />

        <div className="flex gap-4 justify-center pt-6">
          <button type="submit" className="px-8 py-3 bg-green-600 text-white rounded-xl hover:bg-green-700 font-bold">
            Lưu Thay Đổi
          </button>
          <button type="button" onClick={() => navigate('/teacher/courses')} className="px-8 py-3 bg-gray-500 text-white rounded-xl hover:bg-gray-600">
            Hủy
          </button>
        </div>
      </form>
    </div>
  );
};

export default EditCourse;

==================================================
FILE_PATH: client\src\pages\teacher\EditQuiz.js
==================================================
import React, { useState, useEffect } from 'react';
import { useParams, useNavigate } from 'react-router-dom';
import axios from 'axios';
import DatePicker from 'react-datepicker';
import 'react-datepicker/dist/react-datepicker.css';
import { toast } from 'react-toastify';
import { motion, AnimatePresence } from 'framer-motion';
import {
  ArrowLeftIcon,
  PlusCircleIcon,
  TrashIcon,
  CheckCircleIcon,
  XCircleIcon,
} from '@heroicons/react/solid';

const EditQuiz = () => {
  const { id } = useParams();
  const navigate = useNavigate();

  const [formData, setFormData] = useState({
    title: '',
    description: '',
    timeLimit: 0,
    isPublished: false,
    availableFrom: null,
    availableTo: null,
  });
  const [questions, setQuestions] = useState([]);
  const [submitting, setSubmitting] = useState(false);
  const [loading, setLoading] = useState(true);
  const [course, setCourse] = useState(null);
  const [hasSubmissions, setHasSubmissions] = useState(false);

  useEffect(() => {
    const fetchQuiz = async () => {
      try {
        const res = await axios.get(`/api/quizzes/${id}`);
        const quiz = res.data.data;
        setFormData({
          title: quiz.title || '',
          description: quiz.description || '',
          timeLimit: quiz.timeLimit || 0,
          isPublished: quiz.isPublished || false,
          availableFrom: quiz.availableFrom ? new Date(quiz.availableFrom) : null,
          availableTo: quiz.availableTo ? new Date(quiz.availableTo) : null,
        });
        setQuestions(quiz.questions || []);
        setCourse(quiz.course);
        setHasSubmissions(quiz.results && quiz.results.length > 0);
        setLoading(false);
      } catch (error) {
        console.error('Error fetching quiz:', error);
        toast.error('Failed to load quiz for editing');
        setLoading(false);
      }
    };
    fetchQuiz();
  }, [id]);

  const handleInputChange = (e) => {
    const { name, value, type, checked } = e.target;
    setFormData({
      ...formData,
      [name]: type === 'checkbox' ? checked : value,
    });
  };

  const handleQuestionChange = (index, field, value) => {
    const updatedQuestions = [...questions];
    updatedQuestions[index][field] = value;
    setQuestions(updatedQuestions);
  };

  const handleOptionChange = (questionIndex, optionIndex, field, value) => {
    const updatedQuestions = [...questions];
    updatedQuestions[questionIndex].options[optionIndex][field] = value;
    setQuestions(updatedQuestions);
  };

  const handleCorrectOptionChange = (questionIndex, optionIndex) => {
    const updatedQuestions = [...questions];
    const question = updatedQuestions[questionIndex];
    if (question.type === 'multiple') {
      // Toggle only the selected option
      question.options[optionIndex].isCorrect = !question.options[optionIndex].isCorrect;
    } else {
      // Only one correct for single choice
      const isCorrect = !question.options[optionIndex].isCorrect;
      question.options.forEach((option, idx) => {
        option.isCorrect = idx === optionIndex ? isCorrect : false;
      });
    }
    setQuestions(updatedQuestions);
  };

  const addQuestion = () => {
    setQuestions([
      ...questions,
      {
        questionText: '',
        points: 1,
        explanation: '',
        options: [
          { text: '', isCorrect: false },
          { text: '', isCorrect: false },
          { text: '', isCorrect: false },
          { text: '', isCorrect: false }
        ]
      }
    ]);
  };

  const removeQuestion = (index) => {
    if (questions.length > 1) {
      const updatedQuestions = [...questions];
      updatedQuestions.splice(index, 1);
      setQuestions(updatedQuestions);
    } else {
      toast.error('Quiz must have at least one question');
    }
  };

  const addOption = (questionIndex) => {
    const updatedQuestions = [...questions];
    if (updatedQuestions[questionIndex].options.length < 6) {
      updatedQuestions[questionIndex].options.push({ text: '', isCorrect: false });
      setQuestions(updatedQuestions);
    } else {
      toast.error('Maximum 6 options allowed per question');
    }
  };

  const removeOption = (questionIndex, optionIndex) => {
    const updatedQuestions = [...questions];
    if (updatedQuestions[questionIndex].options.length > 2) {
      updatedQuestions[questionIndex].options.splice(optionIndex, 1);
      setQuestions(updatedQuestions);
    } else {
      toast.error('Question must have at least 2 options');
    }
  };

  const validateForm = () => {
    if (!formData.title.trim() || !formData.description.trim()) {
      toast.error('Quiz title and description are required');
      return false;
    }
    for (let i = 0; i < questions.length; i++) {
      const question = questions[i];
      if (!question.questionText.trim()) {
        toast.error(`Question ${i + 1} text is required`);
        return false;
      }
      const hasCorrectOption = question.options.some(option => option.isCorrect);
      if (!hasCorrectOption) {
        toast.error(`Question ${i + 1} must have at least one correct answer`);
        return false;
      }
      for (let j = 0; j < question.options.length; j++) {
        if (!question.options[j].text.trim()) {
          toast.error(`Option ${j + 1} in Question ${i + 1} is empty`);
          return false;
        }
      }
    }
    return true;
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!validateForm()) {
      return;
    }
    setSubmitting(true);
    try {
      const quizData = {
        ...formData,
        questions,
      };
      await axios.put(`/api/quizzes/${id}`, quizData);
      toast.success('Quiz updated successfully!');
      navigate(`/quizzes/${id}`);
    } catch (error) {
      console.error('Error updating quiz:', error);
      toast.error(error.response?.data?.message || 'Error updating quiz');
    } finally {
      setSubmitting(false);
    }
  };

  if (loading) {
    return (
      <div className="flex justify-center items-center h-64">
        <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"></div>
      </div>
    );
  }

  if (hasSubmissions) {
    return (
      <div className="max-w-2xl mx-auto bg-white rounded-lg shadow-md p-8 mt-10 text-center">
        <h2 className="text-2xl font-bold text-gray-800 mb-4">Quiz Cannot Be Edited</h2>
        <p className="text-gray-600 mb-6">This quiz already has student submissions and cannot be edited.</p>
        <button
          onClick={() => navigate(-1)}
          className="px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700"
        >
          Go Back
        </button>
      </div>
    );
  }

  return (
    <div className="max-w-2xl mx-auto py-8 px-2 sm:px-6 lg:px-8 bg-neutral-50 min-h-screen">
      <motion.div initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.5 }} className="bg-white/90 shadow-card rounded-2xl p-8 border border-primary-50">
        <h1 className="text-2xl font-extrabold font-heading text-primary-400 mb-6 drop-shadow-lg tracking-tight bg-gradient-to-r from-primary-400 to-secondary-500 bg-clip-text text-transparent">
          Edit Quiz
        </h1>
        <div className="mb-6">
          <button
            onClick={() => navigate(-1)}
            className="flex items-center text-gray-600 hover:text-primary-600"
          >
            <ArrowLeftIcon className="h-4 w-4 mr-1" />
            Back to Quiz
          </button>
        </div>
        <div className="bg-white rounded-lg shadow-md p-6 mb-6">
          <h1 className="text-2xl font-bold text-gray-800 mb-6">Edit Quiz</h1>
          <div className="mb-6 p-4 bg-blue-50 rounded-md">
            <p className="text-blue-700">
              Editing quiz for: <span className="font-semibold">{course?.title || ''}</span>
            </p>
          </div>
          <form onSubmit={handleSubmit}>
            <div className="space-y-6 mb-8">
              <h2 className="text-lg font-semibold text-gray-800">Quiz Details</h2>
              <div>
                <label htmlFor="title" className="block text-sm font-medium text-gray-700 mb-1">
                  Quiz Title*
                </label>
                <input
                  type="text"
                  id="title"
                  name="title"
                  value={formData.title}
                  onChange={handleInputChange}
                  required
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                  placeholder="e.g., Chapter 5 Quiz: Advanced Concepts"
                />
              </div>
              <div>
                <label htmlFor="description" className="block text-sm font-medium text-gray-700 mb-1">
                  Description*
                </label>
                <textarea
                  id="description"
                  name="description"
                  value={formData.description}
                  onChange={handleInputChange}
                  required
                  rows="3"
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                  placeholder="Provide a description of what this quiz covers"
                ></textarea>
              </div>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label htmlFor="timeLimit" className="block text-sm font-medium text-gray-700 mb-1">
                    Time Limit (minutes)
                  </label>
                  <input
                    type="number"
                    id="timeLimit"
                    name="timeLimit"
                    value={formData.timeLimit}
                    onChange={handleInputChange}
                    min="0"
                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                    placeholder="Enter 0 for no time limit"
                  />
                  <p className="mt-1 text-xs text-gray-500">
                    Enter 0 for no time limit
                  </p>
                </div>
                <div className="flex items-center">
                  <input
                    type="checkbox"
                    id="isPublished"
                    name="isPublished"
                    checked={formData.isPublished}
                    onChange={handleInputChange}
                    className="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"
                  />
                  <label htmlFor="isPublished" className="ml-2 block text-sm text-gray-700">
                    Publish quiz
                  </label>
                </div>
              </div>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label htmlFor="availableFrom" className="block text-sm font-medium text-gray-700 mb-1">
                    Available From
                  </label>
                  <DatePicker
                    selected={formData.availableFrom}
                    onChange={(date) => setFormData({ ...formData, availableFrom: date })}
                    showTimeSelect
                    dateFormat="MMMM d, yyyy h:mm aa"
                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                  />
                </div>
                <div>
                  <label htmlFor="availableTo" className="block text-sm font-medium text-gray-700 mb-1">
                    Available Until
                  </label>
                  <DatePicker
                    selected={formData.availableTo}
                    onChange={(date) => setFormData({ ...formData, availableTo: date })}
                    showTimeSelect
                    dateFormat="MMMM d, yyyy h:mm aa"
                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                  />
                </div>
              </div>
            </div>
            <div className="border-t border-gray-200 pt-6 mb-8">
              <div className="flex justify-between items-center mb-6">
                <h2 className="text-lg font-semibold text-gray-800">Questions</h2>
                <button
                  type="button"
                  onClick={addQuestion}
                  className="inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                >
                  <PlusCircleIcon className="h-4 w-4 mr-1" />
                  Add Question
                </button>
              </div>
              <div className="mb-4 p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded">
                <p className="text-sm text-yellow-800">
                  <b>Tip:</b> For <b>Multiple Choice</b> questions, you can select more than one correct answer. For <b>Single Choice</b>, only one correct answer is allowed. For <b>Text Answer</b> questions, you can add multiple acceptable answers (case-insensitive match).
                </p>
              </div>
              <AnimatePresence>
                {questions.map((question, qIndex) => (
                  <motion.div
                    key={qIndex}
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    exit={{ opacity: 0, height: 0 }}
                    className="p-4 border border-gray-200 rounded-lg mb-6"
                  >
                    <div className="flex justify-between items-start mb-4">
                      <h3 className="font-medium text-gray-800">Question {qIndex + 1}</h3>
                      <button
                        type="button"
                        onClick={() => removeQuestion(qIndex)}
                        className="text-red-500 hover:text-red-700"
                      >
                        <TrashIcon className="h-5 w-5" />
                      </button>
                    </div>
                    <div className="mb-4">
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Question Text*
                      </label>
                      <textarea
                        value={question.questionText}
                        onChange={(e) => handleQuestionChange(qIndex, 'questionText', e.target.value)}
                        rows="2"
                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                        placeholder="Enter your question here"
                        required
                      ></textarea>
                    </div>
                    <div className="mb-4">
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Points
                      </label>
                      <input
                        type="number"
                        value={question.points}
                        onChange={(e) => handleQuestionChange(qIndex, 'points', parseInt(e.target.value) || 1)}
                        min="1"
                        className="w-32 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                      />
                    </div>
                    <div className="mb-4">
                      <label className="block text-sm font-medium text-gray-700 mb-1">Question Type*</label>
                      <select
                        value={question.type || 'single'}
                        onChange={e => handleQuestionChange(qIndex, 'type', e.target.value)}
                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                      >
                        <option value="single">Single Choice (Radio)</option>
                        <option value="multiple">Multiple Choice (Checkboxes)</option>
                        <option value="text">Text Answer</option>
                      </select>
                    </div>
                    {question.type !== 'text' && (
                      <div className="mb-4">
                        <label className="block text-sm font-medium text-gray-700 mb-3">
                          Answer Options
                        </label>
                        {question.type === 'multiple' && (
                          <div className="mb-2 text-xs text-blue-600 font-medium">You can select <b>multiple</b> correct answers for this question.</div>
                        )}
                        {question.type === 'single' && (
                          <div className="mb-2 text-xs text-blue-600 font-medium">Only <b>one</b> correct answer can be selected for this question.</div>
                        )}
                        <div className="space-y-3">
                          {question.options.map((option, oIndex) => (
                            <div key={oIndex} className="flex items-center">
                              <button
                                type="button"
                                onClick={() => handleCorrectOptionChange(qIndex, oIndex)}
                                className={`flex-shrink-0 mr-2 ${
                                  option.isCorrect
                                    ? 'text-green-600 hover:text-green-700'
                                    : 'text-gray-400 hover:text-gray-500'
                                }`}
                              >
                                {option.isCorrect ? (
                                  <CheckCircleIcon className="h-5 w-5" />
                                ) : (
                                  <XCircleIcon className="h-5 w-5" />
                                )}
                              </button>
                              <input
                                type="text"
                                value={option.text}
                                onChange={e => handleOptionChange(qIndex, oIndex, 'text', e.target.value)}
                                className={`flex-grow px-3 py-2 border rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${
                                  option.isCorrect
                                    ? 'border-green-300 bg-green-50'
                                    : 'border-gray-300'
                                }`}
                                placeholder={`Option ${oIndex + 1}`}
                                required
                              />
                              <button
                                type="button"
                                onClick={() => removeOption(qIndex, oIndex)}
                                className="flex-shrink-0 ml-2 text-red-500 hover:text-red-700"
                                disabled={question.options.length <= 2}
                              >
                                <TrashIcon className="h-5 w-5" />
                              </button>
                            </div>
                          ))}
                        </div>
                        <button
                          type="button"
                          onClick={() => addOption(qIndex)}
                          className="mt-3 inline-flex items-center px-2 py-1 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                        >
                          <PlusCircleIcon className="h-4 w-4 mr-1" />
                          Add Option
                        </button>
                      </div>
                    )}
                    {question.type === 'text' && (
                      <div className="mb-4">
                        <label className="block text-sm font-medium text-gray-700 mb-1">
                          Correct Text Answer(s)*
                        </label>
                        {question.correctTextAnswers && question.correctTextAnswers.length > 0 && question.correctTextAnswers.map((ans, ansIdx) => (
                          <div key={ansIdx} className="flex items-center mb-2">
                            <input
                              type="text"
                              value={ans}
                              onChange={e => {
                                const updatedQuestions = [...questions];
                                updatedQuestions[qIndex].correctTextAnswers[ansIdx] = e.target.value;
                                setQuestions(updatedQuestions);
                              }}
                              className="flex-grow px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                              placeholder={`Correct Answer ${ansIdx + 1}`}
                              required
                            />
                            <button
                              type="button"
                              onClick={() => {
                                const updatedQuestions = [...questions];
                                updatedQuestions[qIndex].correctTextAnswers.splice(ansIdx, 1);
                                setQuestions(updatedQuestions);
                              }}
                              className="ml-2 text-red-500 hover:text-red-700"
                              disabled={question.correctTextAnswers.length <= 1}
                            >
                              <TrashIcon className="h-5 w-5" />
                            </button>
                          </div>
                        ))}
                        <button
                          type="button"
                          onClick={() => {
                            const updatedQuestions = [...questions];
                            if (!updatedQuestions[qIndex].correctTextAnswers) updatedQuestions[qIndex].correctTextAnswers = [''];
                            else updatedQuestions[qIndex].correctTextAnswers.push('');
                            setQuestions(updatedQuestions);
                          }}
                          className="mt-2 inline-flex items-center px-2 py-1 border border-yellow-400 text-sm font-medium rounded-md text-yellow-800 bg-yellow-50 hover:bg-yellow-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"
                        >
                          <PlusCircleIcon className="h-4 w-4 mr-1" />
                          Add Another Answer
                        </button>
                        <p className="text-xs text-yellow-700 mt-1 font-medium">You can add multiple acceptable answers (case-insensitive match).</p>
                      </div>
                    )}
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Explanation (Optional)
                      </label>
                      <textarea
                        value={question.explanation}
                        onChange={(e) => handleQuestionChange(qIndex, 'explanation', e.target.value)}
                        rows="2"
                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                        placeholder="Explain why the correct answer is right (shown after quiz submission)"
                      ></textarea>
                    </div>
                  </motion.div>
                ))}
              </AnimatePresence>
            </div>
            <div className="border-t border-gray-200 pt-6">
              <button
                type="submit"
                disabled={submitting}
                className={`w-full py-3 px-4 border border-transparent rounded-md font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 ${
                  submitting ? 'opacity-70 cursor-not-allowed' : ''
                }`}
              >
                {submitting ? 'Updating Quiz...' : 'Update Quiz'}
              </button>
            </div>
          </form>
        </div>
      </motion.div>
    </div>
  );
};

export default EditQuiz; 

==================================================
FILE_PATH: client\src\pages\teacher\UploadMaterial.js
==================================================


==================================================
FILE_PATH: client\src\pages\teacher\Users.js
==================================================
// src/pages/teacher/Users.js (TẠO MỚI FILE NÀY)
import React, { useState, useEffect } from 'react';
import axios from 'axios';
import { toast } from 'react-toastify';

const Users = () => {
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchUsers = async () => {
      try {
        const token = localStorage.getItem('token');
        const res = await axios.get('/api/users', {
          headers: { Authorization: `Bearer ${token}` }
        });
        setUsers(res.data.users);
      } catch (err) {
        toast.error('Không tải được danh sách người dùng');
      } finally {
        setLoading(false);
      }
    };
    fetchUsers();
  }, []);

  return (
    <div className="max-w-6xl mx-auto py-10 px-4">
      <h1 className="text-4xl font-bold mb-10 text-center">Quản Lý Người Dùng</h1>
      {loading ? (
        <p className="text-center text-xl">Đang tải...</p>
      ) : (
        <div className="bg-white shadow-xl rounded-2xl overflow-hidden">
          <table className="min-w-full">
            <thead className="bg-primary-600 text-white">
              <tr>
                <th className="px-6 py-4 text-left">Tên</th>
                <th className="px-6 py-4 text-left">Email</th>
                <th className="px-6 py-4 text-left">Vai trò</th>
                <th className="px-6 py-4 text-left">Ngày tạo</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-200">
              {users.map(u => (
                <tr key={u._id} className="hover:bg-gray-50">
                  <td className="px-6 py-4">{u.name}</td>
                  <td className="px-6 py-4">{u.email}</td>
                  <td className="px-6 py-4">
                    <span className={`px-2 px-3 py-1 rounded-full text-sm font-bold ${
                      u.role === 'teacher' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'
                    }`}>
                      {u.role === 'teacher' ? 'Giáo viên' : 'Học sinh'}
                    </span>
                  </td>
                  <td className="px-6 py-4 text-sm text-gray-500">
                    {new Date(u.createdAt).toLocaleDateString('vi-VN')}
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      )}
    </div>
  );
};

export default Users;

==================================================
FILE_PATH: client\src\pages\Unauthorized.js
==================================================
import { motion } from 'framer-motion';

const Unauthorized = () => {
  return (
    <motion.div
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      transition={{ duration: 0.5 }}
      className="flex items-center justify-center h-screen"
    >
      <div className="bg-white p-8 rounded-lg shadow-lg">
        {/* Rest of the component content */}
      </div>
    </motion.div>
  );
};

export default Unauthorized;


==================================================
FILE_PATH: client\src\reportWebVitals.js
==================================================
const reportWebVitals = onPerfEntry => {
  if (onPerfEntry && onPerfEntry instanceof Function) {
    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {
      getCLS(onPerfEntry);
      getFID(onPerfEntry);
      getFCP(onPerfEntry);
      getLCP(onPerfEntry);
      getTTFB(onPerfEntry);
    });
  }
};

export default reportWebVitals;


==================================================
FILE_PATH: client\src\services\contentService.js
==================================================
import api from '../utils/api';

export const fetchContent = async (contentType, courseId) => {
  try {
    console.log(`Fetching ${contentType} for course ${courseId}`);
    let endpoint = `/${contentType}`;
    
    if (courseId) {
      // For most content types, use query param
      endpoint = `/${contentType}?courseId=${courseId}`;
      
      // For some content types that use a different route pattern
      if (['notices', 'materials', 'assignments', 'quizzes'].includes(contentType)) {
        // Try both formats to ensure compatibility
        try {
          const response = await api.get(`/${contentType}/course/${courseId}`);
          return response.data;
        } catch (err) {
          console.log(`Course-specific endpoint failed, trying with query param`);
          const response = await api.get(endpoint);
          return response.data;
        }
      }
    }
    
    const response = await api.get(endpoint);
    return response.data;
  } catch (error) {
    console.error(`Error fetching ${contentType}:`, error);
    throw error;
  }
};

// Specific content type fetchers
export const fetchMaterials = (courseId) => fetchContent('materials', courseId);
export const fetchAssignments = (courseId) => fetchContent('assignments', courseId);
export const fetchQuizzes = (courseId) => fetchContent('quizzes', courseId);
export const fetchNotices = (courseId) => fetchContent('notices', courseId);


==================================================
FILE_PATH: client\src\utils\api.js
==================================================
import axios from 'axios';

// Create an axios instance with default config
const api = axios.create({
  baseURL: '/api',
  headers: {
    'Content-Type': 'application/json',
  },
  withCredentials: true
});

// Add request interceptor for debugging
api.interceptors.request.use(
  (config) => {
    if (process.env.REACT_APP_DEBUG === 'true') {
      console.log(`📤 API Request: ${config.method.toUpperCase()} ${config.baseURL}${config.url}`, config);
    }
    return config;
  },
  (error) => {
    console.error('❌ API Request Error:', error);
    return Promise.reject(error);
  }
);

// Add response interceptor for debugging
api.interceptors.response.use(
  (response) => {
    if (process.env.REACT_APP_DEBUG === 'true') {
      console.log(`📥 API Response: ${response.status} ${response.config.url}`, response.data);
    }
    return response;
  },
  (error) => {
    console.error('❌ API Response Error:', error.response || error);
    return Promise.reject(error);
  }
);

export default api;


==================================================
FILE_PATH: client\tailwind.config.js
==================================================
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    "./src/**/*.{js,jsx,ts,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        primary: {
          DEFAULT: '#1E90FF', // Light Blue
          50: '#e6f2ff',
          100: '#b3d8ff',
          200: '#80bdff',
          300: '#4da3ff',
          400: '#1E90FF',
          500: '#187bcd',
          600: '#136299',
          700: '#0d4966',
          800: '#082033',
          900: '#05101a',
        },
        secondary: {
          DEFAULT: '#0A3D62', // Dark Blue
          50: '#e3eaf2',
          100: '#b8cbe0',
          200: '#8dacce',
          300: '#628dbd',
          400: '#376eab',
          500: '#0A3D62',
          600: '#08314e',
          700: '#06243b',
          800: '#041827',
          900: '#020c14',
        },
        neutral: {
          50: '#F4F4F4', // Soft Gray
          100: '#FFFFFF', // White
        },
        accent: {
          yellow: '#FFEB3B', // Warm Yellow
          green: '#28A745', // Bright Green
        },
        action: {
          orange: '#FF8C00',
          red: '#DC3545',
        },
        text: {
          dark: '#333333',
          medium: '#666666',
        },
      },
      fontFamily: {
        sans: ['Inter', 'sans-serif'],
        heading: ['Poppins', 'sans-serif'],
      },
      boxShadow: {
        card: '0 0 20px rgba(0, 0, 0, 0.05)',
        'card-hover': '0 0 25px rgba(0, 0, 0, 0.1)',
      },
    },
  },
  plugins: [],
}


==================================================
FILE_PATH: package.json
==================================================
{
  "name": "mern-lms-project",
  "version": "1.0.0",
  "description": "Learning Management System built with MERN stack",
  "main": "index.js",
  "scripts": {
    "start": "node server/server.js",
    "server": "nodemon server/server.js",
    "client": "npm start --prefix client",
    "dev": "concurrently \"npm run server\" \"npm run client\"",
    "install-client": "cd client && npm install",
    "install-server": "cd server && npm install",
    "install-all": "npm install && npm run install-client && npm run install-server"
  },
  "keywords": [
    "mern",
    "lms",
    "education"
  ],
  "author": "",
  "license": "MIT",
  "dependencies": {
    "concurrently": "^8.2.0",
    "zxcvbn": "^4.4.2"
  }
}


==================================================
FILE_PATH: server\controllers\activity.controller.js
==================================================
const Assignment = require('../models/assignment.model');
const Course = require('../models/course.model');
const Notice = require('../models/notice.model');
const Quiz = require('../models/quiz.model');

// @desc    Get recent activities for dashboard
// @route   GET /api/activities/recent
// @access  Private
exports.getRecentActivities = async (req, res) => {
  try {
    const userId = req.user.id;
    const userRole = req.user.role;
    
    // Different queries based on user role
    let activities = [];
    const limit = 10; // Limit number of activities
    
    if (userRole === 'teacher') {
      // For teachers, get their created content
      const [assignments, notices, quizzes, courses] = await Promise.all([
        Assignment.find({ teacher: userId }).sort('-createdAt').limit(limit)
          .select('title createdAt').lean(),
        Notice.find({ createdBy: userId }).sort('-createdAt').limit(limit)
          .select('title createdAt').lean(),
        Quiz.find({ teacher: userId }).sort('-createdAt').limit(limit)
          .select('title createdAt').lean(),
        Course.find({ teacher: userId }).sort('-createdAt').limit(limit)
          .select('title createdAt').lean()
      ]);
      
      // Add type field for frontend display
      const formattedAssignments = assignments.map(a => ({ ...a, type: 'assignment' }));
      const formattedNotices = notices.map(n => ({ ...n, type: 'notice' }));
      const formattedQuizzes = quizzes.map(q => ({ ...q, type: 'quiz' }));
      const formattedCourses = courses.map(c => ({ ...c, type: 'course' }));
      
      activities = [...formattedAssignments, ...formattedNotices, 
                   ...formattedQuizzes, ...formattedCourses]
                   .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                   .slice(0, limit);
    } else if (userRole === 'student') {
      // For students, get content from their enrolled courses
      const [assignments, notices, quizzes] = await Promise.all([
        Assignment.find({ course: { $in: req.user.courses } })
          .sort('-createdAt').limit(limit)
          .select('title createdAt course').populate('course', 'title').lean(),
        Notice.find({ course: { $in: req.user.courses } })
          .sort('-createdAt').limit(limit)
          .select('title createdAt course').populate('course', 'title').lean(),
        Quiz.find({ course: { $in: req.user.courses } })
          .sort('-createdAt').limit(limit)
          .select('title createdAt course').populate('course', 'title').lean()
      ]);
      
      const formattedAssignments = assignments.map(a => ({ ...a, type: 'assignment' }));
      const formattedNotices = notices.map(n => ({ ...n, type: 'notice' }));
      const formattedQuizzes = quizzes.map(q => ({ ...q, type: 'quiz' }));
      
      activities = [...formattedAssignments, ...formattedNotices, ...formattedQuizzes]
                   .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                   .slice(0, limit);
    }
    
    res.json({
      success: true,
      count: activities.length,
      activities
    });
  } catch (error) {
    console.error('Error fetching activities:', error);
    res.status(500).json({
      success: false,
      message: 'Error fetching recent activities'
    });
  }
};


==================================================
FILE_PATH: server\controllers\assignment.controller.js
==================================================
const Assignment = require('../models/assignment.model');
const Course = require('../models/course.model');
const User = require('../models/user.model');
const Notification = require('../models/notification.model');

// @desc    Get all assignments
// @route   GET /api/assignments
// @access  Private
exports.getAssignments = async (req, res) => {
  try {
    console.log('Getting assignments');
    let assignments;
    
    if (req.user.role === 'teacher') {
      // Teachers see assignments for their courses
      const teacherCourses = await Course.find({ teacher: req.user.id }).select('_id');
      const courseIds = teacherCourses.map(course => course._id);
      if (!courseIds.length) {
        return res.status(200).json({ success: true, count: 0, assignments: [] });
      }
      assignments = await Assignment.find({ courseId: { $in: courseIds } })
        .populate('courseId', 'title code')
        .sort('-createdAt');
      if (!assignments) {
        return res.status(200).json({ success: true, count: 0, assignments: [] });
      }
    } else if (req.user.role === 'student') {
      // Students see assignments for courses they're enrolled in
      const studentCourses = await Course.find({ students: req.user.id }).select('_id');
      const courseIds = studentCourses.map(course => course._id);
      
      assignments = await Assignment.find({ courseId: { $in: courseIds } })
        .populate('courseId', 'title code')
        .sort('-createdAt');
      if (!assignments) {
        return res.status(200).json({ success: true, count: 0, assignments: [] });
      }
    } else {
      // Admins see all assignments
      assignments = await Assignment.find()
        .populate('courseId', 'title code')
        .sort('-createdAt');
      if (!assignments) {
        return res.status(200).json({ success: true, count: 0, assignments: [] });
      }
    }
    
    res.status(200).json({
      success: true,
      count: assignments.length,
      assignments: assignments
    });
  } catch (error) {
    console.error('Error getting assignments:', error);
    if (error && error.stack) console.error(error.stack);
    res.status(500).json({
      success: false,
      message: 'Server error',
      error: error.message
    });
  }
};

// @desc    Get single assignment
// @route   GET /api/assignments/:id
// @access  Private
exports.getAssignment = async (req, res) => {
  try {
    console.log('Getting assignment details for ID:', req.params.id);
    
    const assignment = await Assignment.findById(req.params.id)
      .populate('courseId', 'title code teacher')
      .populate('submissions.student', 'name email avatar');
      
    if (!assignment) {
      return res.status(404).json({
        success: false,
        message: 'Assignment not found'
      });
    }
    
    // Return the assignment data
    return res.status(200).json({
      success: true,
      data: assignment
    });
  } catch (error) {
    console.error('Error getting assignment:', error);
    return res.status(500).json({
      success: false,
      message: 'Error fetching assignment details',
      error: error.message
    });
  }
};

// @desc    Create new assignment
// @route   POST /api/assignments
// @access  Private/Teacher
exports.createAssignment = async (req, res) => {
  try {
    const { title, description, courseId, dueDate, totalPoints, attachments } = req.body;
    if (!title || !courseId) {
      return res.status(400).json({ success: false, message: 'Please provide title and course ID' });
    }

    const course = await Course.findById(courseId);
    if (!course) {
      return res.status(404).json({ success: false, message: 'Course not found' });
    }

    // ĐÃ XÓA kiểm tra teacher → ai là teacher cũng tạo được assignment ở mọi course

    const assignment = await Assignment.create({
      title, description, courseId, dueDate,
      totalPoints: totalPoints || 100,
      attachments: attachments || [],
      createdBy: req.user.id
    });

    course.assignments.push(assignment._id);
    await course.save();

    // Notify students...
    for (const studentId of course.students) {
      await Notification.create({
        user: studentId,
        text: `A new assignment "${assignment.title}" has been posted in ${course.title}.`,
        link: `/assignments/${assignment._id}`
      });
    }

    res.status(201).json({ success: true, assignment });
  } catch (error) {
    console.error('Error creating assignment:', error);
    res.status(500).json({ success: false, message: 'Server error', error: error.message });
  }
};

// @desc    Update assignment
// @route   PUT /api/assignments/:id
// @access  Private/Teacher
exports.updateAssignment = async (req, res) => {
  try {
    const assignment = await Assignment.findById(req.params.id);
    if (!assignment) return res.status(404).json({ success: false, message: 'Assignment not found' });

    const updated = await Assignment.findByIdAndUpdate(req.params.id, req.body, { new: true });
    res.status(200).json({ success: true, assignment: updated });
  } catch (error) {
    res.status(500).json({ success: false, message: 'Server error' });
  }
};

// @desc    Delete assignment
// @route   DELETE /api/assignments/:id
// @access  Private/Teacher
exports.deleteAssignment = async (req, res) => {
  try {
    const assignment = await Assignment.findById(req.params.id);
    if (!assignment) return res.status(404).json({ success: false, message: 'Assignment not found' });

    const course = await Course.findById(assignment.courseId);
    course.assignments.pull(assignment._id);
    await course.save();
    await Assignment.findByIdAndDelete(req.params.id);

    res.status(200).json({ success: true, message: 'Assignment deleted successfully' });
  } catch (error) {
    res.status(500).json({ success: false, message: 'Server error' });
  }
};
// @desc    Submit assignment
// @route   POST /api/assignments/:id/submit
// @access  Private/Student
exports.submitAssignment = async (req, res) => {
  try {
    const assignment = await Assignment.findById(req.params.id);
    if (!assignment) {
      return res.status(404).json({
        success: false,
        message: 'Assignment not found'
      });
    }
    // Check if due date has passed
    if (assignment.dueDate && new Date(assignment.dueDate) < new Date()) {
      return res.status(400).json({
        success: false,
        message: 'Assignment due date has passed'
      });
    }
    // Check if student is enrolled in the course
    const course = await Course.findById(assignment.courseId);
    const isEnrolled = course.students.some(
      student => student.toString() === req.user.id
    );
    if (!isEnrolled && req.user.role !== 'admin') {
      return res.status(403).json({
        success: false,
        message: 'You are not enrolled in this course'
      });
    }
    // Prepare attachments array
    let attachments = [];
    if (req.file) {
      attachments.push({
        fileName: req.file.originalname,
        fileUrl: req.file.filename,
        fileType: req.file.mimetype,
      });
    }
    // Check if submission already exists
    const existingSubmission = assignment.submissions.find(
      sub => sub.student.toString() === req.user.id
    );
    if (existingSubmission) {
      // Update existing submission
      existingSubmission.attachments = attachments;
      existingSubmission.submittedAt = Date.now();
      // Reset grade info on resubmission
      existingSubmission.grade = undefined;
      existingSubmission.feedback = undefined;
      existingSubmission.gradedAt = undefined;
    } else {
      // Add new submission
      assignment.submissions.push({
        student: req.user.id,
        attachments,
        submittedAt: Date.now()
      });
    }
    await assignment.save();
    res.status(200).json({
      success: true,
      message: 'Assignment submitted successfully',
      assignment: assignment
    });
  } catch (error) {
    console.error('Error submitting assignment:', error);
    res.status(500).json({
      success: false,
      message: 'Server error',
      error: error.message
    });
  }
};

// @desc    Grade submission
// @route   PUT /api/assignments/:id/grade/:submissionId
// @access  Private/Teacher
exports.gradeSubmission = async (req, res) => {
  try {
    const assignment = await Assignment.findById(req.params.id);
    if (!assignment) return res.status(404).json({ success: false, message: 'Assignment not found' });

    const submission = assignment.submissions.id(req.params.submissionId);
    if (!submission) return res.status(404).json({ success: false, message: 'Submission not found' });

    submission.grade = req.body.grade;
    submission.feedback = req.body.feedback;
    submission.gradedAt = Date.now();
    submission.gradedBy = req.user.id;

    await assignment.save();
    res.json({ success: true, message: 'Submission graded successfully', submission });
  } catch (error) {
    res.status(500).json({ success: false, message: 'Server error' });
  }
};

// @desc    Get recent assignments for teacher
// @route   GET /api/assignments/teacher/recent
// @access  Private/Teacher
exports.getTeacherRecentAssignments = async (req, res) => {
  try {
    // Get courses taught by this teacher
    const courses = await Course.find({ teacher: req.user.id });
    const courseIds = courses.map(course => course._id);
    
    // Get recent assignments from those courses
    const assignments = await Assignment.find({ courseId: { $in: courseIds } })
      .populate('courseId', 'title code')
      .sort('-createdAt')
      .limit(5); // Limit to 5 most recent
    
    res.json({
      success: true,
      assignments: assignments
    });
  } catch (error) {
    console.error('Error fetching recent assignments:', error);
    res.status(500).json({
      success: false,
      message: 'Server error'
    });
  }
};

// @desc    Get assignments created by teachers
// @route   GET /api/assignments/teacher
// @access  Private
exports.getTeacherAssignments = async (req, res) => {
  try {
    const assignments = await Assignment.find({ role: 'teacher' })
      .populate('courseId')
      .populate('userId', 'name email');
    
    res.status(200).json({
      success: true,
      assignments: assignments,
    });
  } catch (error) {
    console.error('Error getting teacher assignments:', error);
    res.status(500).json({
      success: false,
      message: 'Server error',
      error: error.message,
    });
  }
};

// @desc    Get student assignments
// @route   GET /api/assignments/student
// @access  Private/Student
exports.getStudentAssignments = async (req, res) => {
  try {
    // Find courses the student is enrolled in
    const student = await User.findById(req.user.id).select('courses');
    
    if (!student || !student.courses || student.courses.length === 0) {
      return res.status(200).json({
        success: true,
        data: []
      });
    }
    
    // Get assignments for those courses
    const assignments = await Assignment.find({
      courseId: { $in: student.courses }
    }).populate('courseId', 'title code');
    
    return res.status(200).json({
      success: true,
      data: assignments
    });
  } catch (error) {
    console.error('Error getting student assignments:', error);
    return res.status(500).json({
      success: false,
      message: 'Error fetching student assignments',
      error: error.message
    });
  }
};

// @desc    Get assignments for current teacher
// @route   GET /api/assignments/teacher
// @access  Private/Teacher
exports.getAssignmentsForTeacher = async (req, res) => {
  try {
    // Find all courses taught by this teacher
    const teacherCourses = await Course.find({ teacher: req.user.id }).select('_id');
    const courseIds = teacherCourses.map(course => course._id);
    if (!courseIds.length) {
      return res.status(200).json({ success: true, count: 0, assignments: [] });
    }
    // Find all assignments for these courses
    const assignments = await Assignment.find({ courseId: { $in: courseIds } })
      .populate('courseId', 'title code')
      .sort('-createdAt');
    res.status(200).json({
      success: true,
      count: assignments.length,
      assignments
    });
  } catch (error) {
    console.error('Error getting assignments for teacher:', error);
    res.status(500).json({
      success: false,
      message: 'Server error',
      error: error.message
    });
  }
};

==================================================
FILE_PATH: server\controllers\auth.controller.js
==================================================
const User = require('../models/user.model');
const jwt = require('jsonwebtoken');
const crypto = require('crypto');

// Generate JWT Token
const generateToken = (id) => {
  return jwt.sign({ id }, process.env.JWT_SECRET || 'secret', {
    expiresIn: process.env.JWT_EXPIRE || '30d',
  });
};

// @desc    Register user
// @route   POST /api/auth/register
// @access  Public
exports.register = async (req, res, next) => {
  try {
    console.log('Registration request received:', req.body);
    const { name, email, password, role } = req.body;

    // Validation
    if (!name || !email || !password) {
      return res.status(400).json({ message: 'Please provide all required fields' });
    }

    // Check if user already exists
    const existingUser = await User.findOne({ email });
    if (existingUser) {
      return res.status(400).json({ message: 'User with this email already exists' });
    }

    // Create user
    console.log('Creating user with:', { name, email, role });
    const user = await User.create({
      name,
      email,
      password,
      role: role || 'student'
    });

    // Generate token
    const token = generateToken(user._id);

    res.status(201).json({
      success: true,
      token,
      user: {
        _id: user._id,
        name: user.name,
        email: user.email,
        role: user.role,
        avatar: user.avatar
      }
    });
  } catch (error) {
    console.error('Registration detailed error:', error);
    // Pass error to global error handler
    return next(error);
  }
};

// @desc    Login user
// @route   POST /api/auth/login
// @access  Public
exports.login = async (req, res) => {
  try {
    const { email, password } = req.body;

    // Validate email & password
    if (!email || !password) {
      return res.status(400).json({ message: 'Please provide email and password' });
    }

    // Check for user
    const user = await User.findOne({ email }).select('+password');
    if (!user) {
      return res.status(401).json({ message: 'Invalid credentials' });
    }

    // Check if password matches
    const isMatch = await user.matchPassword(password);
    if (!isMatch) {
      return res.status(401).json({ message: 'Invalid credentials' });
    }

    // Generate token
    const token = generateToken(user._id);

    res.json({
      success: true,
      token,
      user: {
        _id: user._id,
        name: user.name,
        email: user.email,
        role: user.role,
        avatar: user.avatar
      }
    });
  } catch (error) {
    console.error('Login error:', error);
    res.status(500).json({ message: 'Server error' });
  }
};

// @desc    Get current logged in user
// @route   GET /api/auth/me
// @access  Private
exports.getMe = async (req, res) => {
  try {
    const user = await User.findById(req.user.id).populate('courses');
    res.json({
      success: true,
      user
    });
  } catch (error) {
    console.error('Get me error:', error);
    res.status(500).json({ message: 'Server error' });
  }
};

// @desc    Forgot Password
// @route   POST /api/auth/forgot-password
// @access  Public
exports.forgotPassword = async (req, res) => {
  const { email } = req.body;
  if (!email) {
    return res.status(400).json({ message: 'Please provide your email address.' });
  }
  const user = await User.findOne({ email });
  if (!user) {
    return res.status(404).json({ message: 'No user found with that email.' });
  }
  // Generate reset token
  const resetToken = crypto.randomBytes(32).toString('hex');
  const resetTokenHash = crypto.createHash('sha256').update(resetToken).digest('hex');
  user.resetPasswordToken = resetTokenHash;
  user.resetPasswordExpire = Date.now() + 1000 * 60 * 30; // 30 minutes
  await user.save();
  // For demo: log the reset link
  const resetUrl = `${req.protocol}://${req.get('host')}/reset-password/${resetToken}`;
  console.log(`Password reset link for ${email}: ${resetUrl}`);
  res.json({ success: true, message: 'Password reset link sent (check console in demo).' });
};

// @desc    Reset Password
// @route   POST /api/auth/reset-password
// @access  Public
exports.resetPassword = async (req, res) => {
  const { token, password } = req.body;
  if (!token || !password) {
    return res.status(400).json({ message: 'Invalid request.' });
  }
  const resetTokenHash = crypto.createHash('sha256').update(token).digest('hex');
  const user = await User.findOne({
    resetPasswordToken: resetTokenHash,
    resetPasswordExpire: { $gt: Date.now() },
  });
  if (!user) {
    return res.status(400).json({ message: 'Token is invalid or has expired.' });
  }
  user.password = password;
  user.resetPasswordToken = undefined;
  user.resetPasswordExpire = undefined;
  await user.save();
  res.json({ success: true, message: 'Password has been reset successfully.' });
};


==================================================
FILE_PATH: server\controllers\base.controller.js
==================================================
/**
 * Base controller with common functionality for content controllers
 */

exports.getAll = (Model) => async (req, res) => {
  try {
    console.log(`Fetching all ${Model.modelName} with query:`, req.query);
    
    let query = {};
    
    // Handle courseId from query params
    if (req.query.courseId) {
      query.courseId = req.query.courseId;
    }
    
    // Handle courseId from URL params (for /course/:courseId routes)
    if (req.params.courseId) {
      query.courseId = req.params.courseId;
    }
    
    console.log(`Final query for ${Model.modelName}:`, query);
    
    const items = await Model.find(query)
      .populate('courseId')
      .populate('author', 'name email role')
      .sort('-createdAt');
    
    console.log(`Found ${items.length} ${Model.modelName} items`);
    
    return res.status(200).json({
      success: true,
      count: items.length,
      data: items
    });
  } catch (error) {
    console.error(`Error fetching ${Model.modelName}:`, error);
    return res.status(500).json({
      success: false,
      message: 'Server error',
      error: error.message
    });
  }
};

exports.getById = (Model) => async (req, res) => {
  try {
    const { id } = req.params;
    console.log(`Fetching ${Model.modelName} with ID: ${id}`);
    
    const item = await Model.findById(id)
      .populate('courseId')
      .populate('author', 'name email role');
    
    if (!item) {
      console.log(`${Model.modelName} not found with ID ${id}`);
      return res.status(404).json({
        success: false,
        message: `${Model.modelName} not found`
      });
    }
    
    return res.status(200).json({
      success: true,
      data: item
    });
  } catch (error) {
    console.error(`Error fetching ${Model.modelName}:`, error);
    return res.status(500).json({
      success: false,
      message: 'Server error',
      error: error.message
    });
  }
};


==================================================
FILE_PATH: server\controllers\course.controller.js
==================================================
const Course = require('../models/course.model');
const User = require('../models/user.model');

// @desc    Get all courses
// @route   GET /api/courses
// @access  Public
exports.getCourses = async (req, res) => {
  try {
    console.log('Fetching all courses - debug mode');
    
    // Simplified query to avoid potential errors
    const courses = await Course.find({})
      .populate('teacher', 'name email')
      .lean(); // Use lean for better performance
    
    console.log(`Found ${courses.length} courses`);
    
    // Match the response format expected by the client
    return res.status(200).json({
      success: true,
      courses: courses || []
    });
  } catch (error) {
    console.error('Error in getCourses controller:', error);
    return res.status(500).json({
      success: false,
      message: 'Error fetching courses',
      error: error.message
    });
  }
};

// @desc    Get single course
// @route   GET /api/courses/:id
// @access  Public
exports.getCourse = async (req, res) => {
  try {
    const course = await Course.findById(req.params.id)
      .populate('teacher', 'name email')
      .populate('students', 'name email');
      
    if (!course) {
      return res.status(404).json({
        success: false,
        message: 'Course not found'
      });
    }

    // Fetch related data
    const [assignments, quizzes, materials, notices] = await Promise.all([
      require('../models/assignment.model').find({ courseId: course._id }),
      require('../models/quiz.model').find({ course: course._id }),
      require('../models/material.model').find({ courseId: course._id }),
      require('../models/notice.model').find({ courseId: course._id })
    ]);
    
    return res.status(200).json({
      success: true,
      course,
      students: course.students || [],
      assignments: assignments || [],
      quizzes: quizzes || [],
      materials: materials || [],
      notices: notices || []
    });
  } catch (error) {
    console.error('Error fetching course:', error);
    return res.status(500).json({
      success: false,
      message: 'Error fetching course'
    });
  }
};

// @desc    Create a new course
// @route   POST /api/courses
// @access  Private/Teacher
exports.createCourse = async (req, res) => {
  try {
    const { title, description, code, coverImageUrl } = req.body;
    
    if (!title) {
      return res.status(400).json({
        success: false,
        message: 'Title is required'
      });
    }
    
    const course = await Course.create({
      title,
      description,
      code,
      coverImageUrl,
      teacher: req.user.id
    });
    
    return res.status(201).json({
      success: true,
      data: course
    });
  } catch (error) {
    console.error('Error creating course:', error);
    return res.status(500).json({
      success: false,
      message: 'Error creating course'
    });
  }
};

// @desc    Update course
// @route   PUT /api/courses/:id
// @access  Private/Teacher/Admin
exports.updateCourse = async (req, res) => {
  try {
    let course = await Course.findById(req.params.id);
    if (!course) {
      return res.status(404).json({ success: false, message: 'Course not found' });
    }

    course = await Course.findByIdAndUpdate(req.params.id, req.body, {
      new: true,
      runValidators: true
    });

    return res.status(200).json({ success: true, data: course });
  } catch (error) {
    console.error('Error updating course:', error);
    return res.status(500).json({ success: false, message: 'Error updating course' });
  }
};

// @desc    Delete course
// @route   DELETE /api/courses/:id
// @access  Private/Teacher/Admin
exports.deleteCourse = async (req, res) => {
  try {
    const course = await Course.findById(req.params.id);
    if (!course) {
      return res.status(404).json({ success: false, message: 'Course not found' });
    }

    await User.updateMany({ courses: course._id }, { $pull: { courses: course._id } });
    await Course.deleteOne({ _id: course._id });

    return res.status(200).json({ success: true, message: 'Course deleted successfully' });
  } catch (error) {
    console.error('Error deleting course:', error);
    return res.status(500).json({ success: false, message: 'Error deleting course' });
  }
};

// @desc    Enroll in course
// @route   POST /api/courses/:id/enroll
// @access  Private/Student
exports.enrollCourse = async (req, res) => {
  try {
    const course = await Course.findById(req.params.id);
    
    if (!course) {
      return res.status(404).json({
        success: false,
        message: 'Course not found'
      });
    }
    
    // Check if student is already enrolled
    if (course.students.includes(req.user.id)) {
      return res.status(400).json({
        success: false,
        message: 'Already enrolled in this course'
      });
    }
    
    // Add student to course
    course.students.push(req.user.id);
    await course.save();
    
    // Add course to student's courses
    await User.findByIdAndUpdate(
      req.user.id,
      { $push: { courses: course._id } },
      { new: true }
    );
    
    return res.json({
      success: true,
      message: 'Successfully enrolled in course',
      course
    });
  } catch (error) {
    console.error('Error enrolling in course:', error);
    return res.status(500).json({
      success: false,
      message: 'Server error'
    });
  }
};

// @desc    Get courses taught by a teacher
// @route   GET /api/courses/teacher
// @access  Private/Teacher
exports.getTeacherCourses = async (req, res) => {
  try {
    const courses = await Course.find({ teacher: req.user.id })
      .sort({ createdAt: -1 })
      .populate('teacher', 'name email');
    
    return res.json({
      success: true,
      courses: courses
    });
  } catch (error) {
    console.error('Error fetching teacher courses:', error);
    return res.status(500).json({
      success: false,
      message: 'Error fetching courses'
    });
  }
};


==================================================
FILE_PATH: server\controllers\material.controller.js
==================================================
const Material = require('../models/material.model');
const Course = require('../models/course.model');
const fs = require('fs');
const path = require('path');
const Notification = require('../models/notification.model');

// @desc    Get all materials for a course
// @route   GET /api/materials/course/:courseId
// @access  Private
// @desc    Get all materials for a course
exports.getMaterialsForCourse = async (req, res) => {
  try {
    console.log('Getting materials for course:', req.params.courseId);
    const materials = await Material.find({ courseId: req.params.courseId })
      .populate('author', 'name avatar')
      .sort('-createdAt');

    res.status(200).json({
      success: true,
      count: materials.length,
      materials: materials
    });
  } catch (error) {
    console.error('Error getting materials:', error);
    res.status(500).json({ success: false, message: 'Server error', error: error.message });
  }
};

// @desc    Get single material
exports.getMaterial = async (req, res) => {
  try {
    const material = await Material.findById(req.params.id)
      .populate('author', 'name avatar')
      .populate('courseId', 'title code');

    if (!material) {
      return res.status(404).json({ success: false, message: 'Material not found' });
    }

    res.status(200).json({ success: true, material });
  } catch (error) {
    console.error('Error getting material:', error);
    res.status(500).json({ success: false, message: 'Server error', error: error.message });
  }
};

// CREATE MATERIAL – ĐÃ XÓA kiểm tra ownership
exports.createMaterial = async (req, res) => {
  try {
    const { title, description, courseId, type, link } = req.body;
    let fileUrl = '', fileName = '', fileType = '', fileSize = 0, originalName = '';

    if (!title || !courseId) {
      return res.status(400).json({ success: false, message: 'Please provide title and course ID' });
    }

    const course = await Course.findById(courseId);
    if (!course) {
      return res.status(404).json({ success: false, message: 'Course not found' });
    }

    // ĐÃ XÓA: kiểm tra course.teacher === req.user.id
    // Bây giờ bất kỳ teacher nào cũng tạo được material ở mọi course

    if (req.file) {
      fileUrl = req.file.path;
      fileName = req.file.originalname;
      fileType = req.file.mimetype;
      fileSize = req.file.size;
      originalName = req.file.originalname;
    }

    const material = await Material.create({
      title, description, courseId, author: req.user.id,
      type, fileUrl, fileName, fileType, fileSize, originalName, link
    });

    course.materials.push(material._id);
    await course.save();

    for (const studentId of course.students) {
      await Notification.create({
        user: studentId,
        text: `A new material "${material.title}" has been posted in ${course.title}.`,
        link: `/materials/${material._id}`
      });
    }

    res.status(201).json({ success: true, material });
  } catch (error) {
    console.error('Error creating material:', error);
    res.status(500).json({ success: false, message: 'Server error', error: error.message });
  }
};

// UPDATE MATERIAL – ĐÃ XÓA kiểm tra ownership
exports.updateMaterial = async (req, res) => {
  try {
    const material = await Material.findById(req.params.id);
    if (!material) {
      return res.status(404).json({ success: false, message: 'Material not found' });
    }

    // ĐÃ XÓA: kiểm tra ownership
    const updated = await Material.findByIdAndUpdate(
      req.params.id,
      req.body,
      { new: true, runValidators: true }
    ).populate('author', 'name avatar');

    res.status(200).json({ success: true, material: updated });
  } catch (error) {
    console.error('Error updating material:', error);
    res.status(500).json({ success: false, message: 'Server error', error: error.message });
  }
};

// DELETE MATERIAL – ĐÃ XÓA kiểm tra ownership
exports.deleteMaterial = async (req, res) => {
  try {
    const material = await Material.findById(req.params.id);
    if (!material) {
      return res.status(404).json({ success: false, message: 'Material not found' });
    }

    const course = await Course.findById(material.courseId);
    course.materials.pull(material._id);
    await course.save();

    if (material.fileUrl && fs.existsSync(path.join(__dirname, '..', material.fileUrl))) {
      fs.unlinkSync(path.join(__dirname, '..', material.fileUrl));
    }

    await Material.findByIdAndDelete(req.params.id);
    res.status(200).json({ success: true, data: {} });
  } catch (error) {
    console.error('Error deleting material:', error);
    res.status(500).json({ success: false, message: 'Server error', error: error.message });
  }
};
// Defensive check example for getMaterials and getMaterial
exports.getMaterials = async (req, res) => {
  try {
    let materials;
    if (req.user.role === 'teacher') {
      const teacherCourses = await Course.find({ teacher: req.user.id }).select('_id');
      const courseIds = teacherCourses.map(course => course._id);
      if (!courseIds.length) {
        return res.status(200).json({ success: true, count: 0, materials: [] });
      }
      materials = await Material.find({ course: { $in: courseIds } })
        .populate('course', 'title code')
        .sort('-createdAt');
      if (!materials) {
        return res.status(200).json({ success: true, count: 0, materials: [] });
      }
    } else if (req.user.role === 'student') {
      const studentCourses = await Course.find({ students: req.user.id }).select('_id');
      const courseIds = studentCourses.map(course => course._id);
      materials = await Material.find({ course: { $in: courseIds } })
        .populate('course', 'title code')
        .sort('-createdAt');
      if (!materials) {
        return res.status(200).json({ success: true, count: 0, materials: [] });
      }
    } else {
      materials = await Material.find()
        .populate('course', 'title code')
        .sort('-createdAt');
      if (!materials) {
        return res.status(200).json({ success: true, count: 0, materials: [] });
      }
    }
    res.status(200).json({
      success: true,
      count: materials.length,
      materials: materials
    });
  } catch (error) {
    console.error('Error getting materials:', error);
    if (error && error.stack) console.error(error.stack);
    res.status(500).json({
      success: false,
      message: 'Server error',
      error: error.message
    });
  }
};

exports.getMaterial = async (req, res) => {
  try {
    const material = await Material.findById(req.params.id)
      .populate('course', 'title code teacher');
    if (!material) {
      return res.status(404).json({
        success: false,
        message: 'Material not found'
      });
    }
    return res.status(200).json({
      success: true,
      data: material
    });
  } catch (error) {
    console.error('Error getting material:', error);
    return res.status(500).json({
      success: false,
      message: 'Error fetching material details',
      error: error.message
    });
  }
};

// Download material by fileName
exports.downloadMaterial = async (req, res) => {
  try {
    const fileName = req.params.fileName;
    // Try assignments first
    let filePath = path.join(__dirname, '..', 'uploads', 'assignments', fileName);
    console.log('Trying to download (assignments):', fileName, 'at', filePath);
    if (!fs.existsSync(filePath)) {
      // Fallback to materials
      filePath = path.join(__dirname, '..', 'uploads', 'materials', fileName);
      console.log('Trying to download (materials):', fileName, 'at', filePath);
      if (!fs.existsSync(filePath)) {
        console.log('File not found:', fileName);
        return res.status(404).json({ success: false, message: 'File not found' });
      }
    }
    res.download(filePath, fileName);
  } catch (error) {
    console.error('Error downloading material:', error);
    res.status(500).json({ success: false, message: 'Server error' });
  }
};
    
   

==================================================
FILE_PATH: server\controllers\notice.controller.js
==================================================
const Notice = require('../models/notice.model');
const Course = require('../models/course.model');
const fs = require('fs');
const path = require('path');
const Notification = require('../models/notification.model');

// Helper function
const ensureDirectoryExists = (directory) => {
  if (!fs.existsSync(directory)) {
    fs.mkdirSync(directory, { recursive: true });
  }
};

// @desc    Create new notice
// @route   POST /api/notices
// @access  Private/Teacher (bây giờ teacher nào cũng tạo được)
exports.createNotice = async (req, res) => {
  try {
    const { title, content, courseId, priority, pinned, attachments } = req.body;

    if (!title || !content || !courseId) {
      return res.status(400).json({
        success: false,
        message: 'Please provide title, content and course ID'
      });
    }

    const course = await Course.findById(courseId);
    if (!course) {
      return res.status(404).json({
        success: false,
        message: 'Course not found'
      });
    }

    // ĐÃ XÓA kiểm tra ownership → Teacher nào cũng tạo được

    let files = [];
    if (req.files && req.files.attachments) {
      const atts = Array.isArray(req.files.attachments)
        ? req.files.attachments
        : [req.files.attachments];

      const uploadsDir = path.join(__dirname, '../uploads/notices');
      ensureDirectoryExists(uploadsDir);

      for (const file of atts) {
        const uniqueSuffix = `${Date.now()}-${Math.round(Math.random() * 1E9)}`;
        const filename = `notice_${uniqueSuffix}_${file.name.replace(/\s+/g, '_')}`;
        const filepath = path.join(uploadsDir, filename);
        await file.mv(filepath);
        files.push(`notices/${filename}`);
      }
    }

    const notice = await Notice.create({
      title,
      content,
      courseId,
      author: req.user.id,
      priority: priority || 'low',
      pinned: pinned || false,
      attachments: files
    });

    // Gửi thông báo cho học sinh
    for (const studentId of course.students) {
      await Notification.create({
        user: studentId,
        text: `Thông báo mới "${notice.title}" trong môn ${course.title}`,
        link: `/notices/${notice._id}`
      });
    }

    res.status(201).json({ success: true, notice });
  } catch (error) {
    console.error('Error creating notice:', error);
    res.status(500).json({
      success: false,
      message: 'Server error',
      error: error.message
    });
  }
};

// @desc    Update notice
// @route   PUT /api/notices/:id
exports.updateNotice = async (req, res) => {
  try {
    const notice = await Notice.findById(req.params.id);
    if (!notice) {
      return res.status(res.status(404).json({ success: false, message: 'Notice not found' }));
    }

    // ĐÃ XÓA kiểm tra ownership → Teacher nào cũng sửa được

    const updatedNotice = await Notice.findByIdAndUpdate(
      req.params.id,
      req.body,
      { new: true, runValidators: true }
    ).populate('author', 'name avatar');

    res.status(200).json({ success: true, notice: updatedNotice });
  } catch (error) {
    console.error('Error updating notice:', error);
    res.status(500).json({
      success: false,
      message: 'Server error',
      error: error.message
    });
  }
};

// @desc    Delete notice
// @route   DELETE /api/notices/:id
exports.deleteNotice = async (req, res) => {
  try {
    const notice = await Notice.findById(req.params.id);
    if (!notice) {
      return res.status(404).json({ success: false, message: 'Notice not found' });
    }

    // ĐÃ XÓA kiểm tra ownership → Teacher nào cũng xóa được

    await Notice.findByIdAndDelete(req.params.id);
    res.status(200).json({ success: true, message: 'Notice deleted successfully' });
  } catch (error) {
    console.error('Error deleting notice:', error);
    res.status(500).json({
      success: false,
      message: 'Server error',
      error: error.message
    });
  }
};

// Các hàm còn lại giữ nguyên (getNotices, getNoticesForCourse, getNotice, getUnreadCount, ...)
exports.getNotices = async (req, res) => {
  try {
    let notices;
    if (req.user.role === 'teacher') {
      const teacherCourses = await Course.find({ teacher: req.user.id }).select('_id');
      const courseIds = teacherCourses.map(c => c._id);
      notices = courseIds.length
        ? await Notice.find({ courseId: { $in: courseIds } })
            .populate('courseId', 'title code')
            .sort('-createdAt')
        : [];
    } else if (req.user.role === 'student') {
      const studentCourses = await Course.find({ students: req.user.id }).select('_id');
      const courseIds = studentCourses.map(c => c._id);
      notices = await Notice.find({ courseId: { $in: courseIds } })
        .populate('courseId', 'title code')
        .sort('-createdAt');
    } else {
      notices = await Notice.find().populate('courseId', 'title code').sort('-createdAt');
    }

    res.status(200).json({
      success: true,
      count: notices.length,
      notices
    });
  } catch (error) {
    console.error('Error getting notices:', error);
    res.status(500).json({ success: false, message: 'Server error' });
  }
};

exports.getNoticesForCourse = async (req, res) => {
  try {
    const notices = await Notice.find({ courseId: req.params.courseId })
      .populate('author', 'name avatar')
      .sort('-pinned -createdAt');

    res.status(200).json({
      success: true,
      count: notices.length,
      notices
    });
  } catch (error) {
    console.error('Error getting notices for course:', error);
    res.status(500).json({ success: false, message: 'Server error' });
  }
};

exports.getNotice = async (req, res) => {
  try {
    const notice = await Notice.findById(req.params.id)
      .populate('courseId', 'title code')
      .populate('author', 'name avatar');
    if (!notice) return res.status(404).json({ success: false, message: 'Notice not found' });
    res.status(200).json({ success: true, notice });
  } catch (error) {
    console.error('Error getting notice:', error);
    res.status(500).json({ success: false, message: 'Server error' });
  }
};

exports.getUnreadCount = async (req, res) => {
  try {
    const courseQuery = req.user.role === 'student'
      ? { students: req.user.id }
      : { teacher: req.user.id };

    const courses = await Course.find(courseQuery).select('_id');
    const courseIds = courses.map(c => c._id);

    const count = await Notice.countDocuments({
      courseId: { $in: courseIds },
      readBy: { $ne: req.user.id }
    });

    res.json({ success: true, unreadCount: count });
  } catch (error) {
    console.error('Error getting unread count:', error);
    res.status(500).json({ success: false, message: 'Server error' });
  }
};

module.exports = exports;

==================================================
FILE_PATH: server\controllers\notification.controller.js
==================================================
const Notification = require('../models/notification.model');

// Get all notifications for the logged-in user
exports.getNotifications = async (req, res) => {
  try {
    const notifications = await Notification.find({ user: req.user._id }).sort({ createdAt: -1 });
    res.json({ success: true, notifications });
  } catch (err) {
    res.status(500).json({ success: false, message: 'Server error' });
  }
};

// Mark a notification as read
exports.markAsRead = async (req, res) => {
  try {
    const notification = await Notification.findOneAndUpdate(
      { _id: req.params.id, user: req.user._id },
      { read: true },
      { new: true }
    );
    if (!notification) return res.status(404).json({ success: false, message: 'Notification not found' });
    res.json({ success: true, notification });
  } catch (err) {
    res.status(500).json({ success: false, message: 'Server error' });
  }
};

// Create a notification
exports.createNotification = async (req, res) => {
  try {
    const { user, text, link } = req.body;
    const notification = new Notification({ user, text, link });
    await notification.save();
    res.status(201).json({ success: true, notification });
  } catch (err) {
    res.status(500).json({ success: false, message: 'Server error' });
  }
}; 

==================================================
FILE_PATH: server\controllers\quiz.controller.js
==================================================
const Quiz = require('../models/quiz.model');
const Course = require('../models/course.model');
const Notification = require('../models/notification.model');
const mongoose = require('mongoose');

// @desc    Create new quiz
// @route   POST /api/quizzes
// @access  Private/Teacher
exports.createQuiz = async (req, res) => {
  try {
    const { title, description, course, timeLimit, availableFrom, availableTo, isPublished, questions } = req.body;

    const courseDoc = await Course.findById(course);
    if (!courseDoc) {
      return res.status(404).json({ message: 'Course not found' });
    }

    // ĐÃ XÓA: kiểm tra courseDoc.teacher === req.user.id
    // Bây giờ teacher nào cũng tạo được quiz ở mọi course

    const quiz = await Quiz.create({
      title, description, course, teacher: req.user.id,
      timeLimit: timeLimit || null,
      availableFrom: availableFrom || Date.now(),
      availableTo, isPublished: isPublished || false,
      questions
    });

    await Course.findByIdAndUpdate(course, { $push: { quizzes: quiz._id } });

    for (const studentId of courseDoc.students) {
      await Notification.create({
        user: studentId,
        text: `A new quiz "${quiz.title}" has been posted in ${courseDoc.title}.`,
        link: `/quizzes/${quiz._id}`
      });
    }

    res.status(201).json({ success: true, quiz });
  } catch (error) {
    console.error('Error creating quiz:', error);
    res.status(500).json({ message: 'Server error' });
  }
};

// @desc    Get all quizzes for a teacher
// @route   GET /api/quizzes/teacher
// @access  Private/Teacher
exports.getTeacherQuizzes = async (req, res) => {
  try {
    const quizzes = await Quiz.find({ teacher: req.user.id })
      .populate('course', 'title code')
      .sort('-createdAt');
    if (!quizzes) {
      return res.status(200).json({ success: true, count: 0, quizzes: [] });
    }
    res.json({
      success: true,
      count: quizzes.length,
      quizzes: quizzes,
    });
  } catch (error) {
    console.error('Error in getTeacherQuizzes:', error);
    res.status(500).json({ message: 'Server error', error: error.message });
  }
};

// @desc    Get all quizzes for a student
// @route   GET /api/quizzes/student
// @access  Private/Student
exports.getStudentQuizzes = async (req, res) => {
  try {
    // Find courses the student is enrolled in
    const courses = await Course.find({ students: req.user.id });
    const courseIds = courses.map(course => course._id);
    
    // Find quizzes for those courses
    const quizzes = await Quiz.find({ 
      course: { $in: courseIds },
      isPublished: true,
      availableFrom: { $lte: new Date() },
      $or: [
        { availableTo: null },
        { availableTo: { $gte: new Date() } }
      ]
    })
      .populate('course', 'title code')
      .sort('-createdAt');
    
    // Add submitted status to each quiz
    const quizzesWithStatus = quizzes.map(quiz => {
      const submitted = quiz.results.some(
        result => result.student.toString() === req.user.id
      );
      
      // Don't send questions/answers to student if not submitted yet
      if (!submitted) {
        quiz = quiz.toObject();
        // Keep the questions array but remove options' isCorrect field
        if (quiz.questions) {
          quiz.questions = quiz.questions.map(q => ({
            ...q,
            options: q.options.map(o => ({
              _id: o._id,
              text: o.text
            }))
          }));
        }
      }
      
      return {
        ...quiz,
        submitted
      };
    });
    
    res.json({
      success: true,
      count: quizzesWithStatus.length,
      quizzes: quizzesWithStatus,
    });
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: 'Server error' });
  }
};

// @desc    Get a single quiz
// @route   GET /api/quizzes/:id
// @access  Private
exports.getQuiz = async (req, res) => {
  try {
    console.log('Fetching quiz with ID:', req.params.id);
    const quiz = await Quiz.findById(req.params.id)
      .populate('course', 'title code')
      .populate('results.student', 'name email avatar');
    if (!quiz) {
      console.log('Quiz not found with ID:', req.params.id);
      return res.status(404).json({
        success: false,
        message: 'Quiz not found'
      });
    }
    console.log('Quiz found:', quiz.title);
    
    // Ensure questions array exists
    if (!quiz.questions) {
      quiz.questions = [];
      await quiz.save();
    }
    
    // For students, hide answers
    if (req.user.role === 'student') {
      const sanitizedQuiz = quiz.toObject();
      
      if (sanitizedQuiz.questions && Array.isArray(sanitizedQuiz.questions)) {
        sanitizedQuiz.questions = sanitizedQuiz.questions.map(q => {
          const { correctAnswer, explanation, ...rest } = q;
          return rest;
        });
      }
      
      return res.status(200).json({
        success: true,
        data: sanitizedQuiz
      });
    }
    
    // Return full quiz data for teachers/admins
    return res.status(200).json({
      success: true,
      data: quiz
    });
  } catch (error) {
    console.error('Error fetching quiz:', error);
    return res.status(500).json({
      success: false,
      message: 'Error fetching quiz details',
      error: error.message
    });
  }
};

// @desc    Update quiz
// @route   PUT /api/quizzes/:id
// @access  Private/Teacher
exports.updateQuiz = async (req, res) => {
  try {
    const quiz = await Quiz.findById(req.params.id);
    if (!quiz) return res.status(404).json({ message: 'Quiz not found' });

    // ĐÃ XÓA: kiểm tra quiz.teacher === req.user.id

    if (quiz.results && quiz.results.length > 0) {
      return res.status(400).json({ message: 'Cannot update quiz: students have already submitted answers' });
    }

    const updated = await Quiz.findByIdAndUpdate(req.params.id, req.body, { new: true, runValidators: true });
    res.json({ success: true, quiz: updated });
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: 'Server error' });
  }
};
// @desc    Delete quiz
// @route   DELETE /api/quizzes/:id
// @access  Private/Teacher
exports.deleteQuiz = async (req, res) => {
  try {
    if (!mongoose.Types.ObjectId.isValid(req.params.id)) {
      return res.status(400).json({ message: 'Invalid quiz ID format' });
    }

    const quiz = await Quiz.findById(req.params.id);
    if (!quiz) return res.status(404).json({ message: 'Quiz not found' });

    // ĐÃ XÓA: kiểm tra quiz.teacher === req.user.id

    await Quiz.findByIdAndDelete(req.params.id);

    try {
      await Course.findByIdAndUpdate(quiz.course, { $pull: { quizzes: quiz._id } });
    } catch (e) { /* không crash nếu lỗi */ }

    res.json({ success: true, message: 'Quiz deleted successfully' });
  } catch (error) {
    console.error('Error deleting quiz:', error);
    res.status(500).json({ message: 'Server error', error: error.message });
  }
};
// @desc    Submit quiz answers (student)
// @route   POST /api/quizzes/:id/submit
// @access  Private/Student
exports.submitQuiz = async (req, res) => {
  try {
    const { answers, startTime } = req.body;
    
    if (!Array.isArray(answers)) {
      return res.status(400).json({ message: 'Answers must be an array' });
    }
    
    const quiz = await Quiz.findById(req.params.id);
    
    if (!quiz) {
      return res.status(404).json({ message: 'Quiz not found' });
    }
    
    // Check if student is enrolled in the course
    const course = await Course.findById(quiz.course);
    if (!course.students.includes(req.user.id)) {
      return res.status(403).json({ message: 'Not enrolled in this course' });
    }
    
    // Check if quiz is published and available
    if (!quiz.isPublished) {
      return res.status(403).json({ message: 'This quiz is not available yet' });
    }
    
    const now = new Date();
    if (quiz.availableFrom > now) {
      return res.status(403).json({ message: 'This quiz is not available yet' });
    }
    
    if (quiz.availableTo && quiz.availableTo < now) {
      return res.status(403).json({ message: 'This quiz is no longer available' });
    }
    
    // Check if student has already taken the quiz
    const alreadySubmitted = quiz.results.some(
      result => result.student.toString() === req.user.id
    );
    
    if (alreadySubmitted) {
      return res.status(400).json({ message: 'You have already submitted this quiz' });
    }
    
    // Calculate time taken if start time is provided
    let timeTaken = null;
    if (startTime) {
      const startDate = new Date(startTime);
      timeTaken = Math.round((now - startDate) / 1000); // Time in seconds
    }
    
    // Calculate score
    let score = 0;
    let totalPossibleScore = 0;
    
    // Process each answer
    const processedAnswers = [];
    
    for (const answer of answers) {
      const question = quiz.questions.id(answer.question);
      
      if (!question) {
        continue; // Skip invalid question IDs
      }
      
      totalPossibleScore += question.points;
      let isCorrect = false;
      
      if (question.type === 'text') {
        // Handle text answer
        const studentAnswer = answer.textAnswer?.trim().toLowerCase();
        if (studentAnswer && question.correctTextAnswers && question.correctTextAnswers.length > 0) {
          isCorrect = question.correctTextAnswers.some(
            correctAnswer => correctAnswer.trim().toLowerCase() === studentAnswer
          );
        }
        
        processedAnswers.push({
          question: answer.question,
          textAnswer: answer.textAnswer,
          isCorrect
        });
      } else {
        // Handle multiple choice questions
        if (question.type === 'multiple') {
          // For multiple choice, check if all selected options are correct and all correct options are selected
          const selectedOptions = answer.selectedOptions || [];
          const correctOptions = question.options.filter(opt => opt.isCorrect);
          
          const allSelectedAreCorrect = selectedOptions.every(selectedId => {
            const option = question.options.id(selectedId);
            return option && option.isCorrect;
          });
          
          const allCorrectAreSelected = correctOptions.every(correctOpt => 
            selectedOptions.includes(correctOpt._id.toString())
          );
          
          isCorrect = allSelectedAreCorrect && allCorrectAreSelected && selectedOptions.length === correctOptions.length;
        } else {
          // For single choice
          const selectedOption = question.options.id(answer.selectedOption);
          isCorrect = selectedOption && selectedOption.isCorrect;
      }
      
      processedAnswers.push({
        question: answer.question,
          selectedOptions: answer.selectedOptions || [answer.selectedOption],
          isCorrect
      });
      }
      
      if (isCorrect) {
        score += question.points;
      }
    }
    
    // Create result
    const result = {
      student: req.user.id,
      answers: processedAnswers,
      score,
      totalPossibleScore,
      submittedAt: now,
      timeTaken
    };
    
    // Add result to quiz
    quiz.results.push(result);
    await quiz.save();
    
    res.json({
      success: true,
      message: 'Quiz submitted successfully',
      result,
    });
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: 'Server error' });
  }
};

// @desc    Get student's quiz result
// @route   GET /api/quizzes/:id/result
// @access  Private/Student
exports.getQuizResult = async (req, res) => {
  try {
    const quiz = await Quiz.findById(req.params.id);
    
    if (!quiz) {
      return res.status(404).json({ message: 'Quiz not found' });
    }
    
    // Find the student's result
    const result = quiz.results.find(
      r => r.student.toString() === req.user.id
    );
    
    if (!result) {
      return res.status(404).json({ message: 'Result not found, you have not taken this quiz yet' });
    }
    
    // Enhance result with question texts and explanations
    const enhancedResult = {
      ...result.toObject(),
      answers: result.answers.map(answer => {
        const question = quiz.questions.id(answer.question);
        
        if (question.type === 'text') {
          return {
            ...answer,
            questionText: question?.questionText,
            textAnswer: answer.textAnswer,
            correctTextAnswers: question?.correctTextAnswers,
            explanation: question?.explanation,
          };
        } else {
          const selectedOptions = answer.selectedOptions || [];
          const selectedOptionTexts = selectedOptions.map(optionId => {
            const option = question?.options.id(optionId);
            return option?.text;
          }).filter(Boolean);
          
          const correctOptions = question?.options.filter(o => o.isCorrect) || [];
        
        return {
          ...answer,
          questionText: question?.questionText,
            selectedOptionTexts,
            correctOptionTexts: correctOptions.map(o => o.text),
          explanation: question?.explanation,
        };
        }
      })
    };
    
    res.json({
      success: true,
      result: enhancedResult
    });
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: 'Server error' });
  }
};

// @desc    Get all quizzes for a specific course
// @route   GET /api/quizzes/course/:courseId
// @access  Private (Teacher/Student)
exports.getCourseQuizzes = async (req, res) => {
  try {
    const { courseId } = req.params;
    const quizzes = await Quiz.find({ course: courseId })
      .populate('course', 'title code')
      .sort('-createdAt');

    res.json({
      success: true,
      count: quizzes.length,
      quizzes,
    });
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: 'Server error' });
  }
};

// @desc    Test endpoint
// @route   GET /api/quizzes/test
// @access  Public
exports.testEndpoint = async (req, res) => {
  try {
    console.log('Test endpoint called');
    res.json({
      success: true,
      message: 'Quiz controller is working',
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    console.error('Test endpoint error:', error);
    res.status(500).json({ message: 'Test endpoint error' });
  }
};
    

==================================================
FILE_PATH: server\controllers\submission.controller.js
==================================================
const Assignment = require('../models/assignment.model');
const fs = require('fs');
const path = require('path');
const Course = require('../models/course.model');

// @desc    Get submission by ID
// @route   GET /api/submissions/:id
// @access  Private
exports.getSubmission = async (req, res) => {
  try {
    const submissionId = req.params.id;
    
    // Find assignment containing the submission
    const assignment = await Assignment.findOne({
      'submissions._id': submissionId
    })
    .populate('course', 'title code')
    .populate('teacher', 'name email')
    .populate('submissions.student', 'name email');
    
    if (!assignment) {
      return res.status(404).json({ message: 'Submission not found' });
    }
    
    // Extract the specific submission
    const submission = assignment.submissions.id(submissionId);
    
    // Check if user has access (teacher of the course or the student who submitted)
    const isTeacher = assignment.teacher._id.toString() === req.user.id;
    const isSubmitter = submission.student._id.toString() === req.user.id;
    
    if (!isTeacher && !isSubmitter && req.user.role !== 'admin') {
      return res.status(403).json({ message: 'Not authorized to access this submission' });
    }
    
    // Return submission with assignment context
    res.json({
      success: true,
      submission,
      assignment: {
        _id: assignment._id,
        title: assignment.title,
        course: assignment.course,
        deadline: assignment.deadline,
        totalPoints: assignment.totalPoints
      }
    });
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: 'Server error' });
  }
};

// @desc    Grade submission
// @route   PUT /api/submissions/:id/grade
// @access  Private/Teacher
exports.gradeSubmission = async (req, res) => {
  try {
    const { grade, feedback } = req.body;
    const submissionId = req.params.id;
    
    // Find assignment with the submission
    const assignment = await Assignment.findOne({
      'submissions._id': submissionId
    });
    
    if (!assignment) {
      return res.status(404).json({ message: 'Submission not found' });
    }
    
    // Find the submission
    const submission = assignment.submissions.id(submissionId);
    if (!submission) {
      return res.status(404).json({ message: 'Submission not found' });
    }
    
    // Fetch the course to check the teacher
    const course = await Course.findById(assignment.courseId);
    if (!course) {
      return res.status(404).json({ message: 'Course not found' });
    }
    
    // Check if user is the teacher of the course
    if (course.teacher.toString() !== req.user.id && req.user.role !== 'admin') {
      return res.status(403).json({ message: 'Not authorized to grade this submission' });
    }
    
    // Validate grade
    const numGrade = Number(grade);
    if (isNaN(numGrade) || numGrade < 0 || numGrade > assignment.totalPoints) {
      return res.status(400).json({ 
        message: `Grade must be a number between 0 and ${assignment.totalPoints}` 
      });
    }
    
    // Update the submission
    submission.grade = numGrade;
    submission.feedback = feedback || '';
    submission.graded = true;
    
    await assignment.save();
    
    res.json({
      success: true,
      message: 'Submission graded successfully',
      submission,
    });
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: 'Server error' });
  }
};

// @desc    Delete submission
// @route   DELETE /api/submissions/:id
// @access  Private/Teacher or Student (own submission only)
exports.deleteSubmission = async (req, res) => {
  try {
    const submissionId = req.params.id;
    
    // Find assignment containing the submission
    const assignment = await Assignment.findOne({
      'submissions._id': submissionId
    });
    
    if (!assignment) {
      return res.status(404).json({ message: 'Submission not found' });
    }
    
    // Extract the specific submission
    const submission = assignment.submissions.id(submissionId);
    
    // Check authorization
    const isTeacher = assignment.teacher.toString() === req.user.id;
    const isSubmitter = submission.student.toString() === req.user.id;
    const isAdmin = req.user.role === 'admin';
    
    if (!isTeacher && !isSubmitter && !isAdmin) {
      return res.status(403).json({ message: 'Not authorized to delete this submission' });
    }
    
    // Delete the file if it exists
    if (submission.file) {
      const filePath = path.join(__dirname, '../uploads', submission.file);
      if (fs.existsSync(filePath)) {
        fs.unlinkSync(filePath);
      }
    }
    
    // Remove submission from assignment
    submission.remove();
    await assignment.save();
    
    res.json({
      success: true,
      message: 'Submission deleted successfully',
    });
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: 'Server error' });
  }
};


==================================================
FILE_PATH: server\controllers\user.controller.js
==================================================
const User = require('../models/user.model');
const bcrypt = require('bcryptjs');

// @desc    Get all users
// @route   GET /api/users
// @access  Private/Admin
exports.getUsers = async (req, res) => {
  try {
    const users = await User.find().select('-password');
    
    res.json({
      success: true,
      count: users.length,
      users
    });
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: 'Server error' });
  }
};

// @desc    Get current user profile
// @route   GET /api/users/me
// @access  Private
exports.getUser = async (req, res) => {
  try {
    // User is already available in req.user from auth middleware
    const user = await User.findById(req.user.id).select('-password')
                       .populate('courses', 'title code');
    res.json({
      success: true,
      user
    });
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: 'Server error' });
  }
};

// @desc    Update user profile
// @route   PUT /api/users/me
// @access  Private
exports.updateUser = async (req, res) => {
  try {
    const { name, email } = req.body;
    
    // Check if email already exists for a different user
    if (email) {
      const existingUser = await User.findOne({ email, _id: { $ne: req.user.id } });
      if (existingUser) {
        return res.status(400).json({ message: 'Email already in use' });
      }
    }
    
    const updatedUser = await User.findByIdAndUpdate(
      req.user.id,
      { name, email },
      { new: true, runValidators: true }
    ).select('-password');
    
    res.json({
      success: true,
      user: updatedUser
    });
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: 'Server error' });
  }
};

// @desc    Update password
// @route   PUT /api/users/me/password
// @access  Private
exports.updatePassword = async (req, res) => {
  try {
    const { currentPassword, newPassword } = req.body;
    
    // Check if required fields are provided
    if (!currentPassword || !newPassword) {
      return res.status(400).json({ message: 'Please provide current and new password' });
    }
    
    // Get user with password
    const user = await User.findById(req.user.id).select('+password');
    
    // Check if current password is correct
    const isMatch = await user.matchPassword(currentPassword);
    if (!isMatch) {
      return res.status(401).json({ message: 'Current password is incorrect' });
    }
    
    // Update password
    user.password = newPassword;
    await user.save();
    
    res.json({
      success: true,
      message: 'Password updated successfully'
    });
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: 'Server error' });
  }
};

// @desc    Delete user
// @route   DELETE /api/users/:id
// @access  Private/Admin
exports.deleteUser = async (req, res) => {
  try {
    const user = await User.findById(req.params.id);
    
    if (!user) {
      return res.status(404).json({ message: 'User not found' });
    }
    
    await user.remove();
    
    res.json({
      success: true,
      message: 'User deleted successfully'
    });
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: 'Server error' });
  }
};

// @desc    Get courses for current student
// @route   GET /api/users/me/courses
// @access  Private/Student
exports.getEnrolledCourses = async (req, res) => {
  try {
    const user = await User.findById(req.user.id).populate('courses');
    
    if (!user) {
      return res.status(404).json({
        success: false,
        message: 'User not found'
      });
    }
    
    return res.status(200).json({
      success: true,
      courses: user.courses || []
    });
  } catch (error) {
    console.error('Error getting enrolled courses:', error);
    return res.status(500).json({
      success: false,
      message: 'Error fetching enrolled courses',
      error: error.message
    });
  }
};

// @desc    Student dashboard summary
// @route   GET /api/users/me/dashboard
// @access  Private/Student
exports.getStudentDashboard = async (req, res) => {
  try {
    const user = await User.findById(req.user.id).select('-password').populate('courses');
    if (!user) return res.status(404).json({ success: false, message: 'User not found' });

    // Fetch assignments, quizzes, quiz results, notices
    const [assignments, quizzes, quizResults, notices] = await Promise.all([
      // Assignments for enrolled courses
      require('../models/assignment.model').find({ course: { $in: user.courses.map(c => c._id) } }),
      // Quizzes for enrolled courses
      require('../models/quiz.model').find({ course: { $in: user.courses.map(c => c._id) } }),
      // Quiz results for this student
      require('../models/quiz.model').aggregate([
        { $unwind: '$results' },
        { $match: { 'results.student': user._id } },
        { $project: { quizId: '$_id', title: '$title', score: '$results.score', totalPoints: '$results.totalPoints', completedAt: '$results.completedAt' } }
      ]),
      // Notices for enrolled courses
      require('../models/notice.model').find({ courseId: { $in: user.courses.map(c => c._id) } })
    ]);

    res.json({
      success: true,
      profile: user,
      courses: user.courses,
      assignments,
      quizzes,
      quizResults,
      notices
    });
  } catch (error) {
    console.error(error);
    res.status(500).json({ success: false, message: 'Server error', error: error.message });
  }
};

// @desc    Teacher dashboard summary
// @route   GET /api/users/me/dashboard-teacher
// @access  Private/Teacher
exports.getTeacherDashboard = async (req, res) => {
  try {
    const user = await User.findById(req.user.id).select('-password');
    if (!user) return res.status(404).json({ success: false, message: 'User not found' });

    // Debug: Log teacher id
    console.log('Teacher ID:', user._id);

    // Fetch courses taught by teacher
    const courses = await require('../models/course.model').find({ teacher: user._id });
    const courseIds = courses.map(c => c._id);

    // Debug: Log found courses
    console.log('Courses found for teacher:', courses);

    // Fetch assignments, quizzes, notices for these courses
    const [assignments, quizzes, notices] = await Promise.all([
      require('../models/assignment.model').find({ course: { $in: courseIds } }),
      require('../models/quiz.model').find({ course: { $in: courseIds } }),
      require('../models/notice.model').find({ courseId: { $in: courseIds } })
    ]);

    // Student stats: total students across all courses
    const students = await require('../models/user.model').countDocuments({ courses: { $in: courseIds }, role: 'student' });

    // Debug: Log student count
    console.log('Student count for teacher courses:', students);

    res.json({
      success: true,
      profile: user,
      courses,
      assignments,
      quizzes,
      notices,
      studentCount: students
    });
  } catch (error) {
    console.error(error);
    res.status(500).json({ success: false, message: 'Server error', error: error.message });
  }
};


==================================================
FILE_PATH: server\index.js
==================================================


==================================================
FILE_PATH: server\middleware\auth.middleware.js
==================================================
const jwt = require('jsonwebtoken');
const User = require('../models/user.model');

// Protect routes - verifies JWT token
exports.protect = async (req, res, next) => {
  try {
    let token;
    
    // Check if token is in the Authorization header
    if (req.headers.authorization && req.headers.authorization.startsWith('Bearer')) {
      token = req.headers.authorization.split(' ')[1];
    }
    
    // Check if token exists
    if (!token) {
      return res.status(401).json({
        success: false,
        message: 'Not authorized to access this route'
      });
    }
    
    try {
      // Verify token
      const decoded = jwt.verify(token, process.env.JWT_SECRET || 'secret');
      
      // Fetch user info to get role
      const user = await User.findById(decoded.id);
      if (!user) {
        return res.status(401).json({
          success: false,
          message: 'User not found'
        });
      }
      
      req.user = { 
        id: decoded.id,
        role: user.role
      };
      
      next();
    } catch (err) {
      console.error('Token verification error:', err.message);
      return res.status(401).json({
        success: false,
        message: 'Invalid token'
      });
    }
  } catch (err) {
    console.error('Auth middleware error:', err);
    return res.status(500).json({
      success: false,
      message: 'Server error in authentication'
    });
  }
};

// Grant access to specific roles
exports.authorize = (...roles) => {
  return (req, res, next) => {
    if (!req.user || !req.user.role) {
      return res.status(403).json({
        success: false, 
        message: 'Not authorized to access this route'
      });
    }
    
    if (!roles.includes(req.user.role)) {
      return res.status(403).json({
        success: false,
        message: `User role ${req.user.role} is not authorized to access this route`
      });
    }
    
    next();
  };
};




==================================================
FILE_PATH: server\models\assignment.model.js
==================================================
const mongoose = require('mongoose');

const SubmissionSchema = new mongoose.Schema(
  {
    student: {
      type: mongoose.Schema.Types.ObjectId,
      ref: 'User',
      required: true,
    },
    content: {
      type: String,
    },
    attachments: [
      {
        fileName: String,
        fileUrl: String,
        fileType: String,
      },
    ],
    submittedAt: {
      type: Date,
      default: Date.now,
    },
    grade: {
      type: Number,
    },
    feedback: {
      type: String,
    },
    gradedAt: {
      type: Date,
    },
    gradedBy: {
      type: mongoose.Schema.Types.ObjectId,
      ref: 'User',
    },
  },
  { _id: true }
);

const AssignmentSchema = new mongoose.Schema(
  {
    title: {
      type: String,
      required: [true, 'Please add a title'],
      trim: true,
      maxlength: [100, 'Title cannot be more than 100 characters'],
    },
    description: {
      type: String,
      trim: true,
    },
    courseId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: 'Course',
      required: [true, 'Please provide course ID'],
    },
    dueDate: {
      type: Date,
    },
    totalPoints: {
      type: Number,
      default: 100,
    },
    attachments: [
      {
        fileName: String,
        fileUrl: String,
        fileType: String,
      },
    ],
    submissions: [SubmissionSchema],
    createdBy: {
      type: mongoose.Schema.Types.ObjectId,
      ref: 'User',
    },
  },
  { timestamps: true }
);

module.exports = mongoose.model('Assignment', AssignmentSchema);



==================================================
FILE_PATH: server\models\course.model.js
==================================================
const mongoose = require('mongoose');

const CourseSchema = new mongoose.Schema(
  {
    title: {
      type: String,
      required: [true, 'Please add a course title'],
      trim: true,
      maxlength: [100, 'Title cannot be more than 100 characters'],
    },
    code: {
      type: String,
      trim: true,
      // Make it optional to avoid validation errors
      maxlength: [20, 'Course code cannot be more than 20 characters'],
    },
    description: {
      type: String,
      trim: true,
    },
    thumbnail: {
      type: String,
      default: 'default-course.jpg',
    },
    teacher: {
      type: mongoose.Schema.Types.ObjectId,
      ref: 'User',
      required: true,
    },
    coverImageUrl: {
      type: String,
      default: '',
    },
    students: [
      {
        type: mongoose.Schema.Types.ObjectId,
        ref: 'User',
      },
    ],
    materials: [
      {
        type: mongoose.Schema.Types.ObjectId,
        ref: 'Material',
      },
    ],
    assignments: [
      {
        type: mongoose.Schema.Types.ObjectId,
        ref: 'Assignment',
      },
    ],
    quizzes: [
      {
        type: mongoose.Schema.Types.ObjectId,
        ref: 'Quiz',
      },
    ],
    enrollmentKey: {
      type: String,
      trim: true,
    },
    isPublished: {
      type: Boolean,
      default: true,
    },
  },
  { timestamps: true }
);

// Create slug from title
CourseSchema.pre('save', function (next) {
  // Only run if code is not provided and title has changed
  if (!this.code && (this.isNew || this.isModified('title'))) {
    // Generate a simple code from title
    this.code = this.title
      .toLowerCase()
      .replace(/\s+/g, '-')
      .substr(0, 20);
  }
  next();
});

module.exports = mongoose.model('Course', CourseSchema);


==================================================
FILE_PATH: server\models\material.model.js
==================================================
const mongoose = require('mongoose');

const materialSchema = new mongoose.Schema(
  {
    title: {
      type: String,
      required: [true, 'Please provide a title'],
      trim: true,
      maxlength: [100, 'Title cannot be more than 100 characters'],
    },
    description: {
      type: String,
      trim: true,
    },
    type: {
      type: String,
      enum: ['document', 'video', 'image', 'link', 'other'],
      default: 'document',
    },
    courseId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: 'Course',
      required: [true, 'Please provide course ID'],
    },
    author: {
      type: mongoose.Schema.Types.ObjectId,
      ref: 'User',
      required: true,
    },
    fileUrl: {
      type: String,
    },
    fileName: {
      type: String,
    },
    fileType: {
      type: String,
    },
    fileSize: {
      type: Number,
    },
    originalName: {
      type: String,
    },
    link: {
      type: String,
    },
  },
  { timestamps: true }
);

module.exports = mongoose.model('Material', materialSchema);


==================================================
FILE_PATH: server\models\notice.model.js
==================================================
const mongoose = require('mongoose');

const noticeSchema = new mongoose.Schema(
  {
    title: {
      type: String,
      required: [true, 'Please provide a title'],
      trim: true,
      maxlength: [100, 'Title cannot be more than 100 characters'],
    },
    content: {
      type: String,
      required: [true, 'Please provide content'],
      trim: true,
    },
    courseId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: 'Course',
      required: [true, 'Please provide course ID'],
    },
    author: {
      type: mongoose.Schema.Types.ObjectId,
      ref: 'User',
      required: true,
    },
    priority: {
      type: String,
      enum: ['low', 'medium', 'high'],
      default: 'low',
    },
    pinned: {
      type: Boolean,
      default: false,
    },
    attachments: [
      {
        fileName: String,
        fileUrl: String,
        fileType: String,
      },
    ],
  },
  { timestamps: true }
);

module.exports = mongoose.model('Notice', noticeSchema);


==================================================
FILE_PATH: server\models\notification.model.js
==================================================
const mongoose = require('mongoose');

const notificationSchema = new mongoose.Schema({
  user: { type: mongoose.Schema.Types.ObjectId, ref: 'User', required: true },
  text: { type: String, required: true },
  read: { type: Boolean, default: false },
  link: { type: String },
  createdAt: { type: Date, default: Date.now }
});

module.exports = mongoose.model('Notification', notificationSchema); 

==================================================
FILE_PATH: server\models\quiz.model.js
==================================================
const mongoose = require('mongoose');

const optionSchema = new mongoose.Schema({
  text: {
    type: String,
    required: true,
  },
  isCorrect: {
    type: Boolean,
    required: true,
    default: false,
  },
});

const questionSchema = new mongoose.Schema({
  questionText: {
    type: String,
    required: true,
  },
  type: {
    type: String,
    enum: ['single', 'multiple', 'text'],
    default: 'single',
  },
  options: {
    type: [optionSchema],
    required: function() {
      return this.type !== 'text';
    },
    validate: {
      validator: function(options) {
        if (this.type !== 'text') {
          return options && options.length >= 2;
        }
        return true;
      },
      message: 'Questions must have at least 2 options'
    }
  },
  correctTextAnswers: {
    type: [{
      type: String,
      trim: true,
    }],
    required: function() {
      return this.type === 'text';
    },
    validate: {
      validator: function(answers) {
        if (this.type === 'text') {
          return answers && answers.length > 0 && answers.every(ans => ans.trim().length > 0);
        }
        return true;
      },
      message: 'Text questions must have at least one correct answer'
    }
  },
  points: {
    type: Number,
    required: true,
    default: 1,
  },
  explanation: {
    type: String,
    default: '',
  },
});

const studentResultSchema = new mongoose.Schema({
  student: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User',
    required: true,
  },
  answers: [
    {
      question: {
        type: mongoose.Schema.Types.ObjectId,
        required: true,
      },
      selectedOptions: [{
        type: mongoose.Schema.Types.ObjectId,
      }],
      textAnswer: {
        type: String,
        trim: true,
      },
      isCorrect: {
        type: Boolean,
        default: false,
      },
    },
  ],
  score: {
    type: Number,
    default: 0,
  },
  totalPossibleScore: {
    type: Number,
    required: true,
  },
  submittedAt: {
    type: Date,
    default: Date.now,
  },
  timeTaken: {
    type: Number, // Time in seconds
    default: null,
  },
});

const quizSchema = new mongoose.Schema(
  {
    title: {
      type: String,
      required: [true, 'Quiz title is required'],
      trim: true,
    },
    description: {
      type: String,
      required: [true, 'Quiz description is required'],
    },
    course: {
      type: mongoose.Schema.Types.ObjectId,
      ref: 'Course',
      required: true,
    },
    teacher: {
      type: mongoose.Schema.Types.ObjectId,
      ref: 'User',
      required: true,
    },
    timeLimit: {
      type: Number, // In minutes
      default: null,
    },
    availableFrom: {
      type: Date,
      default: Date.now,
    },
    availableTo: {
      type: Date,
      default: null,
    },
    questions: [questionSchema],
    results: [studentResultSchema],
    isPublished: {
      type: Boolean,
      default: false,
    },
  },
  { timestamps: true }
);

module.exports = mongoose.model('Quiz', quizSchema);


==================================================
FILE_PATH: server\models\user.model.js
==================================================
const mongoose = require('mongoose');
const bcrypt = require('bcryptjs');
const jwt = require('jsonwebtoken'); // Added missing jwt import

const UserSchema = new mongoose.Schema(
  {
    name: {
      type: String,
      required: [true, 'Please add a name'],
      trim: true,
    },
    email: {
      type: String,
      required: [true, 'Please add an email'],
      unique: true,
      lowercase: true,
      trim: true,
    },
    password: {
      type: String,
      required: [true, 'Please add a password'],
      minlength: 6,
      select: false,
    },
    role: {
      type: String,
      enum: ['student', 'teacher', 'admin'],
      default: 'student',
    },
    avatar: {
      type: String,
      default: 'default-avatar.jpg',
    },
    courses: [
      {
        type: mongoose.Schema.Types.ObjectId,
        ref: 'Course',
      },
    ],
    resetPasswordToken: String,
    resetPasswordExpire: Date,
  },
  { timestamps: true }
);

// Encrypt password before saving
UserSchema.pre('save', async function (next) {
  if (!this.isModified('password')) {
    return next();
  }

  const salt = await bcrypt.genSalt(10);
  this.password = await bcrypt.hash(this.password, salt);
  next();
});

// Sign JWT and return
UserSchema.methods.getSignedJwtToken = function () {
  return jwt.sign({ id: this._id }, process.env.JWT_SECRET || 'secret', {
    expiresIn: process.env.JWT_EXPIRE || '30d',
  });
};

// Match user entered password to hashed password in database
UserSchema.methods.matchPassword = async function (enteredPassword) {
  try {
    return await bcrypt.compare(enteredPassword, this.password);
  } catch (error) {
    console.error('Password comparison error:', error);
    return false;
  }
};

// Ensure model is not re-registered on hot reload (useful in dev environments like Next.js or nodemon)
module.exports = mongoose.models.User || mongoose.model('User', UserSchema);


==================================================
FILE_PATH: server\package.json
==================================================
{
  "name": "lms-server",
  "version": "1.0.0",
  "description": "Backend for LMS application",
  "main": "server.js",
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js"
  },
  "dependencies": {
    "bcryptjs": "^2.4.3",
    "cors": "^2.8.5",
    "dotenv": "^16.3.1",
    "express": "^4.18.2",
    "express-validator": "^7.0.1",
    "jsonwebtoken": "^9.0.1",
    "mongoose": "^7.4.3",
    "morgan": "^1.10.0",
    "multer": "^1.4.5-lts.1"
  },
  "devDependencies": {
    "nodemon": "^3.0.1"
  }
}


==================================================
FILE_PATH: server\routes\activity.routes.js
==================================================
const express = require('express');
const router = express.Router();
const { getRecentActivities } = require('../controllers/activity.controller');
const { protect } = require('../middleware/auth.middleware');

// All routes here are protected
router.use(protect);

// Get recent activities for dashboard
router.get('/recent', getRecentActivities);

module.exports = router;


==================================================
FILE_PATH: server\routes\assignment.routes.js
==================================================
const express = require('express');
const router = express.Router();
const {
  getAssignments,
  getAssignment,
  createAssignment,
  updateAssignment,
  deleteAssignment,
  submitAssignment,
  gradeSubmission,
  getStudentAssignments,
  getAssignmentsForTeacher
} = require('../controllers/assignment.controller');
const { protect, authorize } = require('../middleware/auth.middleware');
const multer = require('multer');
const path = require('path');
const fs = require('fs');

const storage = multer.diskStorage({
  destination: (req, file, cb) => {
    const uploadPath = 'uploads/assignments';
    if (!fs.existsSync(uploadPath)) {
      fs.mkdirSync(uploadPath, { recursive: true });
    }
    cb(null, uploadPath);
  },
  filename: (req, file, cb) => {
    cb(null, Date.now() + '-' + file.originalname);
  }
});
const upload = multer({ storage });

// Student specific routes - must be before /:id route
router.get('/student', protect, authorize('student'), getStudentAssignments);

// Teacher specific route - must be before /:id route
router.get('/teacher', protect, authorize('teacher', 'admin'), getAssignmentsForTeacher);

// Basic routes
router.route('/')
  .get(protect, getAssignments)
  .post(protect, authorize('teacher', 'admin'), createAssignment);

// Single assignment routes
router.route('/:id')
  .get(protect, getAssignment)
  .put(protect, authorize('teacher', 'admin'), updateAssignment)
  .delete(protect, authorize('teacher', 'admin'), deleteAssignment);

// Submission routes
router.post('/:id/submit', protect, authorize('student'), upload.single('file'), submitAssignment);
router.post('/:id/grade/:submissionId', protect, authorize('teacher', 'admin'), gradeSubmission);

module.exports = router;


==================================================
FILE_PATH: server\routes\auth.routes.js
==================================================
const express = require('express');
const router = express.Router();
const { 
  register, 
  login, 
  getMe, 
  forgotPassword, 
  resetPassword 
} = require('../controllers/auth.controller');
const { protect } = require('../middleware/auth.middleware');

// Routes
router.post('/register', register);
router.post('/login', login);
router.get('/me', protect, getMe);
router.post('/forgot-password', forgotPassword);
router.post('/reset-password', resetPassword);

module.exports = router;


==================================================
FILE_PATH: server\routes\course.routes.js
==================================================
const express = require('express');
const router = express.Router();
const {
  getCourses,
  getCourse,
  createCourse,
  updateCourse,
  deleteCourse,
  getTeacherCourses,
  enrollCourse
} = require('../controllers/course.controller');
const { protect, authorize } = require('../middleware/auth.middleware');

// IMPORTANT: The order of routes is important for Express
// More specific routes should come before dynamic routes (those with parameters)

// Public route - no authentication required
router.get('/', getCourses);

// Teacher-specific route - must be before /:id route
router.get('/teacher', protect, authorize('teacher'), getTeacherCourses);

// Course by ID - protected 
router.get('/:id', protect, getCourse);
router.post('/:id/enroll', protect, authorize('student'), enrollCourse);
router.put('/:id', protect, authorize('teacher'), updateCourse);
router.delete('/:id', protect, authorize('teacher'), deleteCourse);

// Course creation
router.post('/', protect, authorize('teacher'), createCourse);

module.exports = router;


==================================================
FILE_PATH: server\routes\material.routes.js
==================================================
const express = require('express');
const router = express.Router();
const multer = require('multer');
const path = require('path');
const fs = require('fs');

const {
  getMaterialsForCourse,
  getMaterial,
  createMaterial,
  updateMaterial,
  deleteMaterial,
  downloadMaterial
} = require('../controllers/material.controller');

const { protect, authorize } = require('../middleware/auth.middleware');

// Configure storage
const storage = multer.diskStorage({
  destination: (req, file, cb) => {
    const uploadPath = 'uploads/materials';
    
    // Create directory if it doesn't exist
    if (!fs.existsSync(uploadPath)) {
      fs.mkdirSync(uploadPath, { recursive: true });
    }
    
    cb(null, uploadPath);
  },
  filename: (req, file, cb) => {
    cb(null, file.originalname);
  }
});

// File filter
const fileFilter = (req, file, cb) => {
  // Allow common document/media types
  const allowedTypes = [
    'application/pdf',
    'application/msword',
    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
    'application/vnd.ms-excel',
    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
    'application/vnd.ms-powerpoint',
    'application/vnd.openxmlformats-officedocument.presentationml.presentation',
    'image/jpeg',
    'image/png',
    'image/gif',
    'text/plain',
    'application/zip',
    'application/x-zip-compressed'
  ];
  
  if (allowedTypes.includes(file.mimetype)) {
    cb(null, true);
  } else {
    cb(new Error('Invalid file type'), false);
  }
};

// Setup upload
const upload = multer({
  storage,
  fileFilter,
  limits: { fileSize: 10 * 1024 * 1024 } // 10MB limit
});

// Routes
router.get('/course/:courseId', protect, getMaterialsForCourse);
router.get('/:id', protect, getMaterial);

// Create with file upload
router.post(
  '/',
  protect,
  authorize('teacher', 'admin'),
  upload.single('file'),
  createMaterial
);

router.put('/:id', protect, authorize('teacher', 'admin'), updateMaterial);
router.delete('/:id', protect, authorize('teacher', 'admin'), deleteMaterial);

router.get('/download/:fileName', protect, downloadMaterial);

module.exports = router;


==================================================
FILE_PATH: server\routes\notice.routes.js
==================================================
const express = require('express');
const router = express.Router();
const {
  getNotices,
  getNotice,
  createNotice,
  updateNotice,
  deleteNotice,
  getUnreadCount
} = require('../controllers/notice.controller');
const { protect, authorize } = require('../middleware/auth.middleware');

// Get unread notices count
router.get('/unread', protect, getUnreadCount);

// Get notices for a specific course (this must come before /:id route)
router.get('/course/:courseId', protect, getNotices);

// Get all notices
router.get('/', protect, getNotices);

// Get single notice
router.get('/:id', protect, getNotice);

// Create notice - only teachers and admins
router.post('/', protect, authorize('teacher', 'admin'), createNotice);

// Update notice - only teachers and admins
router.put('/:id', protect, authorize('teacher', 'admin'), updateNotice);

// Delete notice - only teachers and admins
router.delete('/:id', protect, authorize('teacher', 'admin'), deleteNotice);

module.exports = router;


==================================================
FILE_PATH: server\routes\notification.routes.js
==================================================
const express = require('express');
const router = express.Router();
const { getNotifications, markAsRead, createNotification } = require('../controllers/notification.controller');
const { protect } = require('../middleware/auth.middleware');

// Get all notifications for the logged-in user
router.get('/', protect, getNotifications);
// Mark a notification as read
router.put('/:id/read', protect, markAsRead);
// Create a notification
router.post('/', protect, createNotification);

module.exports = router; 

==================================================
FILE_PATH: server\routes\quiz.routes.js
==================================================
const express = require('express');
const router = express.Router();
const { 
  createQuiz,
  getTeacherQuizzes,
  getStudentQuizzes,
  getQuiz,
  updateQuiz,
  deleteQuiz,
  submitQuiz,
  getQuizResult,
  getCourseQuizzes,
  testEndpoint
} = require('../controllers/quiz.controller');
const { protect, authorize } = require('../middleware/auth.middleware');

// Test endpoint (for debugging)
router.get('/test', testEndpoint);

// Course specific routes (must be before /:id routes to avoid conflicts)
router.get('/course/:courseId', protect, getCourseQuizzes);

// Teacher routes
router.post('/', protect, authorize('teacher', 'admin'), createQuiz);
router.get('/teacher', protect, authorize('teacher', 'admin'), getTeacherQuizzes);
router.put('/:id', protect, authorize('teacher', 'admin'), updateQuiz);
router.delete('/:id', protect, authorize('teacher', 'admin'), deleteQuiz);

// Student routes
router.get('/student', protect, authorize('student'), getStudentQuizzes);
router.post('/:id/submit', protect, authorize('student'), submitQuiz);
router.get('/:id/result', protect, getQuizResult);

// Single quiz routes
router.route('/:id')
  .get(protect, getQuiz);

// Routes for both teachers and students
// router.get('/:id', protect, getQuiz);

module.exports = router;


==================================================
FILE_PATH: server\routes\submission.routes.js
==================================================
const express = require('express');
const router = express.Router();
const { protect, authorize } = require('../middleware/auth.middleware');

// We'll use the existing assignment controller for submission operations
const { 
  getSubmission,
  gradeSubmission,
  deleteSubmission
} = require('../controllers/submission.controller');

// Routes for submissions
router.get('/:id', protect, getSubmission);
router.put('/:id/grade', protect, authorize('teacher', 'admin'), gradeSubmission);
router.delete('/:id', protect, authorize('teacher', 'admin'), deleteSubmission);

module.exports = router;


==================================================
FILE_PATH: server\routes\user.routes.js
==================================================
const express = require('express');
const router = express.Router();
const { protect, authorize } = require('../middleware/auth.middleware');

// Placeholder for user controller
// We'll need to create these functions later
const {
  getUsers,
  getUser,
  updateUser,
  deleteUser,
  updatePassword,
  getEnrolledCourses,
  getStudentDashboard,
  getTeacherDashboard
} = require('../controllers/user.controller');

// Routes for admin only
router.get('/', protect, authorize('teacher', 'admin'), getUsers);

// Routes for the user's own profile
router.get('/me', protect, getUser);
router.put('/me', protect, updateUser);
router.put('/me/password', protect, updatePassword);

// Admin route for managing users
router.delete('/:id', protect, authorize('admin'), deleteUser);

// Add student dashboard routes
router.get('/me/courses', protect, authorize('student'), getEnrolledCourses);

// Dashboard endpoints
router.get('/me/dashboard', protect, authorize('student'), getStudentDashboard);
router.get('/me/dashboard-teacher', protect, authorize('teacher'), getTeacherDashboard);

module.exports = router;


==================================================
FILE_PATH: server\scripts\drop-index.js
==================================================
const mongoose = require('mongoose');
require('dotenv').config();

const dropIndex = async () => {
  try {
    // Connect to MongoDB
    const mongoURI = process.env.MONGO_URI || 'mongodb://localhost:27017/test';
    await mongoose.connect(mongoURI);
    console.log('MongoDB Connected');

    // Drop the problematic index
    const db = mongoose.connection.db;
    const collection = db.collection('users');
    
    try {
      await collection.dropIndex('username_1');
      console.log('Successfully dropped username_1 index');
    } catch (error) {
      console.error('Error dropping index:', error.message);
    }

    console.log('Done');
    process.exit(0);
  } catch (error) {
    console.error('Error:', error);
    process.exit(1);
  }
};

dropIndex();


==================================================
FILE_PATH: server\scripts\drop-username-index.js
==================================================
const mongoose = require('mongoose');
require('dotenv').config();

const dropIndex = async () => {
  try {
    // Connect to MongoDB
    await mongoose.connect(process.env.MONGO_URI || 'mongodb://localhost:27017/test');
    console.log('MongoDB Connected');

    // Get the users collection
    const db = mongoose.connection;
    const collection = db.collection('users');

    // List all indexes
    console.log('Current indexes:');
    const indexes = await collection.indexes();
    console.log(indexes);

    // Drop the problematic username index
    try {
      const result = await collection.dropIndex('username_1');
      console.log('Successfully dropped username_1 index:', result);
    } catch (error) {
      console.error('Error dropping index:', error.message);
    }

    // List indexes after drop
    console.log('Updated indexes:');
    const updatedIndexes = await collection.indexes();
    console.log(updatedIndexes);

    console.log('Done');
    process.exit(0);
  } catch (error) {
    console.error('Error:', error);
    process.exit(1);
  }
};

dropIndex();


==================================================
FILE_PATH: server\scripts\fix-mongo-index.js
==================================================
const mongoose = require('mongoose');
require('dotenv').config({ path: '../.env' });

// Connect to MongoDB
async function fixMongoIndex() {
  try {
    // Use the same connection string as your server
    const mongoURI = process.env.MONGO_URI || 'mongodb://localhost:27017/lms_new';
    console.log('Connecting to MongoDB...');
    await mongoose.connect(mongoURI);
    console.log('Connected to MongoDB');
    
    // Get direct access to the collection
    const db = mongoose.connection.db;
    
    // List all collections
    const collections = await db.listCollections().toArray();
    console.log('Collections:', collections.map(c => c.name));
    
    // Check for users collection
    if (collections.find(c => c.name === 'users')) {
      const users = db.collection('users');
      
      // List all indexes
      const indexes = await users.indexes();
      console.log('Current indexes on users collection:', indexes);
      
      // Find and drop username index if it exists
      const usernameIndex = indexes.find(idx => 
        idx.key && idx.key.username === 1
      );
      
      if (usernameIndex) {
        console.log('Found username index:', usernameIndex.name);
        await users.dropIndex(usernameIndex.name);
        console.log('Successfully dropped username index');
      } else {
        console.log('No username index found');
      }
      
      // List remaining indexes
      const remainingIndexes = await users.indexes();
      console.log('Remaining indexes:', remainingIndexes);
    } else {
      console.log('Users collection not found');
    }
    
    console.log('Script completed successfully.');
  } catch (err) {
    console.error('Error:', err);
  } finally {
    // Close the connection
    await mongoose.disconnect();
    console.log('Disconnected from MongoDB');
  }
}

fixMongoIndex();


==================================================
FILE_PATH: server\scripts\reset-database.js
==================================================
const mongoose = require('mongoose');
require('dotenv').config({ path: '../.env' });

async function resetDatabase() {
  try {
    // Connect to MongoDB
    const mongoURI = process.env.MONGO_URI || 'mongodb://localhost:27017/lms_system_new';
    console.log('Connecting to MongoDB...');
    await mongoose.connect(mongoURI);
    console.log('Connected to MongoDB at', mongoURI);

    // Drop the entire users collection
    const result = await mongoose.connection.db.dropCollection('users')
      .catch(err => {
        if (err.codeName === 'NamespaceNotFound') {
          console.log('Collection does not exist, no need to drop');
          return { ok: 1 };
        }
        throw err;
      });
    
    console.log('Drop collection result:', result);
    console.log('Database reset complete');
  } catch (error) {
    console.error('Error resetting database:', error);
  } finally {
    await mongoose.disconnect();
    console.log('Disconnected from MongoDB');
  }
}

resetDatabase();


==================================================
FILE_PATH: server\server.js
==================================================
const express = require('express');
const mongoose = require('mongoose');
const cors = require('cors');
const morgan = require('morgan');
const path = require('path');
require('dotenv').config();

// Import routes
const authRoutes = require('./routes/auth.routes');
const userRoutes = require('./routes/user.routes');
const courseRoutes = require('./routes/course.routes');
const noticeRoutes = require('./routes/notice.routes');
const assignmentRoutes = require('./routes/assignment.routes');
const quizRoutes = require('./routes/quiz.routes');
const materialRoutes = require('./routes/material.routes');
const submissionRoutes = require('./routes/submission.routes');
const activityRoutes = require('./routes/activity.routes'); // Added activities routes
const notificationRoutes = require('./routes/notification.routes');

const app = express();

// Disable caching for all API responses
app.use((req, res, next) => {
  if (req.url.startsWith('/api/')) {
    res.set('Cache-Control', 'no-store');
  }
  next();
});

// Middleware
app.use(cors());
app.use(express.json());
app.use(morgan('dev'));
app.use('/uploads', express.static(path.join(__dirname, 'uploads')));

// MongoDB connection
const mongoURI = process.env.MONGO_URI || 'mongodb://localhost:27017/lms_new';

mongoose
  .connect(mongoURI)
  .then(() => console.log('MongoDB connected'))
  .catch((err) => {
    console.error('MongoDB connection error:', err);
    // Server still runs, but DB is not connected
  });

// Add debug logging middleware to catch API errors
app.use((req, res, next) => {
  const originalSend = res.send;
  res.send = function(data) {
    console.log(`${req.method} ${req.originalUrl} - Status: ${res.statusCode}`);
    if (res.statusCode >= 400) {
      console.error(`Error response: ${data}`);
    }
    return originalSend.call(this, data);
  };
  next();
});

// Add a debug middleware for content routes
app.use(['/api/materials', '/api/assignments', '/api/quizzes', '/api/notices'], (req, res, next) => {
  console.log(`DEBUG: ${req.method} ${req.originalUrl}`);
  console.log('Query params:', req.query);
  console.log('URL params:', req.params);
  console.log('Body:', req.body);
  next();
});

// API Routes
app.use('/api/auth', authRoutes);
app.use('/api/users', userRoutes);
app.use('/api/courses', courseRoutes);
app.use('/api/notices', noticeRoutes);
app.use('/api/assignments', assignmentRoutes);
app.use('/api/quizzes', quizRoutes);
app.use('/api/materials', materialRoutes);
app.use('/api/submissions', submissionRoutes);
app.use('/api/activities', activityRoutes); // Added activities routes
app.use('/api/notifications', notificationRoutes);

// Global error handler for any uncaught errors in the routes
app.use('/api/*', (error, req, res, next) => {
  console.error('API Error caught by middleware:', error);
  res.status(500).json({
    success: false,
    message: 'Something went wrong on the server',
    details: process.env.NODE_ENV === 'development' ? error.message : undefined
  });
});

// Serve static files
if (process.env.NODE_ENV === 'production') {
  app.use(express.static(path.join(__dirname, '../client/build')));

  app.get('*', (req, res) => {
    res.sendFile(path.join(__dirname, '../client/build', 'index.html'));
  });
} else {
  app.use(express.static(path.join(__dirname, '../client/public')));

  app.get('*', (req, res, next) => {
    if (req.url.startsWith('/api')) {
      return next(); // Let API routes be handled above
    }
    res.sendFile(path.join(__dirname, '../client/public', 'index.html'));
  });
}

// Global error handler
app.use((err, req, res, next) => {
  console.error('Server Error:', err.stack);

  if (err.name === 'MongoServerError' && err.code === 11000) {
    return res.status(400).json({
      success: false,
      message: 'This email is already registered'
    });
  }

  res.status(500).json({
    success: false,
    message: err.message || 'Something went wrong on the server'
  });
});

// Error handler middleware
app.use((err, req, res, next) => {
  console.error('Server error:', err.stack);
  res.status(500).json({
    success: false,
    message: 'Server Error',
    error: process.env.NODE_ENV === 'development' ? err.message : undefined
  });
});

// Handle unhandled promise rejections
process.on('unhandledRejection', (err) => {
  console.log('UNHANDLED REJECTION! 💥 Shutting down...');
  console.error('Error:', err.message);
  // Close server & exit process
  server.close(() => {
    process.exit(1);
  });
});

// Start server
const PORT = process.env.PORT || 5000;
app.listen(PORT, () => console.log(`Server running on port ${PORT}`));


==================================================
FILE_PATH: server.js
==================================================
const Notice = require('../models/notice.model');
const Course = require('../models/course.model');
const fs = require('fs');
const path = require('path');
const cors = require('cors');

// Helper function to create directories if they don't exist
const ensureDirectoryExists = (directory) => {
  if (!fs.existsSync(directory)) {
    fs.mkdirSync(directory, { recursive: true });
  }
};

// Add proper CORS handling to allow cross-origin requests
app.use(cors({
  origin: 'http://localhost:3000',
  credentials: true
}));

// @desc    Create new notice
// @route   POST /api/notices
// @access  Private/Teacher
exports.createNotice = async (req, res) => {
  try {
    console.log('Creating notice with data:', req.body);
    const { title, content, courseId, priority, pinned, attachments } = req.body;
    
    // Validate required fields
    if (!title || !content || !courseId) {
      return res.status(400).json({
        success: false,
        message: 'Please provide title, content and course ID'
      });
    }
    
    // Check if course exists
    const course = await Course.findById(courseId);
    if (!course) {
      return res.status(404).json({
        success: false,
        message: 'Course not found'
      });
    }
    
    // Check if user is the teacher of the course
    if (course.teacher.toString() !== req.user.id && req.user.role !== 'admin') {
      return res.status(403).json({
        success: false,
        message: 'Not authorized to create notices for this course'
      });
    }
    
    let files = [];
    
    // Handle file uploads
    if (req.files && req.files.attachments) {
      const attachments = Array.isArray(req.files.attachments) 
        ? req.files.attachments 
        : [req.files.attachments];
        
      // Ensure uploads directory exists
      const uploadsDir = path.join(__dirname, '../uploads/notices');
      ensureDirectoryExists(uploadsDir);
      
      // Save each file
      for (const file of attachments) {
        const uniqueSuffix = `${Date.now()}-${Math.round(Math.random() * 1E9)}`;
        const filename = `notice_${uniqueSuffix}_${file.name.replace(/\s+/g, '_')}`;
        const filepath = path.join(uploadsDir, filename);
        
        await file.mv(filepath);
        files.push(`notices/${filename}`);
      }
    }
    
    // Create notice
    const notice = await Notice.create({
      title,
      content,
      courseId,
      author: req.user.id,
      priority: priority || 'low',
      pinned: pinned || false,
      attachments: files
    });
    
    res.status(201).json({
      success: true,
      data: notice
    });
  } catch (error) {
    console.error('Error creating notice:', error);
    res.status(500).json({
      success: false,
      message: 'Server error',
      error: error.message
    });
  }
};

// @desc    Get all notices (global or for a specific course)
// @route   GET /api/notices
// @route   GET /api/notices/course/:courseId
// @access  Private
exports.getNotices = async (req, res) => {
  try {
    // Add logging for debugging
    console.log('Fetching notices with query:', req.query);
    
    let query = {};
    
    // If courseId is provided in query params, filter by course
    if (req.query.courseId) {
      query.courseId = req.query.courseId;
    }
    
    const notices = await Notice.find(query)
      .populate('courseId')
      .populate('userId', 'name email role');
    
    console.log(`Found ${notices.length} notices`);
    
    res.status(200).json({
      success: true,
      count: notices.length,
      data: notices
    });
  } catch (error) {
    console.error('Error fetching notices:', error);
    res.status(500).json({
      success: false,
      message: 'Server error',
      error: error.message
    });
  }
};

// @desc    Get all notices for a course
// @route   GET /api/notices/course/:courseId
// @access  Private
exports.getNoticesForCourse = async (req, res) => {
  try {
    console.log('Getting notices for course:', req.params.courseId);
    
    const notices = await Notice.find({ courseId: req.params.courseId })
      .populate('author', 'name avatar')
      .sort('-pinned -createdAt');
    
    res.status(200).json({
      success: true,
      count: notices.length,
      data: notices
    });
  } catch (error) {
    console.error('Error getting notices:', error);
    res.status(500).json({
      success: false,
      message: 'Server error',
      error: error.message
    });
  }
};

// @desc    Get single notice
// @route   GET /api/notices/:id
// @access  Private
exports.getNotice = async (req, res) => {
  try {
    const { id } = req.params;
    
    console.log(`Fetching notice with id: ${id}`);
    
    const notice = await Notice.findById(id)
      .populate('courseId')
      .populate('userId', 'name email role');
    
    if (!notice) {
      console.log('Notice not found');
      return res.status(404).json({
        success: false,
        message: 'Notice not found'
      });
    }
    
    res.status(200).json({
      success: true,
      data: notice
    });
  } catch (error) {
    console.error('Error fetching notice:', error);
    res.status(500).json({
      success: false,
      message: 'Server error',
      error: error.message
    });
  }
};

// @desc    Update notice
// @route   PUT /api/notices/:id
// @access  Private/Teacher
exports.updateNotice = async (req, res) => {
  try {
    let notice = await Notice.findById(req.params.id);
    
    if (!notice) {
      return res.status(404).json({
        success: false,
        message: 'Notice not found'
      });
    }
    
    // Check course ownership
    const course = await Course.findById(notice.courseId);
    if (course.teacher.toString() !== req.user.id && req.user.role !== 'admin') {
      return res.status(403).json({
        success: false,
        message: 'Not authorized to update this notice'
      });
    }
    
    notice = await Notice.findByIdAndUpdate(
      req.params.id,
      req.body,
      { new: true, runValidators: true }
    ).populate('author', 'name avatar');
    
    res.status(200).json({
      success: true,
      data: notice
    });
  } catch (error) {
    console.error('Error updating notice:', error);
    res.status(500).json({
      success: false,
      message: 'Server error',
      error: error.message
    });
  }
};

// @desc    Delete notice
// @route   DELETE /api/notices/:id
// @access  Private/Teacher
exports.deleteNotice = async (req, res) => {
  try {
    const notice = await Notice.findById(req.params.id);
    
    if (!notice) {
      return res.status(404).json({
        success: false,
        message: 'Notice not found'
      });
    }
    
    // Check course ownership
    const course = await Course.findById(notice.courseId);
    if (course.teacher.toString() !== req.user.id && req.user.role !== 'admin') {
      return res.status(403).json({
        success: false,
        message: 'Not authorized to delete this notice'
      });
    }
    
    await Notice.findByIdAndDelete(req.params.id);
    
    res.status(200).json({
      success: true,
      data: {}
    });
  } catch (error) {
    console.error('Error deleting notice:', error);
    res.status(500).json({
      success: false,
      message: 'Server error',
      error: error.message
    });
  }
};

// @desc    Get unread notices count
// @route   GET /api/notices/unread
// @access  Private
exports.getUnreadCount = async (req, res) => {
  try {
    // Find courses the user is in
    let courseQuery = {};
    
    if (req.user.role === 'student') {
      courseQuery.students = req.user.id;
    } else if (req.user.role === 'teacher') {
      courseQuery.teacher = req.user.id;
    }
    
    const courses = await Course.find(courseQuery);
    const courseIds = courses.map(course => course._id);
    
    // Find notices that the user has not read yet
    const unreadNoticesCount = await Notice.countDocuments({
      $and: [
        { readBy: { $ne: req.user.id } },
        {
          $or: [
            { course: { $in: courseIds } },
            { course: null } // Global notices
          ]
        }
      ]
    });
    
    res.json({
      success: true,
      unreadCount: unreadNoticesCount
    });
  } catch (error) {
    console.error(error);
    res.status(500).json({ message: 'Server error' });
  }
};